{"pageProps":{"contents":{"id":"20221211174737","title":"rds のパラメータグループを for 文でまとめてかく","body":"\nモジュール側で map の配列を受け取るようにする。\n```terraform\nvariable \"parameters\" {\n  type        = list(map(string))\n}\n\nresource \"aws_rds_cluster_parameter_group\" \"template\" {\n  family = \"aurora-mysql5.7\"\n\n  name = var.name\n\n  dynamic \"parameter\" {\n    for_each = var.parameters\n    content {\n      apply_method = parameter.value[\"apply_method\"]\n      name         = parameter.value[\"name\"]\n      value        = parameter.value[\"value\"]\n    }\n  }\n}\n```\n\n呼び出し側で parameters の配列に必要なパラメータを map で書いてあげればよい。\n```terraform\nmodule \"parameter_group\" {\n  source      = \"../../modules/aws_rds_cluster_parameter_group\"\n  name        = \"sample-parameter-group\"\n\n  parameters = [\n    { apply_method : \"immediate\", name : \"character_set_server\", value : \"utf8mb4\" },\n    { apply_method : \"pending-reboot\", name : \"binlog_format\", value : \"MIXED\" },\n  ]\n}\n```\n\nplan 結果。\n```bash\n  # module.parameter_group.aws_rds_cluster_parameter_group.template will be created\n  + resource \"aws_rds_cluster_parameter_group\" \"template\" {\n      + arn         = (known after apply)\n      + description = \"Managed by Terraform\"\n      + family      = \"aurora-mysql5.7\"\n      + id          = (known after apply)\n      + name        = \"sample-parameter-group\"\n      + name_prefix = (known after apply)\n      + tags_all    = (known after apply)\n\n      + parameter {\n          + apply_method = \"immediate\"\n          + name         = \"character_set_server\"\n          + value        = \"utf8mb4\"\n        }\n      + parameter {\n          + apply_method = \"pending-reboot\"\n          + name         = \"binlog_format\"\n          + value        = \"MIXED\"\n        }\n    }\n\nPlan: 1 to add, 0 to change, 0 to destroy.\n```\n"}},"__N_SSG":true}