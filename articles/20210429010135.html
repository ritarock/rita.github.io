<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>Golang の goroutine / channel とか</title><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/css/e1c3d6ee91fcccc28a7c.css" as="style"/><link rel="stylesheet" href="/_next/static/css/e1c3d6ee91fcccc28a7c.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-f7ca7a935b246c4edd14.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.d2e6186d001d2275b0af.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.b2562460c774f5a57980.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-b63af2e2dfcc0bffd9c0.js" as="script"/><link rel="preload" href="/_next/static/chunks/c5b568cee8545d966ddc8d89f9063461e084494a.c564a02921d697744263.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/articles/%5Bid%5D-565d4c3adc05a3ed7d91.js" as="script"/></head><body><div id="__next"><div><div><div><h1>Ghostの囁き</h1><hr color="black"/></div><h2>Golang の goroutine / channel とか</h2><h2>goroutine</h2><p>goroutine は軽量なスレッド。</p><pre style="color:black;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;position:relative;margin:.5em 0;overflow:visible;padding:0;background-color:#fdfdfd;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;margin-bottom:1em"><code class="language-go" style="color:black;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;max-height:inherit;height:inherit;padding:0 1em;display:block;overflow:auto"><span class="token" style="color:#1990b8">go</span><span> </span><span class="token" style="color:#2f9c0a">f</span><span class="token" style="color:#5F6364">(</span><span>x</span><span class="token" style="color:#5F6364">,</span><span> y</span><span class="token" style="color:#5F6364">)</span></code></pre><p>と書くだけ。</p><pre style="color:black;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;position:relative;margin:.5em 0;overflow:visible;padding:0;background-color:#fdfdfd;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;margin-bottom:1em"><code class="language-go" style="color:black;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;max-height:inherit;height:inherit;padding:0 1em;display:block;overflow:auto"><span class="token" style="color:#1990b8">package</span><span> main
</span>
<span></span><span class="token" style="color:#1990b8">import</span><span> </span><span class="token" style="color:#5F6364">(</span><span>
</span><span>	</span><span class="token" style="color:#2f9c0a">&quot;fmt&quot;</span><span>
</span><span>	</span><span class="token" style="color:#2f9c0a">&quot;time&quot;</span><span>
</span><span></span><span class="token" style="color:#5F6364">)</span><span>
</span>
<span></span><span class="token" style="color:#1990b8">func</span><span> </span><span class="token" style="color:#2f9c0a">say</span><span class="token" style="color:#5F6364">(</span><span>s </span><span class="token" style="color:#2f9c0a">string</span><span class="token" style="color:#5F6364">)</span><span> </span><span class="token" style="color:#5F6364">{</span><span>
</span><span>	</span><span class="token" style="color:#1990b8">for</span><span> i </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">:=</span><span> </span><span class="token" style="color:#c92c2c">0</span><span class="token" style="color:#5F6364">;</span><span> i </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">&lt;</span><span> </span><span class="token" style="color:#c92c2c">5</span><span class="token" style="color:#5F6364">;</span><span> i</span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">++</span><span> </span><span class="token" style="color:#5F6364">{</span><span>
</span><span>		time</span><span class="token" style="color:#5F6364">.</span><span class="token" style="color:#2f9c0a">Sleep</span><span class="token" style="color:#5F6364">(</span><span class="token" style="color:#c92c2c">100</span><span> </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">*</span><span> time</span><span class="token" style="color:#5F6364">.</span><span>Millisecond</span><span class="token" style="color:#5F6364">)</span><span>
</span><span>		fmt</span><span class="token" style="color:#5F6364">.</span><span class="token" style="color:#2f9c0a">Println</span><span class="token" style="color:#5F6364">(</span><span>s</span><span class="token" style="color:#5F6364">)</span><span>
</span><span>	</span><span class="token" style="color:#5F6364">}</span><span>
</span><span></span><span class="token" style="color:#5F6364">}</span><span>
</span>
<span></span><span class="token" style="color:#1990b8">func</span><span> </span><span class="token" style="color:#2f9c0a">main</span><span class="token" style="color:#5F6364">(</span><span class="token" style="color:#5F6364">)</span><span> </span><span class="token" style="color:#5F6364">{</span><span>
</span><span>	</span><span class="token" style="color:#1990b8">go</span><span> </span><span class="token" style="color:#2f9c0a">say</span><span class="token" style="color:#5F6364">(</span><span class="token" style="color:#2f9c0a">&quot;hello&quot;</span><span class="token" style="color:#5F6364">)</span><span>
</span><span>	</span><span class="token" style="color:#2f9c0a">say</span><span class="token" style="color:#5F6364">(</span><span class="token" style="color:#2f9c0a">&quot;world&quot;</span><span class="token" style="color:#5F6364">)</span><span>
</span><span></span><span class="token" style="color:#5F6364">}</span><span>
</span>
<span></span><span class="token" style="color:#7D8B99">// hello</span><span>
</span><span></span><span class="token" style="color:#7D8B99">// world</span><span>
</span><span></span><span class="token" style="color:#7D8B99">// world</span><span>
</span><span></span><span class="token" style="color:#7D8B99">// hello</span><span>
</span><span></span><span class="token" style="color:#7D8B99">// hello</span><span>
</span><span></span><span class="token" style="color:#7D8B99">// world</span><span>
</span><span></span><span class="token" style="color:#7D8B99">// hello</span><span>
</span><span></span><span class="token" style="color:#7D8B99">// world</span><span>
</span><span></span><span class="token" style="color:#7D8B99">// world</span><span>
</span><span></span><span class="token" style="color:#7D8B99">// hello</span></code></pre><h1>channel</h1><p>channel 型は <code>&lt;-</code> を用いて値の送受信を行う。</p><pre style="color:black;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;position:relative;margin:.5em 0;overflow:visible;padding:0;background-color:#fdfdfd;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;margin-bottom:1em"><code class="language-go" style="color:black;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;max-height:inherit;height:inherit;padding:0 1em;display:block;overflow:auto"><span>ch </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">&lt;-</span><span> v </span><span class="token" style="color:#7D8B99">// v をチャネル ch に送信する</span><span>
</span><span>v </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">:=</span><span> </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">&lt;-</span><span> ch </span><span class="token" style="color:#7D8B99">// チャネル ch から変数を v に割り当てる</span></code></pre><p>チャネルは <code>make</code> で作る。</p><pre style="color:black;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;position:relative;margin:.5em 0;overflow:visible;padding:0;background-color:#fdfdfd;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;margin-bottom:1em"><code class="language-go" style="color:black;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;max-height:inherit;height:inherit;padding:0 1em;display:block;overflow:auto"><span>ch </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">:=</span><span> </span><span class="token" style="color:#2f9c0a">make</span><span class="token" style="color:#5F6364">(</span><span class="token" style="color:#1990b8">chan</span><span> </span><span class="token" style="color:#2f9c0a">int</span><span class="token" style="color:#5F6364">)</span></code></pre><p>通常、片方の準備ができるまで送受信はブロックされる。</p><pre style="color:black;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;position:relative;margin:.5em 0;overflow:visible;padding:0;background-color:#fdfdfd;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;margin-bottom:1em"><code class="language-go" style="color:black;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;max-height:inherit;height:inherit;padding:0 1em;display:block;overflow:auto"><span class="token" style="color:#1990b8">package</span><span> main
</span>
<span></span><span class="token" style="color:#1990b8">import</span><span> </span><span class="token" style="color:#2f9c0a">&quot;fmt&quot;</span><span>
</span>
<span></span><span class="token" style="color:#1990b8">func</span><span> </span><span class="token" style="color:#2f9c0a">sum</span><span class="token" style="color:#5F6364">(</span><span>s </span><span class="token" style="color:#5F6364">[</span><span class="token" style="color:#5F6364">]</span><span class="token" style="color:#2f9c0a">int</span><span class="token" style="color:#5F6364">,</span><span> c </span><span class="token" style="color:#1990b8">chan</span><span> </span><span class="token" style="color:#2f9c0a">int</span><span class="token" style="color:#5F6364">)</span><span> </span><span class="token" style="color:#5F6364">{</span><span>
</span><span>	sum </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">:=</span><span> </span><span class="token" style="color:#c92c2c">0</span><span>
</span><span>	</span><span class="token" style="color:#1990b8">for</span><span> </span><span class="token" style="color:#c92c2c">_</span><span class="token" style="color:#5F6364">,</span><span> v </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">:=</span><span> </span><span class="token" style="color:#1990b8">range</span><span> s </span><span class="token" style="color:#5F6364">{</span><span>
</span><span>		sum </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">+=</span><span> v
</span><span>	</span><span class="token" style="color:#5F6364">}</span><span>
</span><span>	c </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">&lt;-</span><span> sum
</span><span></span><span class="token" style="color:#5F6364">}</span><span>
</span>
<span></span><span class="token" style="color:#1990b8">func</span><span> </span><span class="token" style="color:#2f9c0a">main</span><span class="token" style="color:#5F6364">(</span><span class="token" style="color:#5F6364">)</span><span> </span><span class="token" style="color:#5F6364">{</span><span>
</span><span>	s </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">:=</span><span> </span><span class="token" style="color:#5F6364">[</span><span class="token" style="color:#5F6364">]</span><span class="token" style="color:#2f9c0a">int</span><span class="token" style="color:#5F6364">{</span><span class="token" style="color:#c92c2c">1</span><span class="token" style="color:#5F6364">,</span><span> </span><span class="token" style="color:#c92c2c">2</span><span class="token" style="color:#5F6364">,</span><span> </span><span class="token" style="color:#c92c2c">3</span><span class="token" style="color:#5F6364">,</span><span> </span><span class="token" style="color:#c92c2c">4</span><span class="token" style="color:#5F6364">,</span><span> </span><span class="token" style="color:#c92c2c">5</span><span class="token" style="color:#5F6364">,</span><span> </span><span class="token" style="color:#c92c2c">6</span><span class="token" style="color:#5F6364">,</span><span> </span><span class="token" style="color:#c92c2c">7</span><span class="token" style="color:#5F6364">,</span><span> </span><span class="token" style="color:#c92c2c">8</span><span class="token" style="color:#5F6364">,</span><span> </span><span class="token" style="color:#c92c2c">9</span><span class="token" style="color:#5F6364">,</span><span> </span><span class="token" style="color:#c92c2c">10</span><span class="token" style="color:#5F6364">}</span><span>
</span><span>	c </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">:=</span><span> </span><span class="token" style="color:#2f9c0a">make</span><span class="token" style="color:#5F6364">(</span><span class="token" style="color:#1990b8">chan</span><span> </span><span class="token" style="color:#2f9c0a">int</span><span class="token" style="color:#5F6364">)</span><span>
</span>
<span>	</span><span class="token" style="color:#1990b8">go</span><span> </span><span class="token" style="color:#2f9c0a">sum</span><span class="token" style="color:#5F6364">(</span><span>s</span><span class="token" style="color:#5F6364">[</span><span class="token" style="color:#5F6364">:</span><span class="token" style="color:#2f9c0a">len</span><span class="token" style="color:#5F6364">(</span><span>s</span><span class="token" style="color:#5F6364">)</span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">/</span><span class="token" style="color:#c92c2c">2</span><span class="token" style="color:#5F6364">]</span><span class="token" style="color:#5F6364">,</span><span> c</span><span class="token" style="color:#5F6364">)</span><span>
</span><span>	</span><span class="token" style="color:#1990b8">go</span><span> </span><span class="token" style="color:#2f9c0a">sum</span><span class="token" style="color:#5F6364">(</span><span>s</span><span class="token" style="color:#5F6364">[</span><span class="token" style="color:#2f9c0a">len</span><span class="token" style="color:#5F6364">(</span><span>s</span><span class="token" style="color:#5F6364">)</span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">/</span><span class="token" style="color:#c92c2c">2</span><span class="token" style="color:#5F6364">:</span><span class="token" style="color:#5F6364">]</span><span class="token" style="color:#5F6364">,</span><span> c</span><span class="token" style="color:#5F6364">)</span><span>
</span><span>	</span><span class="token" style="color:#1990b8">go</span><span> </span><span class="token" style="color:#2f9c0a">sum</span><span class="token" style="color:#5F6364">(</span><span>s</span><span class="token" style="color:#5F6364">,</span><span> c</span><span class="token" style="color:#5F6364">)</span><span>
</span>
<span>	x</span><span class="token" style="color:#5F6364">,</span><span> y </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">:=</span><span> </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">&lt;-</span><span>c</span><span class="token" style="color:#5F6364">,</span><span> </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">&lt;-</span><span>c
</span><span>	z </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">:=</span><span> </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">&lt;-</span><span>c
</span>
<span>	fmt</span><span class="token" style="color:#5F6364">.</span><span class="token" style="color:#2f9c0a">Println</span><span class="token" style="color:#5F6364">(</span><span>x</span><span class="token" style="color:#5F6364">,</span><span> y</span><span class="token" style="color:#5F6364">,</span><span> z</span><span class="token" style="color:#5F6364">)</span><span>
</span><span></span><span class="token" style="color:#5F6364">}</span><span>
</span>
<span></span><span class="token" style="color:#7D8B99">// 55 15 40</span><span>
</span><span></span><span class="token" style="color:#7D8B99">// 55 40 15</span><span>
</span><span></span><span class="token" style="color:#7D8B99">// 処理終わった順かな？</span></code></pre><h3>バッファ</h3><p>チャネルはバッファとして使える。 make の 2 つ目の引数にバッファの長さを指定できる。</p><pre style="color:black;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;position:relative;margin:.5em 0;overflow:visible;padding:0;background-color:#fdfdfd;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;margin-bottom:1em"><code class="language-go" style="color:black;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;max-height:inherit;height:inherit;padding:0 1em;display:block;overflow:auto"><span>ch </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">:=</span><span> </span><span class="token" style="color:#2f9c0a">make</span><span class="token" style="color:#5F6364">(</span><span class="token" style="color:#1990b8">chan</span><span> </span><span class="token" style="color:#2f9c0a">int</span><span class="token" style="color:#5F6364">,</span><span> </span><span class="token" style="color:#c92c2c">10</span><span class="token" style="color:#5F6364">)</span></code></pre><pre style="color:black;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;position:relative;margin:.5em 0;overflow:visible;padding:0;background-color:#fdfdfd;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;margin-bottom:1em"><code class="language-go" style="color:black;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;max-height:inherit;height:inherit;padding:0 1em;display:block;overflow:auto"><span class="token" style="color:#1990b8">package</span><span> main
</span>
<span></span><span class="token" style="color:#1990b8">import</span><span> </span><span class="token" style="color:#2f9c0a">&quot;fmt&quot;</span><span>
</span>
<span></span><span class="token" style="color:#1990b8">func</span><span> </span><span class="token" style="color:#2f9c0a">main</span><span class="token" style="color:#5F6364">(</span><span class="token" style="color:#5F6364">)</span><span> </span><span class="token" style="color:#5F6364">{</span><span>
</span><span>	ch </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">:=</span><span> </span><span class="token" style="color:#2f9c0a">make</span><span class="token" style="color:#5F6364">(</span><span class="token" style="color:#1990b8">chan</span><span> </span><span class="token" style="color:#2f9c0a">bool</span><span class="token" style="color:#5F6364">,</span><span> </span><span class="token" style="color:#c92c2c">2</span><span class="token" style="color:#5F6364">)</span><span>
</span><span>	ch </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">&lt;-</span><span> </span><span class="token" style="color:#c92c2c">true</span><span>
</span><span>	ch </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">&lt;-</span><span> </span><span class="token" style="color:#c92c2c">true</span><span>
</span><span>	v </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">:=</span><span> </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">&lt;-</span><span>ch
</span><span>	ch </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">&lt;-</span><span> </span><span class="token" style="color:#c92c2c">true</span><span>
</span><span>	</span><span class="token" style="color:#7D8B99">// ch &lt;- true // この行を入れると deadlock</span><span>
</span>
<span>	fmt</span><span class="token" style="color:#5F6364">.</span><span class="token" style="color:#2f9c0a">Println</span><span class="token" style="color:#5F6364">(</span><span class="token" style="color:#2f9c0a">len</span><span class="token" style="color:#5F6364">(</span><span>ch</span><span class="token" style="color:#5F6364">)</span><span class="token" style="color:#5F6364">)</span><span>
</span><span>	fmt</span><span class="token" style="color:#5F6364">.</span><span class="token" style="color:#2f9c0a">Println</span><span class="token" style="color:#5F6364">(</span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">&lt;-</span><span>ch</span><span class="token" style="color:#5F6364">)</span><span>
</span><span>	fmt</span><span class="token" style="color:#5F6364">.</span><span class="token" style="color:#2f9c0a">Println</span><span class="token" style="color:#5F6364">(</span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">&lt;-</span><span>ch</span><span class="token" style="color:#5F6364">)</span><span>
</span><span>	fmt</span><span class="token" style="color:#5F6364">.</span><span class="token" style="color:#2f9c0a">Println</span><span class="token" style="color:#5F6364">(</span><span>v</span><span class="token" style="color:#5F6364">)</span><span>
</span><span>	fmt</span><span class="token" style="color:#5F6364">.</span><span class="token" style="color:#2f9c0a">Println</span><span class="token" style="color:#5F6364">(</span><span class="token" style="color:#2f9c0a">len</span><span class="token" style="color:#5F6364">(</span><span>ch</span><span class="token" style="color:#5F6364">)</span><span class="token" style="color:#5F6364">)</span><span>
</span><span></span><span class="token" style="color:#5F6364">}</span><span>
</span>
<span></span><span class="token" style="color:#7D8B99">// 2</span><span>
</span><span></span><span class="token" style="color:#7D8B99">// true</span><span>
</span><span></span><span class="token" style="color:#7D8B99">// true</span><span>
</span><span></span><span class="token" style="color:#7D8B99">// true</span><span>
</span><span></span><span class="token" style="color:#7D8B99">// 0</span></code></pre><h3>close</h3><p>送信側はチャネルを <code>close</code> することができる。<br/>受信側はチャネルを <code>close</code> しているか確認できる。<br/>受信する値がない、かつチャネルが閉じているなら <code>ok</code> は <code>false</code> になる。</p><pre style="color:black;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;position:relative;margin:.5em 0;overflow:visible;padding:0;background-color:#fdfdfd;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;margin-bottom:1em"><code class="language-go" style="color:black;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;max-height:inherit;height:inherit;padding:0 1em;display:block;overflow:auto"><span>v</span><span class="token" style="color:#5F6364">,</span><span> ok </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">:=</span><span> </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">&lt;-</span><span> ch</span></code></pre><p>ループのときはチャネルを使うとチャネルが閉じるまで値を受信し続ける。</p><pre style="color:black;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;position:relative;margin:.5em 0;overflow:visible;padding:0;background-color:#fdfdfd;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;margin-bottom:1em"><code class="language-go" style="color:black;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;max-height:inherit;height:inherit;padding:0 1em;display:block;overflow:auto"><span class="token" style="color:#1990b8">package</span><span> main
</span>
<span></span><span class="token" style="color:#1990b8">import</span><span> </span><span class="token" style="color:#2f9c0a">&quot;fmt&quot;</span><span>
</span>
<span></span><span class="token" style="color:#1990b8">func</span><span> </span><span class="token" style="color:#2f9c0a">fibonacci</span><span class="token" style="color:#5F6364">(</span><span>n </span><span class="token" style="color:#2f9c0a">int</span><span class="token" style="color:#5F6364">,</span><span> c </span><span class="token" style="color:#1990b8">chan</span><span> </span><span class="token" style="color:#2f9c0a">int</span><span class="token" style="color:#5F6364">)</span><span> </span><span class="token" style="color:#5F6364">{</span><span>
</span><span>	x</span><span class="token" style="color:#5F6364">,</span><span> y </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">:=</span><span> </span><span class="token" style="color:#c92c2c">0</span><span class="token" style="color:#5F6364">,</span><span> </span><span class="token" style="color:#c92c2c">1</span><span>
</span><span>	</span><span class="token" style="color:#1990b8">for</span><span> i </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">:=</span><span> </span><span class="token" style="color:#c92c2c">0</span><span class="token" style="color:#5F6364">;</span><span> i </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">&lt;</span><span> n</span><span class="token" style="color:#5F6364">;</span><span> i</span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">++</span><span> </span><span class="token" style="color:#5F6364">{</span><span>
</span><span>		c </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">&lt;-</span><span> x
</span><span>		x</span><span class="token" style="color:#5F6364">,</span><span> y </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">=</span><span> y</span><span class="token" style="color:#5F6364">,</span><span> x</span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">+</span><span>y
</span><span>	</span><span class="token" style="color:#5F6364">}</span><span>
</span><span>	</span><span class="token" style="color:#2f9c0a">close</span><span class="token" style="color:#5F6364">(</span><span>c</span><span class="token" style="color:#5F6364">)</span><span>
</span><span></span><span class="token" style="color:#5F6364">}</span><span>
</span>
<span></span><span class="token" style="color:#1990b8">func</span><span> </span><span class="token" style="color:#2f9c0a">main</span><span class="token" style="color:#5F6364">(</span><span class="token" style="color:#5F6364">)</span><span> </span><span class="token" style="color:#5F6364">{</span><span>
</span><span>	c </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">:=</span><span> </span><span class="token" style="color:#2f9c0a">make</span><span class="token" style="color:#5F6364">(</span><span class="token" style="color:#1990b8">chan</span><span> </span><span class="token" style="color:#2f9c0a">int</span><span class="token" style="color:#5F6364">,</span><span> </span><span class="token" style="color:#c92c2c">10</span><span class="token" style="color:#5F6364">)</span><span>
</span><span>	</span><span class="token" style="color:#1990b8">go</span><span> </span><span class="token" style="color:#2f9c0a">fibonacci</span><span class="token" style="color:#5F6364">(</span><span class="token" style="color:#2f9c0a">cap</span><span class="token" style="color:#5F6364">(</span><span>c</span><span class="token" style="color:#5F6364">)</span><span class="token" style="color:#5F6364">,</span><span> c</span><span class="token" style="color:#5F6364">)</span><span>
</span><span>	</span><span class="token" style="color:#1990b8">for</span><span> i </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">:=</span><span> </span><span class="token" style="color:#1990b8">range</span><span> c </span><span class="token" style="color:#5F6364">{</span><span>
</span><span>		fmt</span><span class="token" style="color:#5F6364">.</span><span class="token" style="color:#2f9c0a">Println</span><span class="token" style="color:#5F6364">(</span><span>i</span><span class="token" style="color:#5F6364">)</span><span>
</span><span>	</span><span class="token" style="color:#5F6364">}</span><span>
</span><span></span><span class="token" style="color:#5F6364">}</span><span>
</span>
<span></span><span class="token" style="color:#7D8B99">// 0</span><span>
</span><span></span><span class="token" style="color:#7D8B99">// 1</span><span>
</span><span></span><span class="token" style="color:#7D8B99">// 1</span><span>
</span><span></span><span class="token" style="color:#7D8B99">// 2</span><span>
</span><span></span><span class="token" style="color:#7D8B99">// 3</span><span>
</span><span></span><span class="token" style="color:#7D8B99">// 5</span><span>
</span><span></span><span class="token" style="color:#7D8B99">// 8</span><span>
</span><span></span><span class="token" style="color:#7D8B99">// 13</span><span>
</span><span></span><span class="token" style="color:#7D8B99">// 21</span><span>
</span><span></span><span class="token" style="color:#7D8B99">// 34</span></code></pre><h2>select</h2><p><code>select</code> は goroutine を複数の通信操作で待たせる。<br/>case の準備ができるまでブロックする。複数の case が準備できている場合、 case はランダムに実行される。</p><pre style="color:black;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;position:relative;margin:.5em 0;overflow:visible;padding:0;background-color:#fdfdfd;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;margin-bottom:1em"><code class="language-go" style="color:black;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;max-height:inherit;height:inherit;padding:0 1em;display:block;overflow:auto"><span class="token" style="color:#1990b8">package</span><span> main
</span>
<span></span><span class="token" style="color:#1990b8">import</span><span> </span><span class="token" style="color:#2f9c0a">&quot;fmt&quot;</span><span>
</span>
<span></span><span class="token" style="color:#1990b8">func</span><span> </span><span class="token" style="color:#2f9c0a">fibonacci</span><span class="token" style="color:#5F6364">(</span><span>c</span><span class="token" style="color:#5F6364">,</span><span> quit </span><span class="token" style="color:#1990b8">chan</span><span> </span><span class="token" style="color:#2f9c0a">int</span><span class="token" style="color:#5F6364">)</span><span> </span><span class="token" style="color:#5F6364">{</span><span>
</span><span>	x</span><span class="token" style="color:#5F6364">,</span><span> y </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">:=</span><span> </span><span class="token" style="color:#c92c2c">0</span><span class="token" style="color:#5F6364">,</span><span> </span><span class="token" style="color:#c92c2c">1</span><span>
</span><span>	</span><span class="token" style="color:#1990b8">for</span><span> </span><span class="token" style="color:#5F6364">{</span><span>
</span><span>		</span><span class="token" style="color:#1990b8">select</span><span> </span><span class="token" style="color:#5F6364">{</span><span>
</span><span>		</span><span class="token" style="color:#1990b8">case</span><span> c </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">&lt;-</span><span> x</span><span class="token" style="color:#5F6364">:</span><span>
</span><span>			x</span><span class="token" style="color:#5F6364">,</span><span> y </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">=</span><span> y</span><span class="token" style="color:#5F6364">,</span><span> x</span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">+</span><span>y
</span><span>		</span><span class="token" style="color:#1990b8">case</span><span> </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">&lt;-</span><span>quit</span><span class="token" style="color:#5F6364">:</span><span>
</span><span>			fmt</span><span class="token" style="color:#5F6364">.</span><span class="token" style="color:#2f9c0a">Println</span><span class="token" style="color:#5F6364">(</span><span class="token" style="color:#2f9c0a">&quot;quit&quot;</span><span class="token" style="color:#5F6364">)</span><span>
</span><span>			</span><span class="token" style="color:#1990b8">return</span><span>
</span><span>		</span><span class="token" style="color:#5F6364">}</span><span>
</span><span>	</span><span class="token" style="color:#5F6364">}</span><span>
</span><span></span><span class="token" style="color:#5F6364">}</span><span>
</span>
<span></span><span class="token" style="color:#1990b8">func</span><span> </span><span class="token" style="color:#2f9c0a">main</span><span class="token" style="color:#5F6364">(</span><span class="token" style="color:#5F6364">)</span><span> </span><span class="token" style="color:#5F6364">{</span><span>
</span><span>	c </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">:=</span><span> </span><span class="token" style="color:#2f9c0a">make</span><span class="token" style="color:#5F6364">(</span><span class="token" style="color:#1990b8">chan</span><span> </span><span class="token" style="color:#2f9c0a">int</span><span class="token" style="color:#5F6364">)</span><span>
</span><span>	quit </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">:=</span><span> </span><span class="token" style="color:#2f9c0a">make</span><span class="token" style="color:#5F6364">(</span><span class="token" style="color:#1990b8">chan</span><span> </span><span class="token" style="color:#2f9c0a">int</span><span class="token" style="color:#5F6364">)</span><span>
</span>
<span>	</span><span class="token" style="color:#1990b8">go</span><span> </span><span class="token" style="color:#1990b8">func</span><span class="token" style="color:#5F6364">(</span><span class="token" style="color:#5F6364">)</span><span> </span><span class="token" style="color:#5F6364">{</span><span>
</span><span>		</span><span class="token" style="color:#1990b8">for</span><span> i </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">:=</span><span> </span><span class="token" style="color:#c92c2c">0</span><span class="token" style="color:#5F6364">;</span><span> i </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">&lt;</span><span> </span><span class="token" style="color:#c92c2c">10</span><span class="token" style="color:#5F6364">;</span><span> i</span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">++</span><span> </span><span class="token" style="color:#5F6364">{</span><span>
</span><span>			fmt</span><span class="token" style="color:#5F6364">.</span><span class="token" style="color:#2f9c0a">Println</span><span class="token" style="color:#5F6364">(</span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">&lt;-</span><span>c</span><span class="token" style="color:#5F6364">)</span><span>
</span><span>		</span><span class="token" style="color:#5F6364">}</span><span>
</span><span>		quit </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">&lt;-</span><span> </span><span class="token" style="color:#c92c2c">0</span><span>
</span><span>	</span><span class="token" style="color:#5F6364">}</span><span class="token" style="color:#5F6364">(</span><span class="token" style="color:#5F6364">)</span><span>
</span><span>	</span><span class="token" style="color:#2f9c0a">fibonacci</span><span class="token" style="color:#5F6364">(</span><span>c</span><span class="token" style="color:#5F6364">,</span><span> quit</span><span class="token" style="color:#5F6364">)</span><span>
</span><span></span><span class="token" style="color:#5F6364">}</span><span>
</span>
<span></span><span class="token" style="color:#7D8B99">// 0</span><span>
</span><span></span><span class="token" style="color:#7D8B99">// 1</span><span>
</span><span></span><span class="token" style="color:#7D8B99">// 1</span><span>
</span><span></span><span class="token" style="color:#7D8B99">// 2</span><span>
</span><span></span><span class="token" style="color:#7D8B99">// 3</span><span>
</span><span></span><span class="token" style="color:#7D8B99">// 5</span><span>
</span><span></span><span class="token" style="color:#7D8B99">// 8</span><span>
</span><span></span><span class="token" style="color:#7D8B99">// 13</span><span>
</span><span></span><span class="token" style="color:#7D8B99">// 21</span><span>
</span><span></span><span class="token" style="color:#7D8B99">// 34</span><span>
</span><span></span><span class="token" style="color:#7D8B99">// quit</span></code></pre><h3>default</h3><p>ブロックせずに送受信したいときには default を使う。</p><pre style="color:black;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;position:relative;margin:.5em 0;overflow:visible;padding:0;background-color:#fdfdfd;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;margin-bottom:1em"><code class="language-go" style="color:black;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;max-height:inherit;height:inherit;padding:0 1em;display:block;overflow:auto"><span class="token" style="color:#1990b8">package</span><span> main
</span>
<span></span><span class="token" style="color:#1990b8">import</span><span> </span><span class="token" style="color:#5F6364">(</span><span>
</span><span>	</span><span class="token" style="color:#2f9c0a">&quot;fmt&quot;</span><span>
</span><span>	</span><span class="token" style="color:#2f9c0a">&quot;time&quot;</span><span>
</span><span></span><span class="token" style="color:#5F6364">)</span><span>
</span>
<span></span><span class="token" style="color:#1990b8">func</span><span> </span><span class="token" style="color:#2f9c0a">main</span><span class="token" style="color:#5F6364">(</span><span class="token" style="color:#5F6364">)</span><span> </span><span class="token" style="color:#5F6364">{</span><span>
</span><span>	tick </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">:=</span><span> time</span><span class="token" style="color:#5F6364">.</span><span class="token" style="color:#2f9c0a">Tick</span><span class="token" style="color:#5F6364">(</span><span class="token" style="color:#c92c2c">100</span><span> </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">*</span><span> time</span><span class="token" style="color:#5F6364">.</span><span>Millisecond</span><span class="token" style="color:#5F6364">)</span><span>
</span><span>	boom </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">:=</span><span> time</span><span class="token" style="color:#5F6364">.</span><span class="token" style="color:#2f9c0a">Tick</span><span class="token" style="color:#5F6364">(</span><span class="token" style="color:#c92c2c">500</span><span> </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">*</span><span> time</span><span class="token" style="color:#5F6364">.</span><span>Millisecond</span><span class="token" style="color:#5F6364">)</span><span>
</span>
<span>	</span><span class="token" style="color:#1990b8">for</span><span> </span><span class="token" style="color:#5F6364">{</span><span>
</span><span>		</span><span class="token" style="color:#1990b8">select</span><span> </span><span class="token" style="color:#5F6364">{</span><span>
</span><span>		</span><span class="token" style="color:#1990b8">case</span><span> </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">&lt;-</span><span>tick</span><span class="token" style="color:#5F6364">:</span><span>
</span><span>			fmt</span><span class="token" style="color:#5F6364">.</span><span class="token" style="color:#2f9c0a">Println</span><span class="token" style="color:#5F6364">(</span><span class="token" style="color:#2f9c0a">&quot;tick&quot;</span><span class="token" style="color:#5F6364">)</span><span>
</span><span>		</span><span class="token" style="color:#1990b8">case</span><span> </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">&lt;-</span><span>boom</span><span class="token" style="color:#5F6364">:</span><span>
</span><span>			fmt</span><span class="token" style="color:#5F6364">.</span><span class="token" style="color:#2f9c0a">Println</span><span class="token" style="color:#5F6364">(</span><span class="token" style="color:#2f9c0a">&quot;boom&quot;</span><span class="token" style="color:#5F6364">)</span><span>
</span><span>			</span><span class="token" style="color:#1990b8">return</span><span>
</span><span>		</span><span class="token" style="color:#1990b8">default</span><span class="token" style="color:#5F6364">:</span><span>
</span><span>			fmt</span><span class="token" style="color:#5F6364">.</span><span class="token" style="color:#2f9c0a">Println</span><span class="token" style="color:#5F6364">(</span><span class="token" style="color:#2f9c0a">&quot;   .&quot;</span><span class="token" style="color:#5F6364">)</span><span>
</span><span>			time</span><span class="token" style="color:#5F6364">.</span><span class="token" style="color:#2f9c0a">Sleep</span><span class="token" style="color:#5F6364">(</span><span class="token" style="color:#c92c2c">50</span><span> </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">*</span><span> time</span><span class="token" style="color:#5F6364">.</span><span>Millisecond</span><span class="token" style="color:#5F6364">)</span><span>
</span><span>		</span><span class="token" style="color:#5F6364">}</span><span>
</span><span>	</span><span class="token" style="color:#5F6364">}</span><span>
</span><span></span><span class="token" style="color:#5F6364">}</span><span>
</span>
<span></span><span class="token" style="color:#7D8B99">//    .</span><span>
</span><span></span><span class="token" style="color:#7D8B99">//    .</span><span>
</span><span></span><span class="token" style="color:#7D8B99">// tick</span><span>
</span><span></span><span class="token" style="color:#7D8B99">//    .</span><span>
</span><span></span><span class="token" style="color:#7D8B99">//    .</span><span>
</span><span></span><span class="token" style="color:#7D8B99">// tick</span><span>
</span><span></span><span class="token" style="color:#7D8B99">//    .</span><span>
</span><span></span><span class="token" style="color:#7D8B99">//    .</span><span>
</span><span></span><span class="token" style="color:#7D8B99">// tick</span><span>
</span><span></span><span class="token" style="color:#7D8B99">//    .</span><span>
</span><span></span><span class="token" style="color:#7D8B99">//    .</span><span>
</span><span></span><span class="token" style="color:#7D8B99">// tick</span><span>
</span><span></span><span class="token" style="color:#7D8B99">//    .</span><span>
</span><span></span><span class="token" style="color:#7D8B99">//    .</span><span>
</span><span></span><span class="token" style="color:#7D8B99">// boom</span></code></pre><h2>sync.Mutex</h2><p>コンフリクトを避け、 1 度に 1 つの goroutine だけが変数にアクセスできる。<br/>Golang の標準パッケージは、排他制御を <code>sync.Mutex</code> と <code>Lock</code> 、 <code>Unlock</code> で提供している。</p><pre style="color:black;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;position:relative;margin:.5em 0;overflow:visible;padding:0;background-color:#fdfdfd;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;margin-bottom:1em"><code class="language-go" style="color:black;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;max-height:inherit;height:inherit;padding:0 1em;display:block;overflow:auto"><span class="token" style="color:#1990b8">package</span><span> main
</span>
<span></span><span class="token" style="color:#1990b8">import</span><span> </span><span class="token" style="color:#5F6364">(</span><span>
</span><span>	</span><span class="token" style="color:#2f9c0a">&quot;fmt&quot;</span><span>
</span><span>	</span><span class="token" style="color:#2f9c0a">&quot;sync&quot;</span><span>
</span><span>	</span><span class="token" style="color:#2f9c0a">&quot;time&quot;</span><span>
</span><span></span><span class="token" style="color:#5F6364">)</span><span>
</span>
<span></span><span class="token" style="color:#1990b8">type</span><span> SafeCounter </span><span class="token" style="color:#1990b8">struct</span><span> </span><span class="token" style="color:#5F6364">{</span><span>
</span><span>	mu sync</span><span class="token" style="color:#5F6364">.</span><span>Mutex
</span><span>	v  </span><span class="token" style="color:#1990b8">map</span><span class="token" style="color:#5F6364">[</span><span class="token" style="color:#2f9c0a">string</span><span class="token" style="color:#5F6364">]</span><span class="token" style="color:#2f9c0a">int</span><span>
</span><span></span><span class="token" style="color:#5F6364">}</span><span>
</span>
<span></span><span class="token" style="color:#1990b8">func</span><span> </span><span class="token" style="color:#5F6364">(</span><span>c </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">*</span><span>SafeCounter</span><span class="token" style="color:#5F6364">)</span><span> </span><span class="token" style="color:#2f9c0a">Inc</span><span class="token" style="color:#5F6364">(</span><span>key </span><span class="token" style="color:#2f9c0a">string</span><span class="token" style="color:#5F6364">)</span><span> </span><span class="token" style="color:#5F6364">{</span><span>
</span><span>	c</span><span class="token" style="color:#5F6364">.</span><span>mu</span><span class="token" style="color:#5F6364">.</span><span class="token" style="color:#2f9c0a">Lock</span><span class="token" style="color:#5F6364">(</span><span class="token" style="color:#5F6364">)</span><span>
</span><span>	c</span><span class="token" style="color:#5F6364">.</span><span>v</span><span class="token" style="color:#5F6364">[</span><span>key</span><span class="token" style="color:#5F6364">]</span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">++</span><span>
</span><span>	c</span><span class="token" style="color:#5F6364">.</span><span>mu</span><span class="token" style="color:#5F6364">.</span><span class="token" style="color:#2f9c0a">Unlock</span><span class="token" style="color:#5F6364">(</span><span class="token" style="color:#5F6364">)</span><span>
</span><span></span><span class="token" style="color:#5F6364">}</span><span>
</span>
<span></span><span class="token" style="color:#1990b8">func</span><span> </span><span class="token" style="color:#5F6364">(</span><span>c </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">*</span><span>SafeCounter</span><span class="token" style="color:#5F6364">)</span><span> </span><span class="token" style="color:#2f9c0a">Value</span><span class="token" style="color:#5F6364">(</span><span>key </span><span class="token" style="color:#2f9c0a">string</span><span class="token" style="color:#5F6364">)</span><span> </span><span class="token" style="color:#2f9c0a">int</span><span> </span><span class="token" style="color:#5F6364">{</span><span>
</span><span>	c</span><span class="token" style="color:#5F6364">.</span><span>mu</span><span class="token" style="color:#5F6364">.</span><span class="token" style="color:#2f9c0a">Lock</span><span class="token" style="color:#5F6364">(</span><span class="token" style="color:#5F6364">)</span><span>
</span><span>	</span><span class="token" style="color:#1990b8">defer</span><span> c</span><span class="token" style="color:#5F6364">.</span><span>mu</span><span class="token" style="color:#5F6364">.</span><span class="token" style="color:#2f9c0a">Unlock</span><span class="token" style="color:#5F6364">(</span><span class="token" style="color:#5F6364">)</span><span>
</span><span>	</span><span class="token" style="color:#1990b8">return</span><span> c</span><span class="token" style="color:#5F6364">.</span><span>v</span><span class="token" style="color:#5F6364">[</span><span>key</span><span class="token" style="color:#5F6364">]</span><span>
</span><span></span><span class="token" style="color:#5F6364">}</span><span>
</span>
<span></span><span class="token" style="color:#1990b8">func</span><span> </span><span class="token" style="color:#2f9c0a">main</span><span class="token" style="color:#5F6364">(</span><span class="token" style="color:#5F6364">)</span><span> </span><span class="token" style="color:#5F6364">{</span><span>
</span><span>	c </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">:=</span><span> SafeCounter</span><span class="token" style="color:#5F6364">{</span><span>
</span><span>		v</span><span class="token" style="color:#5F6364">:</span><span> </span><span class="token" style="color:#2f9c0a">make</span><span class="token" style="color:#5F6364">(</span><span class="token" style="color:#1990b8">map</span><span class="token" style="color:#5F6364">[</span><span class="token" style="color:#2f9c0a">string</span><span class="token" style="color:#5F6364">]</span><span class="token" style="color:#2f9c0a">int</span><span class="token" style="color:#5F6364">)</span><span class="token" style="color:#5F6364">,</span><span>
</span><span>	</span><span class="token" style="color:#5F6364">}</span><span>
</span>
<span>	</span><span class="token" style="color:#1990b8">for</span><span> i </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">:=</span><span> </span><span class="token" style="color:#c92c2c">0</span><span class="token" style="color:#5F6364">;</span><span> i </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">&lt;</span><span> </span><span class="token" style="color:#c92c2c">1000</span><span class="token" style="color:#5F6364">;</span><span> i</span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">++</span><span> </span><span class="token" style="color:#5F6364">{</span><span>
</span><span>		</span><span class="token" style="color:#1990b8">go</span><span> c</span><span class="token" style="color:#5F6364">.</span><span class="token" style="color:#2f9c0a">Inc</span><span class="token" style="color:#5F6364">(</span><span class="token" style="color:#2f9c0a">&quot;somekey&quot;</span><span class="token" style="color:#5F6364">)</span><span>
</span><span>	</span><span class="token" style="color:#5F6364">}</span><span>
</span><span>	time</span><span class="token" style="color:#5F6364">.</span><span class="token" style="color:#2f9c0a">Sleep</span><span class="token" style="color:#5F6364">(</span><span>time</span><span class="token" style="color:#5F6364">.</span><span>Second</span><span class="token" style="color:#5F6364">)</span><span>
</span><span>	fmt</span><span class="token" style="color:#5F6364">.</span><span class="token" style="color:#2f9c0a">Println</span><span class="token" style="color:#5F6364">(</span><span>c</span><span class="token" style="color:#5F6364">.</span><span class="token" style="color:#2f9c0a">Value</span><span class="token" style="color:#5F6364">(</span><span class="token" style="color:#2f9c0a">&quot;somekey&quot;</span><span class="token" style="color:#5F6364">)</span><span class="token" style="color:#5F6364">)</span><span>
</span><span></span><span class="token" style="color:#5F6364">}</span><span>
</span>
<span></span><span class="token" style="color:#7D8B99">// 1000</span></code></pre><div><p><a href="/">TOPへ戻る</a></p></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"articleData":{"id":"20210429010135","contentHtml":"\n## goroutine\ngoroutine は軽量なスレッド。\n```go\ngo f(x, y)\n```\nと書くだけ。\n\n```go\npackage main\n\nimport (\n\t\"fmt\"\n\t\"time\"\n)\n\nfunc say(s string) {\n\tfor i := 0; i \u003c 5; i++ {\n\t\ttime.Sleep(100 * time.Millisecond)\n\t\tfmt.Println(s)\n\t}\n}\n\nfunc main() {\n\tgo say(\"hello\")\n\tsay(\"world\")\n}\n\n// hello\n// world\n// world\n// hello\n// hello\n// world\n// hello\n// world\n// world\n// hello\n```\n\n# channel\nchannel 型は `\u003c-` を用いて値の送受信を行う。\n```go\nch \u003c- v // v をチャネル ch に送信する\nv := \u003c- ch // チャネル ch から変数を v に割り当てる\n```\n\nチャネルは `make` で作る。\n```go\nch := make(chan int)\n```\n通常、片方の準備ができるまで送受信はブロックされる。\n\n```go\npackage main\n\nimport \"fmt\"\n\nfunc sum(s []int, c chan int) {\n\tsum := 0\n\tfor _, v := range s {\n\t\tsum += v\n\t}\n\tc \u003c- sum\n}\n\nfunc main() {\n\ts := []int{1, 2, 3, 4, 5, 6, 7, 8, 9, 10}\n\tc := make(chan int)\n\n\tgo sum(s[:len(s)/2], c)\n\tgo sum(s[len(s)/2:], c)\n\tgo sum(s, c)\n\n\tx, y := \u003c-c, \u003c-c\n\tz := \u003c-c\n\n\tfmt.Println(x, y, z)\n}\n\n// 55 15 40\n// 55 40 15\n// 処理終わった順かな？\n```\n\n### バッファ\nチャネルはバッファとして使える。 make の 2 つ目の引数にバッファの長さを指定できる。\n```go\nch := make(chan int, 10)\n```\n\n```go\npackage main\n\nimport \"fmt\"\n\nfunc main() {\n\tch := make(chan bool, 2)\n\tch \u003c- true\n\tch \u003c- true\n\tv := \u003c-ch\n\tch \u003c- true\n\t// ch \u003c- true // この行を入れると deadlock\n\n\tfmt.Println(len(ch))\n\tfmt.Println(\u003c-ch)\n\tfmt.Println(\u003c-ch)\n\tfmt.Println(v)\n\tfmt.Println(len(ch))\n}\n\n// 2\n// true\n// true\n// true\n// 0\n```\n\n### close\n送信側はチャネルを `close` することができる。  \n受信側はチャネルを `close` しているか確認できる。  \n受信する値がない、かつチャネルが閉じているなら `ok` は `false` になる。\n```go\nv, ok := \u003c- ch\n```\n\nループのときはチャネルを使うとチャネルが閉じるまで値を受信し続ける。\n```go\npackage main\n\nimport \"fmt\"\n\nfunc fibonacci(n int, c chan int) {\n\tx, y := 0, 1\n\tfor i := 0; i \u003c n; i++ {\n\t\tc \u003c- x\n\t\tx, y = y, x+y\n\t}\n\tclose(c)\n}\n\nfunc main() {\n\tc := make(chan int, 10)\n\tgo fibonacci(cap(c), c)\n\tfor i := range c {\n\t\tfmt.Println(i)\n\t}\n}\n\n// 0\n// 1\n// 1\n// 2\n// 3\n// 5\n// 8\n// 13\n// 21\n// 34\n```\n\n## select\n`select` は goroutine を複数の通信操作で待たせる。  \ncase の準備ができるまでブロックする。複数の case が準備できている場合、 case はランダムに実行される。\n```go\npackage main\n\nimport \"fmt\"\n\nfunc fibonacci(c, quit chan int) {\n\tx, y := 0, 1\n\tfor {\n\t\tselect {\n\t\tcase c \u003c- x:\n\t\t\tx, y = y, x+y\n\t\tcase \u003c-quit:\n\t\t\tfmt.Println(\"quit\")\n\t\t\treturn\n\t\t}\n\t}\n}\n\nfunc main() {\n\tc := make(chan int)\n\tquit := make(chan int)\n\n\tgo func() {\n\t\tfor i := 0; i \u003c 10; i++ {\n\t\t\tfmt.Println(\u003c-c)\n\t\t}\n\t\tquit \u003c- 0\n\t}()\n\tfibonacci(c, quit)\n}\n\n// 0\n// 1\n// 1\n// 2\n// 3\n// 5\n// 8\n// 13\n// 21\n// 34\n// quit\n```\n\n### default\nブロックせずに送受信したいときには default を使う。\n```go\npackage main\n\nimport (\n\t\"fmt\"\n\t\"time\"\n)\n\nfunc main() {\n\ttick := time.Tick(100 * time.Millisecond)\n\tboom := time.Tick(500 * time.Millisecond)\n\n\tfor {\n\t\tselect {\n\t\tcase \u003c-tick:\n\t\t\tfmt.Println(\"tick\")\n\t\tcase \u003c-boom:\n\t\t\tfmt.Println(\"boom\")\n\t\t\treturn\n\t\tdefault:\n\t\t\tfmt.Println(\"   .\")\n\t\t\ttime.Sleep(50 * time.Millisecond)\n\t\t}\n\t}\n}\n\n//    .\n//    .\n// tick\n//    .\n//    .\n// tick\n//    .\n//    .\n// tick\n//    .\n//    .\n// tick\n//    .\n//    .\n// boom\n```\n\n## sync.Mutex\nコンフリクトを避け、 1 度に 1 つの goroutine だけが変数にアクセスできる。  \nGolang の標準パッケージは、排他制御を `sync.Mutex` と `Lock` 、 `Unlock` で提供している。\n```go\npackage main\n\nimport (\n\t\"fmt\"\n\t\"sync\"\n\t\"time\"\n)\n\ntype SafeCounter struct {\n\tmu sync.Mutex\n\tv  map[string]int\n}\n\nfunc (c *SafeCounter) Inc(key string) {\n\tc.mu.Lock()\n\tc.v[key]++\n\tc.mu.Unlock()\n}\n\nfunc (c *SafeCounter) Value(key string) int {\n\tc.mu.Lock()\n\tdefer c.mu.Unlock()\n\treturn c.v[key]\n}\n\nfunc main() {\n\tc := SafeCounter{\n\t\tv: make(map[string]int),\n\t}\n\n\tfor i := 0; i \u003c 1000; i++ {\n\t\tgo c.Inc(\"somekey\")\n\t}\n\ttime.Sleep(time.Second)\n\tfmt.Println(c.Value(\"somekey\"))\n}\n\n// 1000\n```\n","title":"Golang の goroutine / channel とか","date":20210429010135,"tags":["Golang"]}},"__N_SSG":true},"page":"/articles/[id]","query":{"id":"20210429010135"},"buildId":"8VPh2w0QwyWiuxlWI8Hxt","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-8f31809deb7932dd0187.js"></script><script src="/_next/static/chunks/main-f7ca7a935b246c4edd14.js" async=""></script><script src="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" async=""></script><script src="/_next/static/chunks/framework.d2e6186d001d2275b0af.js" async=""></script><script src="/_next/static/chunks/commons.b2562460c774f5a57980.js" async=""></script><script src="/_next/static/chunks/pages/_app-b63af2e2dfcc0bffd9c0.js" async=""></script><script src="/_next/static/chunks/c5b568cee8545d966ddc8d89f9063461e084494a.c564a02921d697744263.js" async=""></script><script src="/_next/static/chunks/pages/articles/%5Bid%5D-565d4c3adc05a3ed7d91.js" async=""></script><script src="/_next/static/8VPh2w0QwyWiuxlWI8Hxt/_buildManifest.js" async=""></script><script src="/_next/static/8VPh2w0QwyWiuxlWI8Hxt/_ssgManifest.js" async=""></script></body></html>