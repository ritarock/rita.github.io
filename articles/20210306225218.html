<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>MyDocs</title><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/css/dd1d8e71a2aa8e7e10f5.css" as="style"/><link rel="stylesheet" href="/_next/static/css/dd1d8e71a2aa8e7e10f5.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/webpack-189c53927ffd3caf09c3.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework-2f612445bd50b211f15a.js" as="script"/><link rel="preload" href="/_next/static/chunks/main-c8b51cc0a92c3008cd1b.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-7163558e7d92093a94d2.js" as="script"/><link rel="preload" href="/_next/static/chunks/996-109927db333074874af4.js" as="script"/><link rel="preload" href="/_next/static/chunks/394-1ac6c205f84cbd1b2925.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/articles/%5Bid%5D-6ddac1fc6283bcb21133.js" as="script"/></head><body><div id="__next"><div><div><div class="bg-gray-600 h-10 leading-10 text-2xl"><a class="no-underline text-gray-100 mx-2" href="/">MyDocs</a></div></div><div class="mx-7"><h1><b># <!-- -->Docker と docker-compose のまとめ</b></h1><h2>Docker</h2>
<h2>build</h2>
<p>Dockerfile が存在するディレクトリで実行。</p>
<pre><div class="text-xs" node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-bash" style="white-space:pre"><span>$ docker build .</span></code></div></pre>
<p><em><strong>-f</strong></em> オプションを付けることでパスを指定できる。</p>
<pre><div class="text-xs" node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-bash" style="white-space:pre"><span>$ docker build -f /path/to/Dockerfile .</span></code></div></pre>
<p><em><strong>-t</strong></em> オプションを付けることでリポジトリとタグを指定できる。</p>
<pre><div class="text-xs" node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-bash" style="white-space:pre"><span>$ docker build -t shukes/myapp .</span></code></div></pre>
<h2>FROM</h2>
<p>ベースイメージを指定。</p>
<pre><div class="text-xs" node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-Dockerfile" style="white-space:pre"><span>FROM &lt;image&gt;[:&lt;tag&gt;][AS &lt;name&gt;]</span></code></div></pre>
<h2>RUN</h2>
<p>シェルとして実行される。</p>
<pre><div class="text-xs" node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-Dockerfile" style="white-space:pre"><span>RUN </span><span style="color:#bf79db">/bin/</span><span>bash -c </span><span style="color:#a6e22e">&#x27;source $HOME/.bashrc;&#x27;</span><span> \
</span><span>echo </span><span style="color:#a6e22e">$HOME</span></code></div></pre>
<p>1 行で書く場合。</p>
<pre><div class="text-xs" node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-Dockerfile" style="white-space:pre"><span>RUN </span><span style="color:#bf79db">/bin/</span><span>bash -c </span><span style="color:#a6e22e">&#x27;source $HOME/.bashrc; echo $HOME&#x27;</span></code></div></pre>
<p><em><strong>/bash/sh</strong></em> 以外の別のシェルを使う場合は exec 形式でシェルに引数を渡す。</p>
<pre><div class="text-xs" node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-Dockerfile" style="white-space:pre"><span>RUN [</span><span style="color:#a6e22e">&quot;/bin/bash&quot;</span><span>, </span><span style="color:#a6e22e">&quot;-c&quot;</span><span>, </span><span style="color:#a6e22e">&quot;echo hello&quot;</span><span>]</span></code></div></pre>
<p>exec 形式で書く場合は json 配列として扱われるので <em><strong>&quot;&quot;</strong></em> で囲む必要がある。</p>
<h2>CMD</h2>
<p>Dockerfile 内で CMD 命令は 1 つのみ。
複数あっても最後の CMD 命令のみが実行される。</p>
<p><strong>CMD の主目的はコンテナ実行時のデフォルト処理を指定する</strong></p>
<pre><div class="text-xs" node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-Dockerfile" style="white-space:pre"><span>FROM ubuntu
</span><span>CMD [</span><span style="color:#a6e22e">&quot;/usr/bin/wc&quot;</span><span>, </span><span style="color:#a6e22e">&quot;--help&quot;</span><span>]</span></code></div></pre>
<h2>ADD / COPY</h2>
<p><em><strong>&lt;src&gt;</strong></em> で指定したファイル、ディレクトリをコンテナ内の <em><strong>&lt;dest&gt;</strong></em> にコピーする。</p>
<p>ADD はリモートファイルをコピー可能で圧縮ファイルの解凍する。</p>
<pre><div class="text-xs" node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-bash" style="white-space:pre"><span>ADD &lt;src&gt; &lt;dest&gt;
</span>COPY &lt;src&gt; &lt;dest&gt;
</code></div></pre>
<h2>docker-compose</h2>
<h2>build</h2>
<p>構築時のオプションを指定。</p>
<pre><div class="text-xs" node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-yml" style="white-space:pre"><span style="color:#bf79db">version:</span><span> </span><span style="color:#a6e22e">&quot;3.8&quot;</span><span>
</span><span></span><span style="color:#bf79db">services:</span><span>
</span><span></span><span style="color:#bf79db">  webapp:</span><span>
</span><span></span><span style="color:#bf79db">  build:</span><span> ./dir</span></code></div></pre>
<p><em><strong>context</strong></em> で <em><strong>Dockerfile</strong></em> や <em><strong>args</strong></em> を指定できる。</p>
<pre><div class="text-xs" node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-yml" style="white-space:pre"><span style="color:#bf79db">version:</span><span> </span><span style="color:#a6e22e">&quot;3.8&quot;</span><span>
</span><span></span><span style="color:#bf79db">services:</span><span>
</span><span></span><span style="color:#bf79db">  webapp:</span><span>
</span><span></span><span style="color:#bf79db">    build:</span><span>
</span><span></span><span style="color:#bf79db">      context:</span><span> ./dir
</span><span></span><span style="color:#bf79db">      dockerfile:</span><span> Dockerfile-alternate
</span><span></span><span style="color:#bf79db">      args:</span><span>
</span><span></span><span style="color:#bf79db">        buildno:</span><span> </span><span class="hljs-number">1</span></code></div></pre>
<p><em><strong>image</strong></em> を指定してイメージ名とタグをアタッチできる。</p>
<p>イメージ名が webapp 、タグが tag の場合。</p>
<pre><div class="text-xs" node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-yml" style="white-space:pre"><span style="color:#bf79db">build:</span><span> ./dir
</span><span></span><span style="color:#bf79db">image:</span><span> webapp:tag</span></code></div></pre>
<h3>context</h3>
<p>Dockerfile を含むディレクトリかリポジトリ URL を指定する。</p>
<pre><div class="text-xs" node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-yml" style="white-space:pre"><span style="color:#bf79db">build:</span><span>
</span><span></span><span style="color:#bf79db">  context:</span><span> ./dir</span></code></div></pre>
<h3>dockerfile</h3>
<p>別の Dockerfile を指定する。ビルドパスと同時に指定する必要がある。</p>
<pre><div class="text-xs" node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-yml" style="white-space:pre"><span style="color:#bf79db">build:</span><span>
</span><span></span><span style="color:#bf79db">  context:</span><span> .
</span><span></span><span style="color:#bf79db">  dockerfile:</span><span> Dockerfile-alternate</span></code></div></pre>
<h3>args</h3>
<p>ビルド引数を追加する。環境変数となりビルド処理の間のみ使用される。
Dockerfile 内ではじめにビルド引数を指定する。</p>
<pre><div class="text-xs" node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-yml" style="white-space:pre"><span style="color:#f92672;font-weight:bold">ARG</span><span> buildno
</span><span></span><span style="color:#f92672;font-weight:bold">ARG</span><span> gitcommithash
</span>
<span></span><span style="color:#f92672;font-weight:bold">RUN</span><span class="bash"> </span><span class="bash" style="color:#a6e22e">echo</span><span class="bash"> </span><span class="bash" style="color:#a6e22e">&quot;Build number: </span><span class="bash" style="color:#a6e22e">$buildno</span><span class="bash" style="color:#a6e22e">&quot;</span><span>
</span><span></span><span style="color:#f92672;font-weight:bold">RUN</span><span class="bash"> </span><span class="bash" style="color:#a6e22e">echo</span><span class="bash"> </span><span class="bash" style="color:#a6e22e">&quot;Based on commit: </span><span class="bash" style="color:#a6e22e">$gitcommithash</span><span class="bash" style="color:#a6e22e">&quot;</span></code></div></pre>
<p><em><strong>build</strong></em> キーをもとにその引数を指定する。</p>
<p>個々をマッピングするか、リスト形式で書く。
ブール値の場合はクォートで囲む必要がある。</p>
<pre><div class="text-xs" node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-yml" style="white-space:pre"><span style="color:#bf79db">build:</span><span>
</span><span></span><span style="color:#bf79db">  context:</span><span> .
</span><span></span><span style="color:#bf79db">  args:</span><span>
</span><span></span><span style="color:#bf79db">    build:</span><span> </span><span class="hljs-number">1</span><span>
</span><span></span><span style="color:#bf79db">    gitcommithash:</span><span> cdc3b19</span></code></div></pre>
<pre><div class="text-xs" node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-yml" style="white-space:pre"><span>build:
</span>  context: .
<!-- -->  args:
<span>    - </span><span class="hljs-attr">buildno</span><span>=</span><span class="hljs-number">1</span><span>
</span><span>    - </span><span class="hljs-attr">gitcommithash</span><span>=cdc3b19</span></code></div></pre>
<h2>command</h2>
<p>デフォルトコマンドを上書きする。</p>
<pre><div class="text-xs" node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-yml" style="white-space:pre"><span style="color:#a6e22e">command</span><span>: build </span><span style="color:#a6e22e">exec</span><span> thin -p 3000</span></code></div></pre>
<p>Dockerfile と同じリスト形式でも書ける。</p>
<pre><div class="text-xs" node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-yml" style="white-space:pre"><span>command: [</span><span style="color:#a6e22e">&quot;build&quot;</span><span>, </span><span style="color:#a6e22e">&quot;exec&quot;</span><span>, </span><span style="color:#a6e22e">&quot;thin&quot;</span><span>, </span><span style="color:#a6e22e">&quot;-p&quot;</span><span>, </span><span style="color:#a6e22e">&quot;3000&quot;</span><span>]</span></code></div></pre>
<h2>depends_on</h2>
<p>サービス間の依存関係を表す。
<em><strong>docker-compose up</strong></em> は依存関係順にサービスを起動する。</p>
<p>以下の場合だと、 db と Redis を起動したあとに web を起動する。</p>
<pre><div class="text-xs" node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-yml" style="white-space:pre"><span style="color:#bf79db">version:</span><span> </span><span style="color:#a6e22e">&quot;3.8&quot;</span><span>
</span><span></span><span style="color:#bf79db">services:</span><span>
</span><span></span><span style="color:#bf79db">  web:</span><span>
</span><span></span><span style="color:#bf79db">    build:</span><span> .
</span><span></span><span style="color:#bf79db">    depends_on:</span><span>
</span>      - db
<!-- -->      - redis
<span></span><span style="color:#bf79db">  redis:</span><span>
</span><span></span><span style="color:#bf79db">    image:</span><span> redis
</span><span></span><span style="color:#bf79db">  db:</span><span>
</span><span></span><span style="color:#bf79db">    image:</span><span> postgres</span></code></div></pre>
<h2>environment</h2>
<p>環境変数を追加する。</p>
<pre><div class="text-xs" node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-yml" style="white-space:pre"><span style="color:#bf79db">environment:</span><span>
</span><span></span><span style="color:#bf79db">  RACK_ENV:</span><span> development
</span><span></span><span style="color:#bf79db">  SHOW:</span><span> </span><span style="color:#a6e22e">&#x27;true&#x27;</span></code></div></pre>
<pre><div class="text-xs" node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-yml" style="white-space:pre"><span>environment:
</span><span>  - </span><span class="hljs-attr">RACK_ENV</span><span>=development
</span><span>  - </span><span class="hljs-attr">SHOW</span><span>=</span><span style="color:#a6e22e">&#x27;true&#x27;</span></code></div></pre>
<h2>expose</h2>
<p>ホストマシンにはポートを公開せずにポートを expose する。
リンクされたサービスのみアクセス可能になる。内部のポートのみ指定可能。</p>
<pre><div class="text-xs" node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-yml" style="white-space:pre"><span>expose:
</span><span>  -</span><span class="ruby"> </span><span class="ruby" style="color:#a6e22e">&quot;3000&quot;</span><span class="ruby">
</span><span class="ruby"></span><span>  -</span><span class="ruby"> </span><span class="ruby" style="color:#a6e22e">&quot;8000&quot;</span></code></div></pre>
<h2>ports</h2>
<p>公開用のポートを指定する。</p>
<p>ホスト側とコンテナ側のポートを指定する( <em><strong>HOST:CONTAINER</strong></em> )。
もしくは、コンテナ側のポートを指定する。</p>
<pre><div class="text-xs" node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-yml" style="white-space:pre"><span style="color:#bf79db">ports</span><span>:
</span><span>  - &quot;</span><span style="color:#bf79db">3000</span><span style="color:#a6e22e">&quot;
</span><span style="color:#a6e22e">  - &quot;</span><span class="hljs-number">3000</span><span>-</span><span class="hljs-number">3005</span><span style="color:#a6e22e">&quot;
</span><span style="color:#a6e22e">  - &quot;</span><span class="hljs-number">8000</span><span>:</span><span class="hljs-number">8000</span><span style="color:#a6e22e">&quot;
</span><span style="color:#a6e22e">  - &quot;</span><span class="hljs-number">9090</span><span>-</span><span class="hljs-number">9091</span><span>:</span><span class="hljs-number">8080</span><span>-</span><span class="hljs-number">8081</span><span style="color:#a6e22e">&quot;
</span><span style="color:#a6e22e">  - &quot;</span><span class="hljs-number">49100</span><span>:</span><span class="hljs-number">22</span><span style="color:#a6e22e">&quot;
</span><span style="color:#a6e22e">  - &quot;</span><span class="hljs-number">127.0.0.1:8001</span><span>:</span><span class="hljs-number">8001</span><span style="color:#a6e22e">&quot;
</span><span style="color:#a6e22e">  - &quot;</span><span class="hljs-number">127.0.0.1:5000</span><span>-</span><span class="hljs-number">5010</span><span>:</span><span class="hljs-number">5000</span><span>-</span><span class="hljs-number">5010</span><span style="color:#a6e22e">&quot;
</span><span style="color:#a6e22e">  - &quot;</span><span class="hljs-number">6060</span><span>:</span><span class="hljs-number">6060</span><span>/udp</span><span style="color:#a6e22e">&quot;
</span><span style="color:#a6e22e">  - &quot;</span><span class="hljs-number">12400</span><span>-</span><span class="hljs-number">12500</span><span>:</span><span class="hljs-number">1240</span><span style="color:#a6e22e">&quot;</span></code></div></pre>
<p>追加項目がある場合。</p>
<pre><div class="text-xs" node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-yml" style="white-space:pre"><span class="hljs-attr">ports:</span><span>
</span><span>  </span><span style="color:#a6e22e">-</span><span> </span><span class="hljs-attr">target:</span><span> </span><span class="hljs-number">80</span><span>
</span><span>    </span><span class="hljs-attr">published:</span><span> </span><span class="hljs-number">8080</span><span>
</span><span>    </span><span class="hljs-attr">protocol:</span><span> </span><span style="color:#a6e22e">tcp</span><span>
</span><span>    </span><span class="hljs-attr">mode:</span><span> </span><span style="color:#a6e22e">host</span></code></div></pre>
<h2>links</h2>
<p>他のサービスのコンテナをリンクさせる。
リンクされたコンテナは、ホスト名より到達可能になる。</p>
<pre><div class="text-xs" node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-yml" style="white-space:pre"><span>web:
</span>  links:
<span>    -</span><span class="ruby"> </span><span class="ruby" style="color:#a6e22e">&quot;db&quot;</span><span class="ruby">
</span><span class="ruby"></span><span>    -</span><span class="ruby"> </span><span class="ruby" style="color:#a6e22e">&quot;db:database&quot;</span><span class="ruby">
</span><span class="ruby"></span><span>    -</span><span class="ruby"> </span><span class="ruby" style="color:#a6e22e">&quot;redis&quot;</span></code></div></pre>
<h2>volumes</h2>
<pre><div class="text-xs" node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-yml" style="white-space:pre"><span style="color:#bf79db">version:</span><span> </span><span style="color:#a6e22e">&quot;3.8&quot;</span><span>
</span><span></span><span style="color:#bf79db">services:</span><span>
</span><span></span><span style="color:#bf79db">  web:</span><span>
</span><span></span><span style="color:#bf79db">    image:</span><span> nginx:alpine
</span><span></span><span style="color:#bf79db">    volumes:</span><span>
</span>      - type: volume
<span></span><span style="color:#bf79db">        source:</span><span> mydata
</span><span></span><span style="color:#bf79db">        target:</span><span> /data
</span><span></span><span style="color:#bf79db">        volume:</span><span>
</span><span></span><span style="color:#bf79db">          nocopy:</span><span> true
</span>      - type: bind
<span></span><span style="color:#bf79db">        source:</span><span> ./static
</span><span></span><span style="color:#bf79db">        target:</span><span> </span><span class="hljs-meta-keyword">/opt/</span><span>app/static
</span><span></span><span style="color:#bf79db">  db:</span><span>
</span><span></span><span style="color:#bf79db">    image:</span><span> postgres:latest
</span><span></span><span style="color:#bf79db">    volumes:</span><span>
</span><span>      - </span><span style="color:#a6e22e">&quot;/var/run/postgres.sock:/var/run/postgres/postgres.sock&quot;</span><span>
</span><span>      - </span><span style="color:#a6e22e">&quot;dbdata:/var/lib/postgresql/data&quot;</span><span>
</span><span></span><span style="color:#bf79db">volumes:</span><span>
</span><span></span><span style="color:#bf79db">  mydata:</span><span>
</span><span></span><span style="color:#bf79db">  database:</span></code></div></pre>
<p>短い書き方では <em><strong>[SOURCE:]TARGET[:MODE]</strong></em> と書ける。</p>
<p>ro は readonly 。</p>
<pre><div class="text-xs" node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-yml" style="white-space:pre"><span>- ./cache:</span><span style="color:#bf79db">/tmp/</span><span>cache:ro</span></code></div></pre>
<h2>変数の置換</h2>
<p>シェル環境に <em><strong>POSTGRES_VERSION=9.3</strong></em> が定義されていると postgres のバージョンは 9.3 になる。</p>
<pre><div class="text-xs" node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-yml" style="white-space:pre"><span style="color:#bf79db">db:</span><span>
</span><span></span><span style="color:#bf79db">  image:</span><span> </span><span style="color:#a6e22e">&quot;postgres:${POSTGRES_VERSION}&quot;</span></code></div></pre>
<p>環境変数が何も設定されていない場合は空文字になる。
環境変数のデフォルト値は <em><strong>.env</strong></em> ファイルに設定しておくことができる。</p>
<ul>
<li>${VARIABLE:-default} は VARIABLE がセットされていないか空文字のときに <em><strong>default</strong></em> として評価される</li>
<li>${VARIABLE-default} は VARIABLE がセットされていないときのみ <em><strong>default</strong></em> として評価される</li>
</ul></div><br/></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"data":{"id":"20210306225218","fileContents":"{\n  \"title\": \"Docker と docker-compose のまとめ\",\n  \"date\": 20210306225218,\n  \"tags\": [\n    \"docker\"\n  ],\n  \"bodyContent\": \"## Docker\\n## build\\nDockerfile が存在するディレクトリで実行。\\n```bash\\n$ docker build .\\n```\\n\\n***-f*** オプションを付けることでパスを指定できる。\\n```bash\\n$ docker build -f /path/to/Dockerfile .\\n```\\n\\n***-t*** オプションを付けることでリポジトリとタグを指定できる。\\n```bash\\n$ docker build -t shukes/myapp .\\n```\\n\\n## FROM\\nベースイメージを指定。\\n```Dockerfile\\nFROM \u003cimage\u003e[:\u003ctag\u003e][AS \u003cname\u003e]\\n```\\n\\n## RUN\\nシェルとして実行される。\\n```Dockerfile\\nRUN /bin/bash -c 'source $HOME/.bashrc;' \\\\\\necho $HOME\\n```\\n\\n1 行で書く場合。\\n```Dockerfile\\nRUN /bin/bash -c 'source $HOME/.bashrc; echo $HOME'\\n```\\n\\n***/bash/sh*** 以外の別のシェルを使う場合は exec 形式でシェルに引数を渡す。\\n```Dockerfile\\nRUN [\\\"/bin/bash\\\", \\\"-c\\\", \\\"echo hello\\\"]\\n```\\n\\nexec 形式で書く場合は json 配列として扱われるので ***\\\"\\\"*** で囲む必要がある。\\n\\n## CMD\\nDockerfile 内で CMD 命令は 1 つのみ。\\n複数あっても最後の CMD 命令のみが実行される。\\n\\n**CMD の主目的はコンテナ実行時のデフォルト処理を指定する**\\n```Dockerfile\\nFROM ubuntu\\nCMD [\\\"/usr/bin/wc\\\", \\\"--help\\\"]\\n```\\n\\n## ADD / COPY\\n***\u003csrc\u003e*** で指定したファイル、ディレクトリをコンテナ内の ***\u003cdest\u003e*** にコピーする。\\n\\nADD はリモートファイルをコピー可能で圧縮ファイルの解凍する。\\n```bash\\nADD \u003csrc\u003e \u003cdest\u003e\\nCOPY \u003csrc\u003e \u003cdest\u003e\\n```\\n\\n## docker-compose\\n## build\\n構築時のオプションを指定。\\n```yml\\nversion: \\\"3.8\\\"\\nservices:\\n  webapp:\\n  build: ./dir\\n```\\n\\n***context*** で ***Dockerfile*** や ***args*** を指定できる。\\n```yml\\nversion: \\\"3.8\\\"\\nservices:\\n  webapp:\\n    build:\\n      context: ./dir\\n      dockerfile: Dockerfile-alternate\\n      args:\\n        buildno: 1\\n```\\n\\n***image*** を指定してイメージ名とタグをアタッチできる。\\n\\nイメージ名が webapp 、タグが tag の場合。\\n```yml\\nbuild: ./dir\\nimage: webapp:tag\\n```\\n\\n### context\\nDockerfile を含むディレクトリかリポジトリ URL を指定する。\\n```yml\\nbuild:\\n  context: ./dir\\n```\\n\\n### dockerfile\\n別の Dockerfile を指定する。ビルドパスと同時に指定する必要がある。\\n```yml\\nbuild:\\n  context: .\\n  dockerfile: Dockerfile-alternate\\n```\\n\\n### args\\nビルド引数を追加する。環境変数となりビルド処理の間のみ使用される。\\nDockerfile 内ではじめにビルド引数を指定する。\\n```yml\\nARG buildno\\nARG gitcommithash\\n\\nRUN echo \\\"Build number: $buildno\\\"\\nRUN echo \\\"Based on commit: $gitcommithash\\\"\\n```\\n\\n***build*** キーをもとにその引数を指定する。\\n\\n個々をマッピングするか、リスト形式で書く。\\nブール値の場合はクォートで囲む必要がある。\\n```yml\\nbuild:\\n  context: .\\n  args:\\n    build: 1\\n    gitcommithash: cdc3b19\\n```\\n\\n```yml\\nbuild:\\n  context: .\\n  args:\\n    - buildno=1\\n    - gitcommithash=cdc3b19\\n```\\n\\n## command\\nデフォルトコマンドを上書きする。\\n```yml\\ncommand: build exec thin -p 3000\\n```\\n\\nDockerfile と同じリスト形式でも書ける。\\n```yml\\ncommand: [\\\"build\\\", \\\"exec\\\", \\\"thin\\\", \\\"-p\\\", \\\"3000\\\"]\\n```\\n\\n## depends_on\\nサービス間の依存関係を表す。\\n***docker-compose up*** は依存関係順にサービスを起動する。\\n\\n以下の場合だと、 db と Redis を起動したあとに web を起動する。\\n```yml\\nversion: \\\"3.8\\\"\\nservices:\\n  web:\\n    build: .\\n    depends_on:\\n      - db\\n      - redis\\n  redis:\\n    image: redis\\n  db:\\n    image: postgres\\n```\\n\\n## environment\\n環境変数を追加する。\\n```yml\\nenvironment:\\n  RACK_ENV: development\\n  SHOW: 'true'\\n```\\n\\n```yml\\nenvironment:\\n  - RACK_ENV=development\\n  - SHOW='true'\\n```\\n\\n## expose\\nホストマシンにはポートを公開せずにポートを expose する。\\nリンクされたサービスのみアクセス可能になる。内部のポートのみ指定可能。\\n```yml\\nexpose:\\n  - \\\"3000\\\"\\n  - \\\"8000\\\"\\n```\\n\\n## ports\\n公開用のポートを指定する。\\n\\nホスト側とコンテナ側のポートを指定する( ***HOST:CONTAINER*** )。\\nもしくは、コンテナ側のポートを指定する。\\n```yml\\nports:\\n  - \\\"3000\\\"\\n  - \\\"3000-3005\\\"\\n  - \\\"8000:8000\\\"\\n  - \\\"9090-9091:8080-8081\\\"\\n  - \\\"49100:22\\\"\\n  - \\\"127.0.0.1:8001:8001\\\"\\n  - \\\"127.0.0.1:5000-5010:5000-5010\\\"\\n  - \\\"6060:6060/udp\\\"\\n  - \\\"12400-12500:1240\\\"\\n```\\n\\n追加項目がある場合。\\n```yml\\nports:\\n  - target: 80\\n    published: 8080\\n    protocol: tcp\\n    mode: host\\n```\\n\\n## links\\n他のサービスのコンテナをリンクさせる。\\nリンクされたコンテナは、ホスト名より到達可能になる。\\n```yml\\nweb:\\n  links:\\n    - \\\"db\\\"\\n    - \\\"db:database\\\"\\n    - \\\"redis\\\"\\n```\\n\\n## volumes\\n```yml\\nversion: \\\"3.8\\\"\\nservices:\\n  web:\\n    image: nginx:alpine\\n    volumes:\\n      - type: volume\\n        source: mydata\\n        target: /data\\n        volume:\\n          nocopy: true\\n      - type: bind\\n        source: ./static\\n        target: /opt/app/static\\n  db:\\n    image: postgres:latest\\n    volumes:\\n      - \\\"/var/run/postgres.sock:/var/run/postgres/postgres.sock\\\"\\n      - \\\"dbdata:/var/lib/postgresql/data\\\"\\nvolumes:\\n  mydata:\\n  database:\\n```\\n\\n短い書き方では ***[SOURCE:]TARGET[:MODE]*** と書ける。\\n\\nro は readonly 。\\n```yml\\n- ./cache:/tmp/cache:ro\\n```\\n\\n## 変数の置換\\nシェル環境に ***POSTGRES_VERSION=9.3*** が定義されていると postgres のバージョンは 9.3 になる。\\n```yml\\ndb:\\n  image: \\\"postgres:${POSTGRES_VERSION}\\\"\\n```\\n\\n環境変数が何も設定されていない場合は空文字になる。\\n環境変数のデフォルト値は ***.env*** ファイルに設定しておくことができる。\\n- ${VARIABLE:-default} は VARIABLE がセットされていないか空文字のときに ***default*** として評価される\\n- ${VARIABLE-default} は VARIABLE がセットされていないときのみ ***default*** として評価される\",\n  \"bodyHtml\": \"\u003ch2\u003eDocker\u003c/h2\u003e\\n\u003ch2\u003ebuild\u003c/h2\u003e\\n\u003cp\u003eDockerfile が存在するディレクトリで実行。\u003c/p\u003e\\n\u003cpre\u003e\u003ccode class=\\\"hljs\\\"\u003e$ docker build .\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cem\u003e\u003cstrong\u003e-f\u003c/strong\u003e\u003c/em\u003e オプションを付けることでパスを指定できる。\u003c/p\u003e\\n\u003cpre\u003e\u003ccode class=\\\"hljs\\\"\u003e$ docker build -f /path/to/Dockerfile .\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cem\u003e\u003cstrong\u003e-t\u003c/strong\u003e\u003c/em\u003e オプションを付けることでリポジトリとタグを指定できる。\u003c/p\u003e\\n\u003cpre\u003e\u003ccode class=\\\"hljs\\\"\u003e$ docker build -t shukes/myapp .\u003c/code\u003e\u003c/pre\u003e\u003ch2\u003eFROM\u003c/h2\u003e\\n\u003cp\u003eベースイメージを指定。\u003c/p\u003e\\n\u003cpre\u003e\u003ccode class=\\\"hljs\\\"\u003e\u003cspan class=\\\"hljs-keyword\\\"\u003eFROM\u003c/span\u003e \u0026lt;image\u0026gt;[:\u0026lt;tag\u0026gt;][AS \u0026lt;name\u0026gt;]\u003c/code\u003e\u003c/pre\u003e\u003ch2\u003eRUN\u003c/h2\u003e\\n\u003cp\u003eシェルとして実行される。\u003c/p\u003e\\n\u003cpre\u003e\u003ccode class=\\\"hljs\\\"\u003e\u003cspan class=\\\"hljs-keyword\\\"\u003eRUN\u003c/span\u003e\u003cspan class=\\\"bash\\\"\u003e /bin/bash -c \u003cspan class=\\\"hljs-string\\\"\u003e\u0026#x27;source $HOME/.bashrc;\u0026#x27;\u003c/span\u003e \\\\\\n\u003cspan class=\\\"hljs-built_in\\\"\u003eecho\u003c/span\u003e \u003cspan class=\\\"hljs-variable\\\"\u003e$HOME\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e1 行で書く場合。\u003c/p\u003e\\n\u003cpre\u003e\u003ccode class=\\\"hljs\\\"\u003e\u003cspan class=\\\"hljs-keyword\\\"\u003eRUN\u003c/span\u003e\u003cspan class=\\\"bash\\\"\u003e /bin/bash -c \u003cspan class=\\\"hljs-string\\\"\u003e\u0026#x27;source $HOME/.bashrc; echo $HOME\u0026#x27;\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cem\u003e\u003cstrong\u003e/bash/sh\u003c/strong\u003e\u003c/em\u003e 以外の別のシェルを使う場合は exec 形式でシェルに引数を渡す。\u003c/p\u003e\\n\u003cpre\u003e\u003ccode class=\\\"hljs\\\"\u003e\u003cspan class=\\\"hljs-keyword\\\"\u003eRUN\u003c/span\u003e\u003cspan class=\\\"bash\\\"\u003e [\u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;/bin/bash\u0026quot;\u003c/span\u003e, \u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;-c\u0026quot;\u003c/span\u003e, \u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;echo hello\u0026quot;\u003c/span\u003e]\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eexec 形式で書く場合は json 配列として扱われるので \u003cem\u003e\u003cstrong\u003e\u0026quot;\u0026quot;\u003c/strong\u003e\u003c/em\u003e で囲む必要がある。\u003c/p\u003e\\n\u003ch2\u003eCMD\u003c/h2\u003e\\n\u003cp\u003eDockerfile 内で CMD 命令は 1 つのみ。\\n複数あっても最後の CMD 命令のみが実行される。\u003c/p\u003e\\n\u003cp\u003e\u003cstrong\u003eCMD の主目的はコンテナ実行時のデフォルト処理を指定する\u003c/strong\u003e\u003c/p\u003e\\n\u003cpre\u003e\u003ccode class=\\\"hljs\\\"\u003e\u003cspan class=\\\"hljs-keyword\\\"\u003eFROM\u003c/span\u003e ubuntu\\n\u003cspan class=\\\"hljs-keyword\\\"\u003eCMD\u003c/span\u003e\u003cspan class=\\\"bash\\\"\u003e [\u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;/usr/bin/wc\u0026quot;\u003c/span\u003e, \u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;--help\u0026quot;\u003c/span\u003e]\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003ch2\u003eADD / COPY\u003c/h2\u003e\\n\u003cp\u003e\u003cem\u003e\u003cstrong\u003e\u0026lt;src\u0026gt;\u003c/strong\u003e\u003c/em\u003e で指定したファイル、ディレクトリをコンテナ内の \u003cem\u003e\u003cstrong\u003e\u0026lt;dest\u0026gt;\u003c/strong\u003e\u003c/em\u003e にコピーする。\u003c/p\u003e\\n\u003cp\u003eADD はリモートファイルをコピー可能で圧縮ファイルの解凍する。\u003c/p\u003e\\n\u003cpre\u003e\u003ccode class=\\\"hljs\\\"\u003eADD \u0026lt;src\u0026gt; \u0026lt;dest\u0026gt;\\nCOPY \u0026lt;src\u0026gt; \u0026lt;dest\u0026gt;\u003c/code\u003e\u003c/pre\u003e\u003ch2\u003edocker-compose\u003c/h2\u003e\\n\u003ch2\u003ebuild\u003c/h2\u003e\\n\u003cp\u003e構築時のオプションを指定。\u003c/p\u003e\\n\u003cpre\u003e\u003ccode class=\\\"hljs\\\"\u003e\u003cspan class=\\\"hljs-attr\\\"\u003eversion:\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;3.8\u0026quot;\u003c/span\u003e\\n\u003cspan class=\\\"hljs-attr\\\"\u003eservices:\u003c/span\u003e\\n  \u003cspan class=\\\"hljs-attr\\\"\u003ewebapp:\u003c/span\u003e\\n  \u003cspan class=\\\"hljs-attr\\\"\u003ebuild:\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003e./dir\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cem\u003e\u003cstrong\u003econtext\u003c/strong\u003e\u003c/em\u003e で \u003cem\u003e\u003cstrong\u003eDockerfile\u003c/strong\u003e\u003c/em\u003e や \u003cem\u003e\u003cstrong\u003eargs\u003c/strong\u003e\u003c/em\u003e を指定できる。\u003c/p\u003e\\n\u003cpre\u003e\u003ccode class=\\\"hljs\\\"\u003e\u003cspan class=\\\"hljs-attr\\\"\u003eversion:\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;3.8\u0026quot;\u003c/span\u003e\\n\u003cspan class=\\\"hljs-attr\\\"\u003eservices:\u003c/span\u003e\\n  \u003cspan class=\\\"hljs-attr\\\"\u003ewebapp:\u003c/span\u003e\\n    \u003cspan class=\\\"hljs-attr\\\"\u003ebuild:\u003c/span\u003e\\n      \u003cspan class=\\\"hljs-attr\\\"\u003econtext:\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003e./dir\u003c/span\u003e\\n      \u003cspan class=\\\"hljs-attr\\\"\u003edockerfile:\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003eDockerfile-alternate\u003c/span\u003e\\n      \u003cspan class=\\\"hljs-attr\\\"\u003eargs:\u003c/span\u003e\\n        \u003cspan class=\\\"hljs-attr\\\"\u003ebuildno:\u003c/span\u003e \u003cspan class=\\\"hljs-number\\\"\u003e1\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cem\u003e\u003cstrong\u003eimage\u003c/strong\u003e\u003c/em\u003e を指定してイメージ名とタグをアタッチできる。\u003c/p\u003e\\n\u003cp\u003eイメージ名が webapp 、タグが tag の場合。\u003c/p\u003e\\n\u003cpre\u003e\u003ccode class=\\\"hljs\\\"\u003e\u003cspan class=\\\"hljs-attr\\\"\u003ebuild:\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003e./dir\u003c/span\u003e\\n\u003cspan class=\\\"hljs-attr\\\"\u003eimage:\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003ewebapp:tag\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003ch3\u003econtext\u003c/h3\u003e\\n\u003cp\u003eDockerfile を含むディレクトリかリポジトリ URL を指定する。\u003c/p\u003e\\n\u003cpre\u003e\u003ccode class=\\\"hljs\\\"\u003e\u003cspan class=\\\"hljs-attr\\\"\u003ebuild:\u003c/span\u003e\\n  \u003cspan class=\\\"hljs-attr\\\"\u003econtext:\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003e./dir\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003ch3\u003edockerfile\u003c/h3\u003e\\n\u003cp\u003e別の Dockerfile を指定する。ビルドパスと同時に指定する必要がある。\u003c/p\u003e\\n\u003cpre\u003e\u003ccode class=\\\"hljs\\\"\u003e\u003cspan class=\\\"hljs-attr\\\"\u003ebuild:\u003c/span\u003e\\n  \u003cspan class=\\\"hljs-attr\\\"\u003econtext:\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003e.\u003c/span\u003e\\n  \u003cspan class=\\\"hljs-attr\\\"\u003edockerfile:\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003eDockerfile-alternate\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003ch3\u003eargs\u003c/h3\u003e\\n\u003cp\u003eビルド引数を追加する。環境変数となりビルド処理の間のみ使用される。\\nDockerfile 内ではじめにビルド引数を指定する。\u003c/p\u003e\\n\u003cpre\u003e\u003ccode class=\\\"hljs\\\"\u003eARG buildno\\nARG gitcommithash\\n\\nRUN echo \u0026quot;Build number: $buildno\u0026quot;\\nRUN echo \u0026quot;Based on commit: $gitcommithash\u0026quot;\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cem\u003e\u003cstrong\u003ebuild\u003c/strong\u003e\u003c/em\u003e キーをもとにその引数を指定する。\u003c/p\u003e\\n\u003cp\u003e個々をマッピングするか、リスト形式で書く。\\nブール値の場合はクォートで囲む必要がある。\u003c/p\u003e\\n\u003cpre\u003e\u003ccode class=\\\"hljs\\\"\u003e\u003cspan class=\\\"hljs-attr\\\"\u003ebuild:\u003c/span\u003e\\n  \u003cspan class=\\\"hljs-attr\\\"\u003econtext:\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003e.\u003c/span\u003e\\n  \u003cspan class=\\\"hljs-attr\\\"\u003eargs:\u003c/span\u003e\\n    \u003cspan class=\\\"hljs-attr\\\"\u003ebuild:\u003c/span\u003e \u003cspan class=\\\"hljs-number\\\"\u003e1\u003c/span\u003e\\n    \u003cspan class=\\\"hljs-attr\\\"\u003egitcommithash:\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003ecdc3b19\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\\\"hljs\\\"\u003e\u003cspan class=\\\"hljs-attr\\\"\u003ebuild:\u003c/span\u003e\\n  \u003cspan class=\\\"hljs-attr\\\"\u003econtext:\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003e.\u003c/span\u003e\\n  \u003cspan class=\\\"hljs-attr\\\"\u003eargs:\u003c/span\u003e\\n    \u003cspan class=\\\"hljs-bullet\\\"\u003e-\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003ebuildno=1\u003c/span\u003e\\n    \u003cspan class=\\\"hljs-bullet\\\"\u003e-\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003egitcommithash=cdc3b19\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003ch2\u003ecommand\u003c/h2\u003e\\n\u003cp\u003eデフォルトコマンドを上書きする。\u003c/p\u003e\\n\u003cpre\u003e\u003ccode class=\\\"hljs\\\"\u003e\u003cspan class=\\\"hljs-attr\\\"\u003ecommand:\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003ebuild\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003eexec\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003ethin\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003e-p\u003c/span\u003e \u003cspan class=\\\"hljs-number\\\"\u003e3000\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eDockerfile と同じリスト形式でも書ける。\u003c/p\u003e\\n\u003cpre\u003e\u003ccode class=\\\"hljs\\\"\u003e\u003cspan class=\\\"hljs-attr\\\"\u003ecommand:\u003c/span\u003e [\u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;build\u0026quot;\u003c/span\u003e, \u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;exec\u0026quot;\u003c/span\u003e, \u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;thin\u0026quot;\u003c/span\u003e, \u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;-p\u0026quot;\u003c/span\u003e, \u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;3000\u0026quot;\u003c/span\u003e]\u003c/code\u003e\u003c/pre\u003e\u003ch2\u003edepends_on\u003c/h2\u003e\\n\u003cp\u003eサービス間の依存関係を表す。\\n\u003cem\u003e\u003cstrong\u003edocker-compose up\u003c/strong\u003e\u003c/em\u003e は依存関係順にサービスを起動する。\u003c/p\u003e\\n\u003cp\u003e以下の場合だと、 db と Redis を起動したあとに web を起動する。\u003c/p\u003e\\n\u003cpre\u003e\u003ccode class=\\\"hljs\\\"\u003e\u003cspan class=\\\"hljs-attr\\\"\u003eversion:\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;3.8\u0026quot;\u003c/span\u003e\\n\u003cspan class=\\\"hljs-attr\\\"\u003eservices:\u003c/span\u003e\\n  \u003cspan class=\\\"hljs-attr\\\"\u003eweb:\u003c/span\u003e\\n    \u003cspan class=\\\"hljs-attr\\\"\u003ebuild:\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003e.\u003c/span\u003e\\n    \u003cspan class=\\\"hljs-attr\\\"\u003edepends_on:\u003c/span\u003e\\n      \u003cspan class=\\\"hljs-bullet\\\"\u003e-\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003edb\u003c/span\u003e\\n      \u003cspan class=\\\"hljs-bullet\\\"\u003e-\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003eredis\u003c/span\u003e\\n  \u003cspan class=\\\"hljs-attr\\\"\u003eredis:\u003c/span\u003e\\n    \u003cspan class=\\\"hljs-attr\\\"\u003eimage:\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003eredis\u003c/span\u003e\\n  \u003cspan class=\\\"hljs-attr\\\"\u003edb:\u003c/span\u003e\\n    \u003cspan class=\\\"hljs-attr\\\"\u003eimage:\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003epostgres\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003ch2\u003eenvironment\u003c/h2\u003e\\n\u003cp\u003e環境変数を追加する。\u003c/p\u003e\\n\u003cpre\u003e\u003ccode class=\\\"hljs\\\"\u003e\u003cspan class=\\\"hljs-attr\\\"\u003eenvironment:\u003c/span\u003e\\n  \u003cspan class=\\\"hljs-attr\\\"\u003eRACK_ENV:\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003edevelopment\u003c/span\u003e\\n  \u003cspan class=\\\"hljs-attr\\\"\u003eSHOW:\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003e\u0026#x27;true\u0026#x27;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\\\"hljs\\\"\u003e\u003cspan class=\\\"hljs-attr\\\"\u003eenvironment:\u003c/span\u003e\\n  \u003cspan class=\\\"hljs-bullet\\\"\u003e-\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003eRACK_ENV=development\u003c/span\u003e\\n  \u003cspan class=\\\"hljs-bullet\\\"\u003e-\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003eSHOW=\u0026#x27;true\u0026#x27;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003ch2\u003eexpose\u003c/h2\u003e\\n\u003cp\u003eホストマシンにはポートを公開せずにポートを expose する。\\nリンクされたサービスのみアクセス可能になる。内部のポートのみ指定可能。\u003c/p\u003e\\n\u003cpre\u003e\u003ccode class=\\\"hljs\\\"\u003e\u003cspan class=\\\"hljs-attr\\\"\u003eexpose:\u003c/span\u003e\\n  \u003cspan class=\\\"hljs-bullet\\\"\u003e-\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;3000\u0026quot;\u003c/span\u003e\\n  \u003cspan class=\\\"hljs-bullet\\\"\u003e-\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;8000\u0026quot;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003ch2\u003eports\u003c/h2\u003e\\n\u003cp\u003e公開用のポートを指定する。\u003c/p\u003e\\n\u003cp\u003eホスト側とコンテナ側のポートを指定する( \u003cem\u003e\u003cstrong\u003eHOST:CONTAINER\u003c/strong\u003e\u003c/em\u003e )。\\nもしくは、コンテナ側のポートを指定する。\u003c/p\u003e\\n\u003cpre\u003e\u003ccode class=\\\"hljs\\\"\u003e\u003cspan class=\\\"hljs-attr\\\"\u003eports:\u003c/span\u003e\\n  \u003cspan class=\\\"hljs-bullet\\\"\u003e-\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;3000\u0026quot;\u003c/span\u003e\\n  \u003cspan class=\\\"hljs-bullet\\\"\u003e-\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;3000-3005\u0026quot;\u003c/span\u003e\\n  \u003cspan class=\\\"hljs-bullet\\\"\u003e-\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;8000:8000\u0026quot;\u003c/span\u003e\\n  \u003cspan class=\\\"hljs-bullet\\\"\u003e-\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;9090-9091:8080-8081\u0026quot;\u003c/span\u003e\\n  \u003cspan class=\\\"hljs-bullet\\\"\u003e-\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;49100:22\u0026quot;\u003c/span\u003e\\n  \u003cspan class=\\\"hljs-bullet\\\"\u003e-\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;127.0.0.1:8001:8001\u0026quot;\u003c/span\u003e\\n  \u003cspan class=\\\"hljs-bullet\\\"\u003e-\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;127.0.0.1:5000-5010:5000-5010\u0026quot;\u003c/span\u003e\\n  \u003cspan class=\\\"hljs-bullet\\\"\u003e-\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;6060:6060/udp\u0026quot;\u003c/span\u003e\\n  \u003cspan class=\\\"hljs-bullet\\\"\u003e-\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;12400-12500:1240\u0026quot;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e追加項目がある場合。\u003c/p\u003e\\n\u003cpre\u003e\u003ccode class=\\\"hljs\\\"\u003e\u003cspan class=\\\"hljs-attr\\\"\u003eports:\u003c/span\u003e\\n  \u003cspan class=\\\"hljs-bullet\\\"\u003e-\u003c/span\u003e \u003cspan class=\\\"hljs-attr\\\"\u003etarget:\u003c/span\u003e \u003cspan class=\\\"hljs-number\\\"\u003e80\u003c/span\u003e\\n    \u003cspan class=\\\"hljs-attr\\\"\u003epublished:\u003c/span\u003e \u003cspan class=\\\"hljs-number\\\"\u003e8080\u003c/span\u003e\\n    \u003cspan class=\\\"hljs-attr\\\"\u003eprotocol:\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003etcp\u003c/span\u003e\\n    \u003cspan class=\\\"hljs-attr\\\"\u003emode:\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003ehost\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003ch2\u003elinks\u003c/h2\u003e\\n\u003cp\u003e他のサービスのコンテナをリンクさせる。\\nリンクされたコンテナは、ホスト名より到達可能になる。\u003c/p\u003e\\n\u003cpre\u003e\u003ccode class=\\\"hljs\\\"\u003e\u003cspan class=\\\"hljs-attr\\\"\u003eweb:\u003c/span\u003e\\n  \u003cspan class=\\\"hljs-attr\\\"\u003elinks:\u003c/span\u003e\\n    \u003cspan class=\\\"hljs-bullet\\\"\u003e-\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;db\u0026quot;\u003c/span\u003e\\n    \u003cspan class=\\\"hljs-bullet\\\"\u003e-\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;db:database\u0026quot;\u003c/span\u003e\\n    \u003cspan class=\\\"hljs-bullet\\\"\u003e-\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;redis\u0026quot;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003ch2\u003evolumes\u003c/h2\u003e\\n\u003cpre\u003e\u003ccode class=\\\"hljs\\\"\u003e\u003cspan class=\\\"hljs-attr\\\"\u003eversion:\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;3.8\u0026quot;\u003c/span\u003e\\n\u003cspan class=\\\"hljs-attr\\\"\u003eservices:\u003c/span\u003e\\n  \u003cspan class=\\\"hljs-attr\\\"\u003eweb:\u003c/span\u003e\\n    \u003cspan class=\\\"hljs-attr\\\"\u003eimage:\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003enginx:alpine\u003c/span\u003e\\n    \u003cspan class=\\\"hljs-attr\\\"\u003evolumes:\u003c/span\u003e\\n      \u003cspan class=\\\"hljs-bullet\\\"\u003e-\u003c/span\u003e \u003cspan class=\\\"hljs-attr\\\"\u003etype:\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003evolume\u003c/span\u003e\\n        \u003cspan class=\\\"hljs-attr\\\"\u003esource:\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003emydata\u003c/span\u003e\\n        \u003cspan class=\\\"hljs-attr\\\"\u003etarget:\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003e/data\u003c/span\u003e\\n        \u003cspan class=\\\"hljs-attr\\\"\u003evolume:\u003c/span\u003e\\n          \u003cspan class=\\\"hljs-attr\\\"\u003enocopy:\u003c/span\u003e \u003cspan class=\\\"hljs-literal\\\"\u003etrue\u003c/span\u003e\\n      \u003cspan class=\\\"hljs-bullet\\\"\u003e-\u003c/span\u003e \u003cspan class=\\\"hljs-attr\\\"\u003etype:\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003ebind\u003c/span\u003e\\n        \u003cspan class=\\\"hljs-attr\\\"\u003esource:\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003e./static\u003c/span\u003e\\n        \u003cspan class=\\\"hljs-attr\\\"\u003etarget:\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003e/opt/app/static\u003c/span\u003e\\n  \u003cspan class=\\\"hljs-attr\\\"\u003edb:\u003c/span\u003e\\n    \u003cspan class=\\\"hljs-attr\\\"\u003eimage:\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003epostgres:latest\u003c/span\u003e\\n    \u003cspan class=\\\"hljs-attr\\\"\u003evolumes:\u003c/span\u003e\\n      \u003cspan class=\\\"hljs-bullet\\\"\u003e-\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;/var/run/postgres.sock:/var/run/postgres/postgres.sock\u0026quot;\u003c/span\u003e\\n      \u003cspan class=\\\"hljs-bullet\\\"\u003e-\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;dbdata:/var/lib/postgresql/data\u0026quot;\u003c/span\u003e\\n\u003cspan class=\\\"hljs-attr\\\"\u003evolumes:\u003c/span\u003e\\n  \u003cspan class=\\\"hljs-attr\\\"\u003emydata:\u003c/span\u003e\\n  \u003cspan class=\\\"hljs-attr\\\"\u003edatabase:\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e短い書き方では \u003cem\u003e\u003cstrong\u003e[SOURCE:]TARGET[:MODE]\u003c/strong\u003e\u003c/em\u003e と書ける。\u003c/p\u003e\\n\u003cp\u003ero は readonly 。\u003c/p\u003e\\n\u003cpre\u003e\u003ccode class=\\\"hljs\\\"\u003e- ./cache:/tmp/cache:ro\u003c/code\u003e\u003c/pre\u003e\u003ch2\u003e変数の置換\u003c/h2\u003e\\n\u003cp\u003eシェル環境に \u003cem\u003e\u003cstrong\u003ePOSTGRES_VERSION=9.3\u003c/strong\u003e\u003c/em\u003e が定義されていると postgres のバージョンは 9.3 になる。\u003c/p\u003e\\n\u003cpre\u003e\u003ccode class=\\\"hljs\\\"\u003e\u003cspan class=\\\"hljs-attr\\\"\u003edb:\u003c/span\u003e\\n  \u003cspan class=\\\"hljs-attr\\\"\u003eimage:\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;postgres:${POSTGRES_VERSION}\u0026quot;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e環境変数が何も設定されていない場合は空文字になる。\\n環境変数のデフォルト値は \u003cem\u003e\u003cstrong\u003e.env\u003c/strong\u003e\u003c/em\u003e ファイルに設定しておくことができる。\u003c/p\u003e\\n\u003cul\u003e\\n\u003cli\u003e${VARIABLE:-default} は VARIABLE がセットされていないか空文字のときに \u003cem\u003e\u003cstrong\u003edefault\u003c/strong\u003e\u003c/em\u003e として評価される\u003c/li\u003e\\n\u003cli\u003e${VARIABLE-default} は VARIABLE がセットされていないときのみ \u003cem\u003e\u003cstrong\u003edefault\u003c/strong\u003e\u003c/em\u003e として評価される\u003c/li\u003e\\n\u003c/ul\u003e\\n\",\n  \"dir\": \"articles\",\n  \"base\": \"20210306225218.json\",\n  \"ext\": \".json\",\n  \"sourceBase\": \"20210306225218.md\",\n  \"sourceExt\": \".md\"\n}"}},"__N_SSG":true},"page":"/articles/[id]","query":{"id":"20210306225218"},"buildId":"j0qEr6JZ7JnigW5qKQCVL","isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-7b08e4c67f4f1b892f4b.js"></script><script src="/_next/static/chunks/webpack-189c53927ffd3caf09c3.js" async=""></script><script src="/_next/static/chunks/framework-2f612445bd50b211f15a.js" async=""></script><script src="/_next/static/chunks/main-c8b51cc0a92c3008cd1b.js" async=""></script><script src="/_next/static/chunks/pages/_app-7163558e7d92093a94d2.js" async=""></script><script src="/_next/static/chunks/996-109927db333074874af4.js" async=""></script><script src="/_next/static/chunks/394-1ac6c205f84cbd1b2925.js" async=""></script><script src="/_next/static/chunks/pages/articles/%5Bid%5D-6ddac1fc6283bcb21133.js" async=""></script><script src="/_next/static/j0qEr6JZ7JnigW5qKQCVL/_buildManifest.js" async=""></script><script src="/_next/static/j0qEr6JZ7JnigW5qKQCVL/_ssgManifest.js" async=""></script></body></html>