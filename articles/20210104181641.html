<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>Golang で時間操作とソート</title><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/css/e1c3d6ee91fcccc28a7c.css" as="style"/><link rel="stylesheet" href="/_next/static/css/e1c3d6ee91fcccc28a7c.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-f7ca7a935b246c4edd14.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.d2e6186d001d2275b0af.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.b2562460c774f5a57980.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-b63af2e2dfcc0bffd9c0.js" as="script"/><link rel="preload" href="/_next/static/chunks/c5b568cee8545d966ddc8d89f9063461e084494a.c564a02921d697744263.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/articles/%5Bid%5D-565d4c3adc05a3ed7d91.js" as="script"/></head><body><div id="__next"><div><div><div><h1>Ghostの囁き</h1><hr color="black"/></div><h2>Golang で時間操作とソート</h2><p><a href="https://github.com/ritarock/moniterinstance">インスタンスのCPUをCLIで確認する</a></p><p>この CLI を作るにあたってハマったところとその解決法。</p><h2>時間でソートする</h2><h3>配列のソート</h3><p>Golang の場合、お決まりのやり方があるみたいでググると大体同じやり方でやっている。</p><p>struct を定義して、<code>Len, Less, Swap</code>メソッドを用意する。</p><pre style="color:black;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;position:relative;margin:.5em 0;overflow:visible;padding:0;background-color:#fdfdfd;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;margin-bottom:1em"><code class="language-go" style="color:black;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;max-height:inherit;height:inherit;padding:0 1em;display:block;overflow:auto"><span class="token" style="color:#1990b8">type</span><span> Bytime </span><span class="token" style="color:#5F6364">[</span><span class="token" style="color:#5F6364">]</span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">*</span><span>cloudwatch</span><span class="token" style="color:#5F6364">.</span><span>Datapoint
</span>
<span></span><span class="token" style="color:#1990b8">func</span><span> </span><span class="token" style="color:#5F6364">(</span><span>arr Bytime</span><span class="token" style="color:#5F6364">)</span><span> </span><span class="token" style="color:#2f9c0a">Len</span><span class="token" style="color:#5F6364">(</span><span class="token" style="color:#5F6364">)</span><span> </span><span class="token" style="color:#2f9c0a">int</span><span> </span><span class="token" style="color:#5F6364">{</span><span>
</span><span>	</span><span class="token" style="color:#1990b8">return</span><span> </span><span class="token" style="color:#2f9c0a">len</span><span class="token" style="color:#5F6364">(</span><span>arr</span><span class="token" style="color:#5F6364">)</span><span>
</span><span></span><span class="token" style="color:#5F6364">}</span><span>
</span>
<span></span><span class="token" style="color:#1990b8">func</span><span> </span><span class="token" style="color:#5F6364">(</span><span>arr Bytime</span><span class="token" style="color:#5F6364">)</span><span> </span><span class="token" style="color:#2f9c0a">Less</span><span class="token" style="color:#5F6364">(</span><span>i</span><span class="token" style="color:#5F6364">,</span><span> j </span><span class="token" style="color:#2f9c0a">int</span><span class="token" style="color:#5F6364">)</span><span> </span><span class="token" style="color:#2f9c0a">bool</span><span> </span><span class="token" style="color:#5F6364">{</span><span>
</span><span>	</span><span class="token" style="color:#1990b8">return</span><span> arr</span><span class="token" style="color:#5F6364">[</span><span>i</span><span class="token" style="color:#5F6364">]</span><span class="token" style="color:#5F6364">.</span><span>Timestamp</span><span class="token" style="color:#5F6364">.</span><span class="token" style="color:#2f9c0a">Before</span><span class="token" style="color:#5F6364">(</span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">*</span><span>arr</span><span class="token" style="color:#5F6364">[</span><span>j</span><span class="token" style="color:#5F6364">]</span><span class="token" style="color:#5F6364">.</span><span>Timestamp</span><span class="token" style="color:#5F6364">)</span><span>
</span><span></span><span class="token" style="color:#5F6364">}</span><span>
</span>
<span></span><span class="token" style="color:#1990b8">func</span><span> </span><span class="token" style="color:#5F6364">(</span><span>arr Bytime</span><span class="token" style="color:#5F6364">)</span><span> </span><span class="token" style="color:#2f9c0a">Swap</span><span class="token" style="color:#5F6364">(</span><span>i</span><span class="token" style="color:#5F6364">,</span><span> j </span><span class="token" style="color:#2f9c0a">int</span><span class="token" style="color:#5F6364">)</span><span> </span><span class="token" style="color:#5F6364">{</span><span>
</span><span>	arr</span><span class="token" style="color:#5F6364">[</span><span>i</span><span class="token" style="color:#5F6364">]</span><span class="token" style="color:#5F6364">,</span><span> arr</span><span class="token" style="color:#5F6364">[</span><span>j</span><span class="token" style="color:#5F6364">]</span><span> </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">=</span><span> arr</span><span class="token" style="color:#5F6364">[</span><span>j</span><span class="token" style="color:#5F6364">]</span><span class="token" style="color:#5F6364">,</span><span> arr</span><span class="token" style="color:#5F6364">[</span><span>i</span><span class="token" style="color:#5F6364">]</span><span>
</span><span></span><span class="token" style="color:#5F6364">}</span></code></pre><p>実際にソートするときは、別の配列を用意した。</p><pre style="color:black;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;position:relative;margin:.5em 0;overflow:visible;padding:0;background-color:#fdfdfd;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;margin-bottom:1em"><code class="language-go" style="color:black;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;max-height:inherit;height:inherit;padding:0 1em;display:block;overflow:auto"><span class="token" style="color:#1990b8">var</span><span> sortedResp Bytime </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">=</span><span> resp</span><span class="token" style="color:#5F6364">.</span><span>Datapoints
</span><span>sort</span><span class="token" style="color:#5F6364">.</span><span class="token" style="color:#2f9c0a">Sort</span><span class="token" style="color:#5F6364">(</span><span>sortedResp</span><span class="token" style="color:#5F6364">)</span></code></pre><h3>時間の比較</h3><p>timeA(2020-01-01 00:00:00 +0000 UTC) と timeB(2021-01-01 00:00:00 +0000 UTC) があるとする。</p><pre style="color:black;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;position:relative;margin:.5em 0;overflow:visible;padding:0;background-color:#fdfdfd;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;margin-bottom:1em"><code class="language-go" style="color:black;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;max-height:inherit;height:inherit;padding:0 1em;display:block;overflow:auto"><span>timeA</span><span class="token" style="color:#5F6364">,</span><span> timeB </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">:=</span><span> time</span><span class="token" style="color:#5F6364">.</span><span class="token" style="color:#2f9c0a">Date</span><span class="token" style="color:#5F6364">(</span><span class="token" style="color:#c92c2c">2020</span><span class="token" style="color:#5F6364">,</span><span> </span><span class="token" style="color:#c92c2c">1</span><span class="token" style="color:#5F6364">,</span><span> </span><span class="token" style="color:#c92c2c">1</span><span class="token" style="color:#5F6364">,</span><span> </span><span class="token" style="color:#c92c2c">0</span><span class="token" style="color:#5F6364">,</span><span> </span><span class="token" style="color:#c92c2c">0</span><span class="token" style="color:#5F6364">,</span><span> </span><span class="token" style="color:#c92c2c">0</span><span> </span><span class="token" style="color:#5F6364">,</span><span> </span><span class="token" style="color:#c92c2c">0</span><span class="token" style="color:#5F6364">,</span><span> time</span><span class="token" style="color:#5F6364">.</span><span>UTC</span><span class="token" style="color:#5F6364">)</span><span class="token" style="color:#5F6364">,</span><span> time</span><span class="token" style="color:#5F6364">.</span><span class="token" style="color:#2f9c0a">Date</span><span class="token" style="color:#5F6364">(</span><span class="token" style="color:#c92c2c">2021</span><span class="token" style="color:#5F6364">,</span><span> </span><span class="token" style="color:#c92c2c">1</span><span class="token" style="color:#5F6364">,</span><span> </span><span class="token" style="color:#c92c2c">1</span><span class="token" style="color:#5F6364">,</span><span> </span><span class="token" style="color:#c92c2c">0</span><span class="token" style="color:#5F6364">,</span><span> </span><span class="token" style="color:#c92c2c">0</span><span class="token" style="color:#5F6364">,</span><span> </span><span class="token" style="color:#c92c2c">0</span><span> </span><span class="token" style="color:#5F6364">,</span><span> </span><span class="token" style="color:#c92c2c">0</span><span class="token" style="color:#5F6364">,</span><span> time</span><span class="token" style="color:#5F6364">.</span><span>UTC</span><span class="token" style="color:#5F6364">)</span></code></pre><p>時間の流れは <code>timeA =&gt; timeB</code>。</p><p>このときの時間の比較は以下のようにできる。</p><pre style="color:black;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;position:relative;margin:.5em 0;overflow:visible;padding:0;background-color:#fdfdfd;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;margin-bottom:1em"><code class="language-go" style="color:black;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;max-height:inherit;height:inherit;padding:0 1em;display:block;overflow:auto"><span>timeA</span><span class="token" style="color:#5F6364">.</span><span class="token" style="color:#2f9c0a">Equal</span><span class="token" style="color:#5F6364">(</span><span>timeB</span><span class="token" style="color:#5F6364">)</span><span> </span><span class="token" style="color:#7D8B99">// false</span><span>
</span>
<span>timeA</span><span class="token" style="color:#5F6364">.</span><span class="token" style="color:#2f9c0a">Before</span><span class="token" style="color:#5F6364">(</span><span>timeB</span><span class="token" style="color:#5F6364">)</span><span> </span><span class="token" style="color:#7D8B99">// true</span><span>
</span>
<span>timeA</span><span class="token" style="color:#5F6364">.</span><span class="token" style="color:#2f9c0a">After</span><span class="token" style="color:#5F6364">(</span><span>timeB</span><span class="token" style="color:#5F6364">)</span><span> </span><span class="token" style="color:#7D8B99">// false</span></code></pre><h2>UTCをJSTに変更</h2><pre style="color:black;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;position:relative;margin:.5em 0;overflow:visible;padding:0;background-color:#fdfdfd;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;margin-bottom:1em"><code class="language-go" style="color:black;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;max-height:inherit;height:inherit;padding:0 1em;display:block;overflow:auto"><span>timeA </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">:=</span><span> time</span><span class="token" style="color:#5F6364">.</span><span class="token" style="color:#2f9c0a">Date</span><span class="token" style="color:#5F6364">(</span><span class="token" style="color:#c92c2c">2020</span><span class="token" style="color:#5F6364">,</span><span> </span><span class="token" style="color:#c92c2c">1</span><span class="token" style="color:#5F6364">,</span><span> </span><span class="token" style="color:#c92c2c">1</span><span class="token" style="color:#5F6364">,</span><span> </span><span class="token" style="color:#c92c2c">0</span><span class="token" style="color:#5F6364">,</span><span> </span><span class="token" style="color:#c92c2c">0</span><span class="token" style="color:#5F6364">,</span><span> </span><span class="token" style="color:#c92c2c">0</span><span> </span><span class="token" style="color:#5F6364">,</span><span> </span><span class="token" style="color:#c92c2c">0</span><span class="token" style="color:#5F6364">,</span><span> time</span><span class="token" style="color:#5F6364">.</span><span>UTC</span><span class="token" style="color:#5F6364">)</span><span>
</span><span>loc</span><span class="token" style="color:#5F6364">,</span><span> </span><span class="token" style="color:#c92c2c">_</span><span> </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">:=</span><span> time</span><span class="token" style="color:#5F6364">.</span><span class="token" style="color:#2f9c0a">LoadLocation</span><span class="token" style="color:#5F6364">(</span><span class="token" style="color:#2f9c0a">&quot;Asia/Tokyo&quot;</span><span class="token" style="color:#5F6364">)</span><span>
</span>
<span>fmt</span><span class="token" style="color:#5F6364">.</span><span class="token" style="color:#2f9c0a">Println</span><span class="token" style="color:#5F6364">(</span><span class="token" style="color:#2f9c0a">&quot;UTC &quot;</span><span> </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">+</span><span> timeA</span><span class="token" style="color:#5F6364">.</span><span class="token" style="color:#2f9c0a">String</span><span class="token" style="color:#5F6364">(</span><span class="token" style="color:#5F6364">)</span><span class="token" style="color:#5F6364">)</span><span> </span><span class="token" style="color:#7D8B99">// UTC 2020-01-01 00:00:00 +0000 UTC</span><span>
</span><span>fmt</span><span class="token" style="color:#5F6364">.</span><span class="token" style="color:#2f9c0a">Println</span><span class="token" style="color:#5F6364">(</span><span class="token" style="color:#2f9c0a">&quot;JST &quot;</span><span> </span><span class="token" style="color:#a67f59;background:rgba(255, 255, 255, 0.5)">+</span><span> timeA</span><span class="token" style="color:#5F6364">.</span><span class="token" style="color:#2f9c0a">In</span><span class="token" style="color:#5F6364">(</span><span>loc</span><span class="token" style="color:#5F6364">)</span><span class="token" style="color:#5F6364">.</span><span class="token" style="color:#2f9c0a">String</span><span class="token" style="color:#5F6364">(</span><span class="token" style="color:#5F6364">)</span><span class="token" style="color:#5F6364">)</span><span> </span><span class="token" style="color:#7D8B99">// JST 2020-01-01 09:00:00 +0900 JST</span></code></pre><div><p><a href="/">TOPへ戻る</a></p></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"articleData":{"id":"20210104181641","contentHtml":"\n[インスタンスのCPUをCLIで確認する](https://github.com/ritarock/moniterinstance)\n\nこの CLI を作るにあたってハマったところとその解決法。\n\n## 時間でソートする\n### 配列のソート\nGolang の場合、お決まりのやり方があるみたいでググると大体同じやり方でやっている。\n\nstruct を定義して、`Len, Less, Swap`メソッドを用意する。\n```go\ntype Bytime []*cloudwatch.Datapoint\n\nfunc (arr Bytime) Len() int {\n\treturn len(arr)\n}\n\nfunc (arr Bytime) Less(i, j int) bool {\n\treturn arr[i].Timestamp.Before(*arr[j].Timestamp)\n}\n\nfunc (arr Bytime) Swap(i, j int) {\n\tarr[i], arr[j] = arr[j], arr[i]\n}\n```\n\n実際にソートするときは、別の配列を用意した。\n```go\nvar sortedResp Bytime = resp.Datapoints\nsort.Sort(sortedResp)\n```\n\n### 時間の比較\ntimeA(2020-01-01 00:00:00 +0000 UTC) と timeB(2021-01-01 00:00:00 +0000 UTC) があるとする。\n```go\ntimeA, timeB := time.Date(2020, 1, 1, 0, 0, 0 , 0, time.UTC), time.Date(2021, 1, 1, 0, 0, 0 , 0, time.UTC)\n```\n\n時間の流れは `timeA =\u003e timeB`。\n\nこのときの時間の比較は以下のようにできる。\n```go\ntimeA.Equal(timeB) // false\n\ntimeA.Before(timeB) // true\n\ntimeA.After(timeB) // false\n```\n\n## UTCをJSTに変更\n```go\ntimeA := time.Date(2020, 1, 1, 0, 0, 0 , 0, time.UTC)\nloc, _ := time.LoadLocation(\"Asia/Tokyo\")\n\nfmt.Println(\"UTC \" + timeA.String()) // UTC 2020-01-01 00:00:00 +0000 UTC\nfmt.Println(\"JST \" + timeA.In(loc).String()) // JST 2020-01-01 09:00:00 +0900 JST\n```\n","title":"Golang で時間操作とソート","date":20210104181641,"tags":["Golang"]}},"__N_SSG":true},"page":"/articles/[id]","query":{"id":"20210104181641"},"buildId":"nZzbA08FBnhhSB6fPvTaA","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-8f31809deb7932dd0187.js"></script><script src="/_next/static/chunks/main-f7ca7a935b246c4edd14.js" async=""></script><script src="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" async=""></script><script src="/_next/static/chunks/framework.d2e6186d001d2275b0af.js" async=""></script><script src="/_next/static/chunks/commons.b2562460c774f5a57980.js" async=""></script><script src="/_next/static/chunks/pages/_app-b63af2e2dfcc0bffd9c0.js" async=""></script><script src="/_next/static/chunks/c5b568cee8545d966ddc8d89f9063461e084494a.c564a02921d697744263.js" async=""></script><script src="/_next/static/chunks/pages/articles/%5Bid%5D-565d4c3adc05a3ed7d91.js" async=""></script><script src="/_next/static/nZzbA08FBnhhSB6fPvTaA/_buildManifest.js" async=""></script><script src="/_next/static/nZzbA08FBnhhSB6fPvTaA/_ssgManifest.js" async=""></script></body></html>