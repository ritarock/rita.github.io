<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>MyDocs</title><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/css/e5069c53c645de81365c.css" as="style"/><link rel="stylesheet" href="/_next/static/css/e5069c53c645de81365c.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/webpack-189c53927ffd3caf09c3.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework-2f612445bd50b211f15a.js" as="script"/><link rel="preload" href="/_next/static/chunks/main-c8b51cc0a92c3008cd1b.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-7163558e7d92093a94d2.js" as="script"/><link rel="preload" href="/_next/static/chunks/996-109927db333074874af4.js" as="script"/><link rel="preload" href="/_next/static/chunks/394-1ac6c205f84cbd1b2925.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/articles/%5Bid%5D-6ddac1fc6283bcb21133.js" as="script"/></head><body><div id="__next"><div><div><div class="bg-gray-600 h-10 leading-10 text-2xl"><a class="no-underline text-gray-100 mx-2" href="/">MyDocs</a></div></div><div class="mx-7"><h1><b># <!-- -->Golang で時間操作とソート</b></h1><p><a href="https://github.com/ritarock/moniterinstance">インスタンスのCPUをCLIで確認する</a></p>
<p>この CLI を作るにあたってハマったところとその解決法。</p>
<h2>時間でソートする</h2>
<h3>配列のソート</h3>
<p>Golang の場合、お決まりのやり方があるみたいでググると大体同じやり方でやっている。</p>
<p>struct を定義して、 <em><strong>Len, Less, Swap</strong></em> メソッドを用意する。</p>
<pre><div class="text-xs" node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-go" style="white-space:pre"><span style="color:#f92672;font-weight:bold">type</span><span> Bytime []*cloudwatch.Datapoint
</span>
<span></span><span class="hljs-function" style="color:#f92672;font-weight:bold">func</span><span class="hljs-function"> </span><span class="hljs-function hljs-params">(arr Bytime)</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">Len</span><span class="hljs-function hljs-params">()</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">int</span><span> {
</span><span>	</span><span style="color:#f92672;font-weight:bold">return</span><span> </span><span style="color:#a6e22e">len</span><span>(arr)
</span>}
<!-- -->
<span></span><span class="hljs-function" style="color:#f92672;font-weight:bold">func</span><span class="hljs-function"> </span><span class="hljs-function hljs-params">(arr Bytime)</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">Less</span><span class="hljs-function hljs-params">(i, j </span><span class="hljs-function hljs-params" style="color:#f92672;font-weight:bold">int</span><span class="hljs-function hljs-params">)</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">bool</span><span> {
</span><span>	</span><span style="color:#f92672;font-weight:bold">return</span><span> arr[i].Timestamp.Before(*arr[j].Timestamp)
</span>}
<!-- -->
<span></span><span class="hljs-function" style="color:#f92672;font-weight:bold">func</span><span class="hljs-function"> </span><span class="hljs-function hljs-params">(arr Bytime)</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">Swap</span><span class="hljs-function hljs-params">(i, j </span><span class="hljs-function hljs-params" style="color:#f92672;font-weight:bold">int</span><span class="hljs-function hljs-params">)</span><span> {
</span>	arr[i], arr[j] = arr[j], arr[i]
<!-- -->}
</code></div></pre>
<p>実際にソートするときは、別の配列を用意した。</p>
<pre><div class="text-xs" node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-go" style="white-space:pre"><span style="color:#f92672;font-weight:bold">var</span><span> sortedResp Bytime = resp.Datapoints
</span>sort.Sort(sortedResp)
</code></div></pre>
<h3>時間の比較</h3>
<p>timeA(2020-01-01 00:00:00 +0000 UTC) と timeB(2021-01-01 00:00:00 +0000 UTC) があるとする。</p>
<pre><div class="text-xs" node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-go" style="white-space:pre"><span>timeA, timeB := time.Date(</span><span class="hljs-number">2020</span><span>, </span><span class="hljs-number">1</span><span>, </span><span class="hljs-number">1</span><span>, </span><span class="hljs-number">0</span><span>, </span><span class="hljs-number">0</span><span>, </span><span class="hljs-number">0</span><span> , </span><span class="hljs-number">0</span><span>, time.UTC), time.Date(</span><span class="hljs-number">2021</span><span>, </span><span class="hljs-number">1</span><span>, </span><span class="hljs-number">1</span><span>, </span><span class="hljs-number">0</span><span>, </span><span class="hljs-number">0</span><span>, </span><span class="hljs-number">0</span><span> , </span><span class="hljs-number">0</span><span>, time.UTC)</span></code></div></pre>
<p>時間の流れは <em><strong>timeA =&gt; timeB</strong></em>。</p>
<p>このときの時間の比較は以下のようにできる。</p>
<pre><div class="text-xs" node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-go" style="white-space:pre"><span>timeA.Equal(timeB) </span><span style="color:#75715e">// false</span><span>
</span>
<span>timeA.Before(timeB) </span><span style="color:#75715e">// true</span><span>
</span>
<span>timeA.After(timeB) </span><span style="color:#75715e">// false</span></code></div></pre>
<h2>UTCをJSTに変更</h2>
<pre><div class="text-xs" node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-go" style="white-space:pre"><span>timeA := time.Date(</span><span class="hljs-number">2020</span><span>, </span><span class="hljs-number">1</span><span>, </span><span class="hljs-number">1</span><span>, </span><span class="hljs-number">0</span><span>, </span><span class="hljs-number">0</span><span>, </span><span class="hljs-number">0</span><span> , </span><span class="hljs-number">0</span><span>, time.UTC)
</span><span>loc, _ := time.LoadLocation(</span><span style="color:#a6e22e">&quot;Asia/Tokyo&quot;</span><span>)
</span>
<span>fmt.Println(</span><span style="color:#a6e22e">&quot;UTC &quot;</span><span> + timeA.String()) </span><span style="color:#75715e">// UTC 2020-01-01 00:00:00 +0000 UTC</span><span>
</span><span>fmt.Println(</span><span style="color:#a6e22e">&quot;JST &quot;</span><span> + timeA.In(loc).String()) </span><span style="color:#75715e">// JST 2020-01-01 09:00:00 +0900 JST</span></code></div></pre></div><br/></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"data":{"id":"20210104181641","fileContents":"{\n  \"title\": \"Golang で時間操作とソート\",\n  \"date\": 20210104181641,\n  \"tags\": [\n    \"golang\"\n  ],\n  \"bodyContent\": \"[インスタンスのCPUをCLIで確認する](https://github.com/ritarock/moniterinstance)\\n\\nこの CLI を作るにあたってハマったところとその解決法。\\n\\n## 時間でソートする\\n### 配列のソート\\nGolang の場合、お決まりのやり方があるみたいでググると大体同じやり方でやっている。\\n\\nstruct を定義して、 ***Len, Less, Swap*** メソッドを用意する。\\n```go\\ntype Bytime []*cloudwatch.Datapoint\\n\\nfunc (arr Bytime) Len() int {\\n\\treturn len(arr)\\n}\\n\\nfunc (arr Bytime) Less(i, j int) bool {\\n\\treturn arr[i].Timestamp.Before(*arr[j].Timestamp)\\n}\\n\\nfunc (arr Bytime) Swap(i, j int) {\\n\\tarr[i], arr[j] = arr[j], arr[i]\\n}\\n```\\n\\n実際にソートするときは、別の配列を用意した。\\n```go\\nvar sortedResp Bytime = resp.Datapoints\\nsort.Sort(sortedResp)\\n```\\n\\n### 時間の比較\\ntimeA(2020-01-01 00:00:00 +0000 UTC) と timeB(2021-01-01 00:00:00 +0000 UTC) があるとする。\\n```go\\ntimeA, timeB := time.Date(2020, 1, 1, 0, 0, 0 , 0, time.UTC), time.Date(2021, 1, 1, 0, 0, 0 , 0, time.UTC)\\n```\\n\\n時間の流れは ***timeA =\u003e timeB***。\\n\\nこのときの時間の比較は以下のようにできる。\\n```go\\ntimeA.Equal(timeB) // false\\n\\ntimeA.Before(timeB) // true\\n\\ntimeA.After(timeB) // false\\n```\\n\\n## UTCをJSTに変更\\n```go\\ntimeA := time.Date(2020, 1, 1, 0, 0, 0 , 0, time.UTC)\\nloc, _ := time.LoadLocation(\\\"Asia/Tokyo\\\")\\n\\nfmt.Println(\\\"UTC \\\" + timeA.String()) // UTC 2020-01-01 00:00:00 +0000 UTC\\nfmt.Println(\\\"JST \\\" + timeA.In(loc).String()) // JST 2020-01-01 09:00:00 +0900 JST\\n```\",\n  \"bodyHtml\": \"\u003cp\u003e\u003ca href=\\\"https://github.com/ritarock/moniterinstance\\\"\u003eインスタンスのCPUをCLIで確認する\u003c/a\u003e\u003c/p\u003e\\n\u003cp\u003eこの CLI を作るにあたってハマったところとその解決法。\u003c/p\u003e\\n\u003ch2\u003e時間でソートする\u003c/h2\u003e\\n\u003ch3\u003e配列のソート\u003c/h3\u003e\\n\u003cp\u003eGolang の場合、お決まりのやり方があるみたいでググると大体同じやり方でやっている。\u003c/p\u003e\\n\u003cp\u003estruct を定義して、 \u003cem\u003e\u003cstrong\u003eLen, Less, Swap\u003c/strong\u003e\u003c/em\u003e メソッドを用意する。\u003c/p\u003e\\n\u003cpre\u003e\u003ccode class=\\\"hljs\\\"\u003e\u003cspan class=\\\"hljs-keyword\\\"\u003etype\u003c/span\u003e Bytime []*cloudwatch.Datapoint\\n\\n\u003cspan class=\\\"hljs-function\\\"\u003e\u003cspan class=\\\"hljs-keyword\\\"\u003efunc\u003c/span\u003e \u003cspan class=\\\"hljs-params\\\"\u003e(arr Bytime)\u003c/span\u003e \u003cspan class=\\\"hljs-title\\\"\u003eLen\u003c/span\u003e\u003cspan class=\\\"hljs-params\\\"\u003e()\u003c/span\u003e \u003cspan class=\\\"hljs-title\\\"\u003eint\u003c/span\u003e\u003c/span\u003e {\\n\\t\u003cspan class=\\\"hljs-keyword\\\"\u003ereturn\u003c/span\u003e \u003cspan class=\\\"hljs-built_in\\\"\u003elen\u003c/span\u003e(arr)\\n}\\n\\n\u003cspan class=\\\"hljs-function\\\"\u003e\u003cspan class=\\\"hljs-keyword\\\"\u003efunc\u003c/span\u003e \u003cspan class=\\\"hljs-params\\\"\u003e(arr Bytime)\u003c/span\u003e \u003cspan class=\\\"hljs-title\\\"\u003eLess\u003c/span\u003e\u003cspan class=\\\"hljs-params\\\"\u003e(i, j \u003cspan class=\\\"hljs-keyword\\\"\u003eint\u003c/span\u003e)\u003c/span\u003e \u003cspan class=\\\"hljs-title\\\"\u003ebool\u003c/span\u003e\u003c/span\u003e {\\n\\t\u003cspan class=\\\"hljs-keyword\\\"\u003ereturn\u003c/span\u003e arr[i].Timestamp.Before(*arr[j].Timestamp)\\n}\\n\\n\u003cspan class=\\\"hljs-function\\\"\u003e\u003cspan class=\\\"hljs-keyword\\\"\u003efunc\u003c/span\u003e \u003cspan class=\\\"hljs-params\\\"\u003e(arr Bytime)\u003c/span\u003e \u003cspan class=\\\"hljs-title\\\"\u003eSwap\u003c/span\u003e\u003cspan class=\\\"hljs-params\\\"\u003e(i, j \u003cspan class=\\\"hljs-keyword\\\"\u003eint\u003c/span\u003e)\u003c/span\u003e\u003c/span\u003e {\\n\\tarr[i], arr[j] = arr[j], arr[i]\\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e実際にソートするときは、別の配列を用意した。\u003c/p\u003e\\n\u003cpre\u003e\u003ccode class=\\\"hljs\\\"\u003e\u003cspan class=\\\"hljs-keyword\\\"\u003evar\u003c/span\u003e sortedResp Bytime = resp.Datapoints\\nsort.Sort(sortedResp)\u003c/code\u003e\u003c/pre\u003e\u003ch3\u003e時間の比較\u003c/h3\u003e\\n\u003cp\u003etimeA(2020-01-01 00:00:00 +0000 UTC) と timeB(2021-01-01 00:00:00 +0000 UTC) があるとする。\u003c/p\u003e\\n\u003cpre\u003e\u003ccode class=\\\"hljs\\\"\u003etimeA, timeB := time.Date(\u003cspan class=\\\"hljs-number\\\"\u003e2020\u003c/span\u003e, \u003cspan class=\\\"hljs-number\\\"\u003e1\u003c/span\u003e, \u003cspan class=\\\"hljs-number\\\"\u003e1\u003c/span\u003e, \u003cspan class=\\\"hljs-number\\\"\u003e0\u003c/span\u003e, \u003cspan class=\\\"hljs-number\\\"\u003e0\u003c/span\u003e, \u003cspan class=\\\"hljs-number\\\"\u003e0\u003c/span\u003e , \u003cspan class=\\\"hljs-number\\\"\u003e0\u003c/span\u003e, time.UTC), time.Date(\u003cspan class=\\\"hljs-number\\\"\u003e2021\u003c/span\u003e, \u003cspan class=\\\"hljs-number\\\"\u003e1\u003c/span\u003e, \u003cspan class=\\\"hljs-number\\\"\u003e1\u003c/span\u003e, \u003cspan class=\\\"hljs-number\\\"\u003e0\u003c/span\u003e, \u003cspan class=\\\"hljs-number\\\"\u003e0\u003c/span\u003e, \u003cspan class=\\\"hljs-number\\\"\u003e0\u003c/span\u003e , \u003cspan class=\\\"hljs-number\\\"\u003e0\u003c/span\u003e, time.UTC)\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e時間の流れは \u003cem\u003e\u003cstrong\u003etimeA =\u0026gt; timeB\u003c/strong\u003e\u003c/em\u003e。\u003c/p\u003e\\n\u003cp\u003eこのときの時間の比較は以下のようにできる。\u003c/p\u003e\\n\u003cpre\u003e\u003ccode class=\\\"hljs\\\"\u003etimeA.Equal(timeB) \u003cspan class=\\\"hljs-comment\\\"\u003e// false\u003c/span\u003e\\n\\ntimeA.Before(timeB) \u003cspan class=\\\"hljs-comment\\\"\u003e// true\u003c/span\u003e\\n\\ntimeA.After(timeB) \u003cspan class=\\\"hljs-comment\\\"\u003e// false\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003ch2\u003eUTCをJSTに変更\u003c/h2\u003e\\n\u003cpre\u003e\u003ccode class=\\\"hljs\\\"\u003etimeA := time.Date(\u003cspan class=\\\"hljs-number\\\"\u003e2020\u003c/span\u003e, \u003cspan class=\\\"hljs-number\\\"\u003e1\u003c/span\u003e, \u003cspan class=\\\"hljs-number\\\"\u003e1\u003c/span\u003e, \u003cspan class=\\\"hljs-number\\\"\u003e0\u003c/span\u003e, \u003cspan class=\\\"hljs-number\\\"\u003e0\u003c/span\u003e, \u003cspan class=\\\"hljs-number\\\"\u003e0\u003c/span\u003e , \u003cspan class=\\\"hljs-number\\\"\u003e0\u003c/span\u003e, time.UTC)\\nloc, _ := time.LoadLocation(\u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;Asia/Tokyo\u0026quot;\u003c/span\u003e)\\n\\nfmt.Println(\u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;UTC \u0026quot;\u003c/span\u003e + timeA.String()) \u003cspan class=\\\"hljs-comment\\\"\u003e// UTC 2020-01-01 00:00:00 +0000 UTC\u003c/span\u003e\\nfmt.Println(\u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;JST \u0026quot;\u003c/span\u003e + timeA.In(loc).String()) \u003cspan class=\\\"hljs-comment\\\"\u003e// JST 2020-01-01 09:00:00 +0900 JST\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\",\n  \"dir\": \"articles\",\n  \"base\": \"20210104181641.json\",\n  \"ext\": \".json\",\n  \"sourceBase\": \"20210104181641.md\",\n  \"sourceExt\": \".md\"\n}"}},"__N_SSG":true},"page":"/articles/[id]","query":{"id":"20210104181641"},"buildId":"IqmH55iomhQEvZjK-5scu","isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-7b08e4c67f4f1b892f4b.js"></script><script src="/_next/static/chunks/webpack-189c53927ffd3caf09c3.js" async=""></script><script src="/_next/static/chunks/framework-2f612445bd50b211f15a.js" async=""></script><script src="/_next/static/chunks/main-c8b51cc0a92c3008cd1b.js" async=""></script><script src="/_next/static/chunks/pages/_app-7163558e7d92093a94d2.js" async=""></script><script src="/_next/static/chunks/996-109927db333074874af4.js" async=""></script><script src="/_next/static/chunks/394-1ac6c205f84cbd1b2925.js" async=""></script><script src="/_next/static/chunks/pages/articles/%5Bid%5D-6ddac1fc6283bcb21133.js" async=""></script><script src="/_next/static/IqmH55iomhQEvZjK-5scu/_buildManifest.js" async=""></script><script src="/_next/static/IqmH55iomhQEvZjK-5scu/_ssgManifest.js" async=""></script></body></html>