<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>MyDocs</title><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/css/fe7719b0448520fe.css" as="style"/><link rel="stylesheet" href="/_next/static/css/fe7719b0448520fe.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a40ef1678bae11e696dba45124eadd70.js"></script><script src="/_next/static/chunks/webpack-514908bffb652963.js" defer=""></script><script src="/_next/static/chunks/framework-0f8b31729833af61.js" defer=""></script><script src="/_next/static/chunks/main-f868a840cbb131f3.js" defer=""></script><script src="/_next/static/chunks/pages/_app-eddec6d010f06c43.js" defer=""></script><script src="/_next/static/chunks/119-5a395caf0195b7fb.js" defer=""></script><script src="/_next/static/chunks/pages/docs/%5Bid%5D-820a34cd4558865b.js" defer=""></script><script src="/_next/static/4t-InvnG14DSacseRZYYJ/_buildManifest.js" defer=""></script><script src="/_next/static/4t-InvnG14DSacseRZYYJ/_ssgManifest.js" defer=""></script><script src="/_next/static/4t-InvnG14DSacseRZYYJ/_middlewareManifest.js" defer=""></script></head><body><div id="__next"><div><div><div class="bg-gray-600 h-10 leading-10 text-2xl"><a class="no-underline text-gray-100 mx-2" href="/">MyDocs</a></div></div><div class="mx-7"><h1><b># <!-- -->データベース操作</b></h1><h2>データベースの作成</h2>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-sql" style="white-space:pre"><span style="color:#f92672;font-weight:bold">CREATE</span><span> DATABASE database_name;</span></code></div><p class="h-2"></p></pre>
<h2>データベースの削除</h2>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-sql" style="white-space:pre"><span style="color:#f92672;font-weight:bold">DROP</span><span> DATABASE database_name;</span></code></div><p class="h-2"></p></pre>
<h2>テーブルの作成</h2>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-sql" style="white-space:pre"><span style="color:#f92672;font-weight:bold">CREATE</span><span> </span><span style="color:#f92672;font-weight:bold">TABLE</span><span> table_name (col_name type, ...);</span></code></div><p class="h-2"></p></pre>
<h3>主キー</h3>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-sql" style="white-space:pre"><span style="color:#f92672;font-weight:bold">CREATE</span><span> </span><span style="color:#f92672;font-weight:bold">TABLE</span><span> table_name (col_name type, ..., </span><span style="color:#f92672;font-weight:bold">PRIMARY</span><span> KEY (col_name));</span></code></div><p class="h-2"></p></pre>
<ul>
<li>PRIMARY KEY の重複と NULL は NG</li>
<li>複数の列を指定できる (複合主キー)<!-- -->
<ul>
<li>PRIMARY KEY(列名1, 列名2)</li>
</ul>
</li>
</ul>
<h3>外部キー</h3>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-sql" style="white-space:pre"><span style="color:#f92672;font-weight:bold">CREATE</span><span> </span><span style="color:#f92672;font-weight:bold">TABLE</span><span> table_name (
</span>  col_name type, ...,
<span>  </span><span style="color:#f92672;font-weight:bold">FOREIGN</span><span> KEY (col_name) </span><span style="color:#f92672;font-weight:bold">REFERENCES</span><span> parent_table_name(col_name)
</span>);
</code></div><p class="h-2"></p></pre>
<ul>
<li>子テーブルの外部キーの値は親テーブルに存在しないといけない</li>
<li>参照される値 (親テーブル) の UPDATE / DELETE は NG</li>
</ul>
<h4>親テーブルの UPDATE / DELETE 時の設定</h4>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-sql" style="white-space:pre"><span style="color:#f92672;font-weight:bold">CREATE</span><span> </span><span style="color:#f92672;font-weight:bold">TABLE</span><span> table_name (
</span>  col_name type, ...,
<span>  </span><span style="color:#f92672;font-weight:bold">FOREIGN</span><span> KEY (col_name) </span><span style="color:#f92672;font-weight:bold">REFERENCES</span><span> parent_table_name(col_name)
</span><span>  </span><span style="color:#f92672;font-weight:bold">ON</span><span> </span><span style="color:#f92672;font-weight:bold">DELETE</span><span> [ アクション ]
</span><span>  </span><span style="color:#f92672;font-weight:bold">ON</span><span> UPDATE [ アクション ]
</span>);
<!-- -->
</code></div><p class="h-2"></p></pre>
<p>設定できるアクション.</p>
<table><thead><tr><th>アクション</th><th>詳細</th></tr></thead><tbody><tr><td>RESTRICT</td><td>親テーブルに対して UPDATE / DELETE を行うとエラーになる (デフォルト)</td></tr><tr><td>CASCADE</td><td>親テーブルに対して UPDATE / DELETE を行うと,子テーブルの一致する行に自動的に UPDATE / DELETE を行う</td></tr><tr><td>SET NULL</td><td>親テーブルに対して UPDATE / DELETE を行うと,子テーブルの外部キーを NULL に設定する</td></tr></tbody></table>
<h2>データの検索</h2>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-sql" style="white-space:pre"><span style="color:#f92672;font-weight:bold">SELECT</span><span> col_name1, col_name2, ... </span><span style="color:#f92672;font-weight:bold">FROM</span><span> table_name [ 条件 ];</span></code></div><p class="h-2"></p></pre>
<h3>条件</h3>
<ul>
<li>比較演算子</li>
</ul>
<table><thead><tr><th>演算子</th><th>意味</th></tr></thead><tbody><tr><td>&quot;=&quot;</td><td>等しい</td></tr><tr><td>&quot;&lt;&quot;</td><td>小さい</td></tr><tr><td>&quot;&gt;&quot;</td><td>大きい</td></tr><tr><td>&quot;&lt;=&quot;</td><td>以下</td></tr><tr><td>&quot;&gt;=&quot;</td><td>以上</td></tr><tr><td>&quot;&lt;&gt;&quot;</td><td>等しくない</td></tr></tbody></table>
<ul>
<li>BETWEEN</li>
</ul>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-sql" style="white-space:pre"><span style="color:#f92672;font-weight:bold">SELECT</span><span> </span><span class="hljs-operator">*</span><span> </span><span style="color:#f92672;font-weight:bold">FROM</span><span> table_name </span><span style="color:#f92672;font-weight:bold">WHERE</span><span> </span><span style="color:#f92672;font-weight:bold">BETWEEN</span><span> value1 </span><span style="color:#f92672;font-weight:bold">AND</span><span> value2;</span></code></div><p class="h-2"></p></pre>
<p>指定した範囲に値があるものを取得.</p>
<ul>
<li>IN</li>
</ul>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-sql" style="white-space:pre"><span style="color:#f92672;font-weight:bold">SELECT</span><span> </span><span class="hljs-operator">*</span><span> </span><span style="color:#f92672;font-weight:bold">FROM</span><span> table_name </span><span style="color:#f92672;font-weight:bold">WHERE</span><span> col_name </span><span style="color:#f92672;font-weight:bold">IN</span><span> (</span><span style="color:#a6e22e">&#x27;value1&#x27;</span><span>, </span><span style="color:#a6e22e">&#x27;value2&#x27;</span><span>);</span></code></div><p class="h-2"></p></pre>
<p>指定した値のリストの中にあるものを取得.</p>
<ul>
<li>LIKE</li>
</ul>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-sql" style="white-space:pre"><span style="color:#f92672;font-weight:bold">SELECT</span><span> </span><span class="hljs-operator">*</span><span> </span><span style="color:#f92672;font-weight:bold">FROM</span><span> table_name </span><span style="color:#f92672;font-weight:bold">WHERE</span><span> col_name </span><span style="color:#f92672;font-weight:bold">LIKE</span><span> </span><span style="color:#a6e22e">&#x27;_100%&#x27;</span><span>;</span></code></div><p class="h-2"></p></pre>
<p><code node="[object Object]">%</code> は任意の文字数の任意の文字, <code node="[object Object]">_</code> は 1 文字の任意の文字.</p>
<ul>
<li>サブクエリ</li>
</ul>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-sql" style="white-space:pre"><span style="color:#f92672;font-weight:bold">SELECT</span><span> </span><span class="hljs-operator">*</span><span> </span><span style="color:#f92672;font-weight:bold">FROM</span><span> table_name
</span><span></span><span style="color:#f92672;font-weight:bold">WHERE</span><span> col_name1 </span><span class="hljs-operator">=</span><span> (
</span><span>  </span><span style="color:#f92672;font-weight:bold">SELECT</span><span> </span><span class="hljs-operator">*</span><span> </span><span style="color:#f92672;font-weight:bold">FROM</span><span> table_name </span><span style="color:#f92672;font-weight:bold">WHERE</span><span> col_name2 </span><span class="hljs-operator">=</span><span> </span><span style="color:#f92672;font-weight:bold">value</span><span>
</span>);
</code></div><p class="h-2"></p></pre>
<p>副問合せ.</p>
<h3>DISTINCT</h3>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-sql" style="white-space:pre"><span style="color:#f92672;font-weight:bold">SELECT</span><span> </span><span style="color:#f92672;font-weight:bold">DISTINCT</span><span> col_name1, col_name2, ... </span><span style="color:#f92672;font-weight:bold">FROM</span><span> table_name;</span></code></div><p class="h-2"></p></pre>
<p>SELECT の結果から重複業を除外できる.</p>
<p><code node="[object Object]">GROUP BY</code> でも重複削除できる.</p>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-sql" style="white-space:pre"><span style="color:#f92672;font-weight:bold">SELECT</span><span> col_name1, col_name2, ... </span><span style="color:#f92672;font-weight:bold">FROM</span><span> table_name </span><span style="color:#f92672;font-weight:bold">GROUP</span><span> </span><span style="color:#f92672;font-weight:bold">BY</span><span> col_name1;</span></code></div><p class="h-2"></p></pre>
<h3>ORDER BY</h3>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-sql" style="white-space:pre"><span style="color:#f92672;font-weight:bold">SELECT</span><span> </span><span class="hljs-operator">*</span><span> </span><span style="color:#f92672;font-weight:bold">FROM</span><span> table_name </span><span style="color:#f92672;font-weight:bold">ORDER</span><span> </span><span style="color:#f92672;font-weight:bold">BY</span><span> col_name1 </span><span style="color:#f92672;font-weight:bold">ASC</span><span>, col_name2 </span><span style="color:#f92672;font-weight:bold">DESC</span><span>;</span></code></div><p class="h-2"></p></pre>
<p>ASC は昇順. DESC は降順. ASC は省略可能.</p>
<h3>LIMIT</h3>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-sql" style="white-space:pre"><span style="color:#f92672;font-weight:bold">SELECT</span><span> </span><span class="hljs-operator">*</span><span> </span><span style="color:#f92672;font-weight:bold">FROM</span><span> table_name </span><span style="color:#f92672;font-weight:bold">ORDER</span><span> </span><span style="color:#f92672;font-weight:bold">BY</span><span> col_name LIMIT </span><span class="hljs-number">5</span><span>;</span></code></div><p class="h-2"></p></pre>
<h3>集約関数</h3>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-sql" style="white-space:pre"><span style="color:#f92672;font-weight:bold">SELECT</span><span> col_name, </span><span style="color:#a6e22e">MAX</span><span>(col_name) </span><span style="color:#f92672;font-weight:bold">FROM</span><span> table_name;</span></code></div><p class="h-2"></p></pre>
<p>基本的に NULL は無視される.
集約関数の種類.</p>
<table><thead><tr><th>関数</th><th>意味</th></tr></thead><tbody><tr><td>MAX</td><td>最大値</td></tr><tr><td>MIN</td><td>最小値</td></tr><tr><td>SUM</td><td>合計</td></tr><tr><td>AVG</td><td>平均</td></tr><tr><td>COUNT</td><td>カウント</td></tr></tbody></table>
<p>SUM / AVG / COUNT は DISTINCT をサポートしている.</p>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-sql" style="white-space:pre"><span style="color:#f92672;font-weight:bold">SELECT</span><span> col_name, </span><span style="color:#a6e22e">COUNT</span><span>( </span><span style="color:#f92672;font-weight:bold">DISTINCT</span><span> col_name ) </span><span style="color:#f92672;font-weight:bold">FROM</span><span> table_name;</span></code></div><p class="h-2"></p></pre>
<h3>GROUP BY</h3>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-sql" style="white-space:pre"><span style="color:#f92672;font-weight:bold">SELECT</span><span> col_name, </span><span style="color:#a6e22e">COUNT</span><span>(col_name) </span><span style="color:#f92672;font-weight:bold">FROM</span><span> table_name </span><span style="color:#f92672;font-weight:bold">GROUP</span><span> </span><span style="color:#f92672;font-weight:bold">BY</span><span> col_name;</span></code></div><p class="h-2"></p></pre>
<p>テーブルを集約キーでグループ分けしてから集計する.</p>
<h3>HAVING</h3>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-sql" style="white-space:pre"><span style="color:#f92672;font-weight:bold">SELECT</span><span> </span><span style="color:#a6e22e">COUNT</span><span>(col_name1) </span><span style="color:#f92672;font-weight:bold">FROM</span><span> table_name </span><span style="color:#f92672;font-weight:bold">GROUP</span><span> </span><span style="color:#f92672;font-weight:bold">BY</span><span> col_name1 </span><span style="color:#f92672;font-weight:bold">HAVING</span><span> </span><span style="color:#a6e22e">COUNT</span><span>(col_name1) </span><span class="hljs-operator">&gt;=</span><span> </span><span style="color:#f92672;font-weight:bold">value</span><span>;</span></code></div><p class="h-2"></p></pre>
<p><code node="[object Object]">GROUP BY</code> されたグループに対して条件を指定できる.</p>
<p>この場合,列名 1 で集計した値をカウントしてから HAVING で指定した条件のもののみを取得する.</p>
<h2>結合 ( JOIN )</h2>
<p>結合の種類は3つ.</p>
<ul>
<li>クロス結合 ( CROSS JOIN )</li>
<li>内部結合 ( INNER JOIN )</li>
<li>外部結合 ( OUTER JOIN )</li>
</ul>
<h3>クロス結合 ( CROSS JOIN )</h3>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-sql" style="white-space:pre"><span style="color:#f92672;font-weight:bold">SELECT</span><span> </span><span class="hljs-operator">*</span><span>
</span><span></span><span style="color:#f92672;font-weight:bold">FROM</span><span> table_name1 </span><span style="color:#f92672;font-weight:bold">CROSS</span><span> </span><span style="color:#f92672;font-weight:bold">JOIN</span><span> table_name2;</span></code></div><p class="h-2"></p></pre>
<p>すべてのテーブルの組み合わせを作る.</p>
<h3>内部結合 ( INNER JOIN )</h3>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-sql" style="white-space:pre"><span style="color:#f92672;font-weight:bold">SELECT</span><span> table_name1.</span><span class="hljs-operator">*</span><span>, table_name2.col_name, ...
</span><span></span><span style="color:#f92672;font-weight:bold">FROM</span><span> table_name1 </span><span style="color:#f92672;font-weight:bold">INNER</span><span> </span><span style="color:#f92672;font-weight:bold">JOIN</span><span> table_name2
</span><span></span><span style="color:#f92672;font-weight:bold">ON</span><span> table_name1.col_name1 </span><span class="hljs-operator">=</span><span> table_name2.col_name1;</span></code></div><p class="h-2"></p></pre>
<p>クロス結合の部分集合.条件一致したものだけを取得する.</p>
<p><code node="[object Object]">USING</code> でも書ける.</p>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-sql" style="white-space:pre"><span style="color:#f92672;font-weight:bold">SELECT</span><span> table_name1.</span><span class="hljs-operator">*</span><span>, table_name2.col_name, ...
</span><span></span><span style="color:#f92672;font-weight:bold">FROM</span><span> table_name1 </span><span style="color:#f92672;font-weight:bold">INNER</span><span> </span><span style="color:#f92672;font-weight:bold">JOIN</span><span> table_name2 </span><span style="color:#f92672;font-weight:bold">USING</span><span>(col_name);</span></code></div><p class="h-2"></p></pre>
<h3>外部結合</h3>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-sql" style="white-space:pre"><span style="color:#f92672;font-weight:bold">SELECT</span><span> table_name1.</span><span class="hljs-operator">*</span><span>, table_name2.col_name, ...
</span><span></span><span style="color:#f92672;font-weight:bold">FROM</span><span> table_name1 ( </span><span style="color:#f92672;font-weight:bold">LEFT</span><span> </span><span class="hljs-operator">|</span><span> </span><span style="color:#f92672;font-weight:bold">RIGHT</span><span> ) </span><span style="color:#f92672;font-weight:bold">OUTER</span><span> </span><span style="color:#f92672;font-weight:bold">JOIN</span><span> table_name2
</span><span></span><span style="color:#f92672;font-weight:bold">ON</span><span> table_name1.col_name1 </span><span class="hljs-operator">=</span><span> table_name2.col_name1;</span></code></div><p class="h-2"></p></pre>
<p>内部結合と同様に条件一致したものを取得し,さらに, マッチしなかった ( LEFT | RIGHT ) のテーブルの行は残す.</p>
<table><thead><tr><th>書式</th><th>内容</th></tr></thead><tbody><tr><td>LEFT OUTER JOIN</td><td>FROM のあとに書かれたテーブルのデータだけを取得</td></tr><tr><td>RIGHT OUTER JOIN</td><td>JOIN の後に書かれたテーブルのデータだけを取得</td></tr></tbody></table>
<h2>テーブルの削除</h2>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-sql" style="white-space:pre"><span style="color:#f92672;font-weight:bold">DROP</span><span> </span><span style="color:#f92672;font-weight:bold">TABLE</span><span> table_name;</span></code></div><p class="h-2"></p></pre>
<h2>データの挿入</h2>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-sql" style="white-space:pre"><span style="color:#f92672;font-weight:bold">INSERT</span><span> </span><span style="color:#f92672;font-weight:bold">INTO</span><span> database_name.table_name(col_name1, col_name2, ...) </span><span style="color:#f92672;font-weight:bold">VALUES</span><span> (value1, value2, ...);</span></code></div><p class="h-2"></p></pre>
<p>全てのカラムに値を追加する場合は以下のように書ける.</p>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-sql" style="white-space:pre"><span style="color:#f92672;font-weight:bold">INSERT</span><span> </span><span style="color:#f92672;font-weight:bold">INTO</span><span> table_name </span><span style="color:#f92672;font-weight:bold">VALUES</span><span>(value1, value2, ...);</span></code></div><p class="h-2"></p></pre>
<h2>ビュー</h2>
<p>データを持たず実行分だけが入っている.</p>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-sql" style="white-space:pre"><span style="color:#f92672;font-weight:bold">CREATE</span><span> </span><span style="color:#f92672;font-weight:bold">VIEW</span><span> view_name (col_name1, col_name2, ...) </span><span style="color:#f92672;font-weight:bold">AS</span><span> select_statement;</span></code></div><p class="h-2"></p></pre>
<h2>数値として取り出す</h2>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-sql" style="white-space:pre"><span style="color:#f92672;font-weight:bold">SELECT</span><span> col_name </span><span style="color:#f92672;font-weight:bold">FROM</span><span> </span><span style="color:#f92672;font-weight:bold">as</span><span> unsigned </span><span style="color:#f92672;font-weight:bold">FROM</span><span> table_name;</span></code></div><p class="h-2"></p></pre>
<h2>index の付け方</h2>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-sql" style="white-space:pre"><span style="color:#f92672;font-weight:bold">ALTER</span><span> </span><span style="color:#f92672;font-weight:bold">TABLE</span><span> table_name </span><span style="color:#f92672;font-weight:bold">AND</span><span> INDEX index_name (col_name);</span></code></div><p class="h-2"></p></pre>
<h2>トランザクション</h2>
<p><code node="[object Object]">BEGIN</code> で開始して, <code node="[object Object]">COMMIT</code> で反映, <code node="[object Object]">ROLLBACK</code> で取り消しができる.</p>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-sql" style="white-space:pre"><span style="color:#f92672;font-weight:bold">BEGIN</span><span>;
</span>  SQL1;
<!-- -->  SQL2;
<span></span><span style="color:#f92672;font-weight:bold">COMMIT</span><span>;</span></code></div><p class="h-2"></p></pre></div><br/></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"docBody":{"id":"20191103015727","title":"データベース操作","content":"\n## データベースの作成\n```sql\nCREATE DATABASE database_name;\n```\n\n## データベースの削除\n```sql\nDROP DATABASE database_name;\n```\n\n## テーブルの作成\n```sql\nCREATE TABLE table_name (col_name type, ...);\n```\n\n### 主キー\n```sql\nCREATE TABLE table_name (col_name type, ..., PRIMARY KEY (col_name));\n```\n- PRIMARY KEY の重複と NULL は NG\n- 複数の列を指定できる (複合主キー)\n  - PRIMARY KEY(列名1, 列名2)\n\n### 外部キー\n```sql\nCREATE TABLE table_name (\n  col_name type, ...,\n  FOREIGN KEY (col_name) REFERENCES parent_table_name(col_name)\n);\n```\n- 子テーブルの外部キーの値は親テーブルに存在しないといけない\n- 参照される値 (親テーブル) の UPDATE / DELETE は NG\n\n#### 親テーブルの UPDATE / DELETE 時の設定\n```sql\nCREATE TABLE table_name (\n  col_name type, ...,\n  FOREIGN KEY (col_name) REFERENCES parent_table_name(col_name)\n  ON DELETE [ アクション ]\n  ON UPDATE [ アクション ]\n);\n\n```\n設定できるアクション.\n|アクション|詳細|\n|-|-|\nRESTRICT|親テーブルに対して UPDATE / DELETE を行うとエラーになる (デフォルト)\nCASCADE|親テーブルに対して UPDATE / DELETE を行うと,子テーブルの一致する行に自動的に UPDATE / DELETE を行う\nSET NULL|親テーブルに対して UPDATE / DELETE を行うと,子テーブルの外部キーを NULL に設定する\n\n\n## データの検索\n```sql\nSELECT col_name1, col_name2, ... FROM table_name [ 条件 ];\n```\n\n### 条件\n- 比較演算子\n\n|演算子|意味|\n|-|-|\n\"=\"|等しい\n\"\u003c\"|小さい\n\"\u003e\"|大きい\n\"\u003c=\"|以下\n\"\u003e=\"|以上\n\"\u003c\u003e\"|等しくない\n\n- BETWEEN\n```sql\nSELECT * FROM table_name WHERE BETWEEN value1 AND value2;\n```\n指定した範囲に値があるものを取得.\n\n- IN\n```sql\nSELECT * FROM table_name WHERE col_name IN ('value1', 'value2');\n```\n指定した値のリストの中にあるものを取得.\n\n- LIKE\n```sql\nSELECT * FROM table_name WHERE col_name LIKE '_100%';\n```\n`%` は任意の文字数の任意の文字, `_` は 1 文字の任意の文字.\n\n- サブクエリ\n```sql\nSELECT * FROM table_name\nWHERE col_name1 = (\n  SELECT * FROM table_name WHERE col_name2 = value\n);\n```\n副問合せ.\n\n### DISTINCT\n```sql\nSELECT DISTINCT col_name1, col_name2, ... FROM table_name;\n```\nSELECT の結果から重複業を除外できる.\n\n`GROUP BY` でも重複削除できる.\n```sql\nSELECT col_name1, col_name2, ... FROM table_name GROUP BY col_name1;\n```\n\n### ORDER BY\n```sql\nSELECT * FROM table_name ORDER BY col_name1 ASC, col_name2 DESC;\n```\nASC は昇順. DESC は降順. ASC は省略可能.\n\n### LIMIT\n```sql\nSELECT * FROM table_name ORDER BY col_name LIMIT 5;\n```\n\n### 集約関数\n```sql\nSELECT col_name, MAX(col_name) FROM table_name;\n```\n基本的に NULL は無視される.\n集約関数の種類.\n|関数|意味|\n|-|-|\nMAX|最大値\nMIN|最小値\nSUM|合計\nAVG|平均\nCOUNT|カウント\n\nSUM / AVG / COUNT は DISTINCT をサポートしている.\n```sql\nSELECT col_name, COUNT( DISTINCT col_name ) FROM table_name;\n```\n\n### GROUP BY\n```sql\nSELECT col_name, COUNT(col_name) FROM table_name GROUP BY col_name;\n```\nテーブルを集約キーでグループ分けしてから集計する.\n\n### HAVING\n```sql\nSELECT COUNT(col_name1) FROM table_name GROUP BY col_name1 HAVING COUNT(col_name1) \u003e= value;\n```\n`GROUP BY` されたグループに対して条件を指定できる.\n\nこの場合,列名 1 で集計した値をカウントしてから HAVING で指定した条件のもののみを取得する.\n\n## 結合 ( JOIN )\n結合の種類は3つ.\n- クロス結合 ( CROSS JOIN )\n- 内部結合 ( INNER JOIN )\n- 外部結合 ( OUTER JOIN )\n\n### クロス結合 ( CROSS JOIN )\n```sql\nSELECT *\nFROM table_name1 CROSS JOIN table_name2;\n```\nすべてのテーブルの組み合わせを作る.\n\n### 内部結合 ( INNER JOIN )\n```sql\nSELECT table_name1.*, table_name2.col_name, ...\nFROM table_name1 INNER JOIN table_name2\nON table_name1.col_name1 = table_name2.col_name1;\n```\nクロス結合の部分集合.条件一致したものだけを取得する.\n\n`USING` でも書ける.\n```sql\nSELECT table_name1.*, table_name2.col_name, ...\nFROM table_name1 INNER JOIN table_name2 USING(col_name);\n```\n\n### 外部結合\n```sql\nSELECT table_name1.*, table_name2.col_name, ...\nFROM table_name1 ( LEFT | RIGHT ) OUTER JOIN table_name2\nON table_name1.col_name1 = table_name2.col_name1;\n```\n内部結合と同様に条件一致したものを取得し,さらに, マッチしなかった ( LEFT | RIGHT ) のテーブルの行は残す.\n\n|書式|内容|\n|-|-|\nLEFT OUTER JOIN|FROM のあとに書かれたテーブルのデータだけを取得\nRIGHT OUTER JOIN|JOIN の後に書かれたテーブルのデータだけを取得\n\n## テーブルの削除\n```sql\nDROP TABLE table_name;\n```\n\n## データの挿入\n```sql\nINSERT INTO database_name.table_name(col_name1, col_name2, ...) VALUES (value1, value2, ...);\n```\n\n全てのカラムに値を追加する場合は以下のように書ける.\n```sql\nINSERT INTO table_name VALUES(value1, value2, ...);\n```\n\n## ビュー\nデータを持たず実行分だけが入っている.\n```sql\nCREATE VIEW view_name (col_name1, col_name2, ...) AS select_statement;\n```\n\n## 数値として取り出す\n```sql\nSELECT col_name FROM as unsigned FROM table_name;\n```\n\n## index の付け方\n```sql\nALTER TABLE table_name AND INDEX index_name (col_name);\n```\n\n## トランザクション\n`BEGIN` で開始して, `COMMIT` で反映, `ROLLBACK` で取り消しができる.\n```sql\nBEGIN;\n  SQL1;\n  SQL2;\nCOMMIT;\n```\n"}},"__N_SSG":true},"page":"/docs/[id]","query":{"id":"20191103015727"},"buildId":"4t-InvnG14DSacseRZYYJ","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>