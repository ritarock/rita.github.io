<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>MyDocs</title><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/css/a58c9bb1e05a64ba.css" as="style"/><link rel="stylesheet" href="/_next/static/css/a58c9bb1e05a64ba.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-d38be8d96a62f950.js" defer=""></script><script src="/_next/static/chunks/framework-2c79e2a64abdb08b.js" defer=""></script><script src="/_next/static/chunks/main-a0dca5a2ff5035f1.js" defer=""></script><script src="/_next/static/chunks/pages/_app-f35537586aa9f5dd.js" defer=""></script><script src="/_next/static/chunks/996-eeb5175dbd5dba8f.js" defer=""></script><script src="/_next/static/chunks/635-77cab1cb386ca7f8.js" defer=""></script><script src="/_next/static/chunks/pages/docs/%5Bid%5D-f16bc0121a6e0d8a.js" defer=""></script><script src="/_next/static/Pprqt13nm5vtswVY-tT11/_buildManifest.js" defer=""></script><script src="/_next/static/Pprqt13nm5vtswVY-tT11/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div><a style="text-decoration:none" href="/"><div style="color:black;font-size:22px;cursor:pointer">MyDocs</div></a></div><p></p><h1><b># <!-- -->cobra-cli を使う</b></h1><h2>cobra-cli を使う</h2>
<h3>docker でやる</h3>
<p><code>Dockerfile</code> と <code>docker-composer.yml</code> を用意。</p>
<pre><div class="sc-bcXHqe lmagiH"><div class="sc-gswNZR jJknjO">bash</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-shell" style="white-space:pre"><span style="color:#75715e">$</span><span class="bash"> cat Dockerfile</span><span>
</span>FROM golang:1.18.1-buster
<!-- -->WORKDIR /app
<!-- -->RUN go install github.com/spf13/cobra-cli@latest
<!-- -->ENTRYPOINT [ &quot;/go/bin/cobra-cli&quot; ]
<span></span><span style="color:#75715e">
</span><span style="color:#75715e">$</span><span class="bash"> cat docker-compose.yml</span><span>
</span>version: &#x27;3&#x27;
<!-- -->services:
<!-- -->  cobra-cli:
<!-- -->    build: .
<!-- -->    volumes:
<!-- -->      - .:/app</code></pre></div></pre>
<h3>go.mod を作成</h3>
<pre><div class="sc-bcXHqe lmagiH"><div class="sc-gswNZR jJknjO">bash</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-shell" style="white-space:pre"><span style="color:#75715e">$</span><span class="bash"> go mod init sample</span><span>
</span>go: creating new go.mod: module sample</code></pre></div></pre>
<h3>project の開始</h3>
<pre><div class="sc-bcXHqe lmagiH"><div class="sc-gswNZR jJknjO">bash</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-shell" style="white-space:pre"><span style="color:#75715e">$</span><span class="bash"> tree</span><span>
</span>.
<!-- -->├── Dockerfile
<!-- -->├── docker-compose.yml
<!-- -->└── go.mod</code></pre></div></pre>
<p><code>init</code> コマンドを実行。</p>
<pre><div class="sc-bcXHqe lmagiH"><div class="sc-gswNZR jJknjO">bash</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-shell" style="white-space:pre"><span style="color:#75715e">$</span><span class="bash"> docker-compose run cobra-cli init</span><span>
</span><span></span><span style="color:#75715e">
</span><span style="color:#75715e">$</span><span class="bash"> tree</span><span>
</span>tree
<!-- -->.
<!-- -->├── Dockerfile
<!-- -->├── LICENSE
<!-- -->├── cmd
<!-- -->│   └── root.go
<!-- -->├── docker-compose.yml
<!-- -->├── go.mod
<!-- -->├── go.sum
<!-- -->└── main.go</code></pre></div></pre>
<p><code>main.go</code> は <code>cmd.Execute()</code> を呼び出しているだけ。</p>
<pre><div class="sc-bcXHqe lmagiH"><div class="sc-gswNZR jJknjO">go</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-go" style="white-space:pre"><span style="color:#75715e">/*
</span><span style="color:#75715e">Copyright © 2022 NAME HERE &lt;EMAIL ADDRESS&gt;
</span><span style="color:#75715e">
</span><span style="color:#75715e">*/</span><span>
</span><span></span><span style="color:#f92672;font-weight:bold">package</span><span> main
</span>
<span></span><span style="color:#f92672;font-weight:bold">import</span><span> </span><span style="color:#a6e22e">&quot;sample/cmd&quot;</span><span>
</span>
<span></span><span class="hljs-function" style="color:#f92672;font-weight:bold">func</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">main</span><span class="hljs-function hljs-params">()</span><span> {
</span>	cmd.Execute()
<!-- -->}</code></pre></div></pre>
<p><code>cmd/root.go</code> を編集。実行したら <code>Hello</code> を出力する。</p>
<pre><div class="sc-bcXHqe lmagiH"><div class="sc-gswNZR jJknjO">go</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-go" style="white-space:pre"><span style="color:#75715e">/*
</span><span style="color:#75715e">Copyright © 2022 NAME HERE &lt;EMAIL ADDRESS&gt;
</span><span style="color:#75715e">
</span><span style="color:#75715e">*/</span><span>
</span><span></span><span style="color:#f92672;font-weight:bold">package</span><span> cmd
</span>
<span></span><span style="color:#f92672;font-weight:bold">import</span><span> (
</span><span>	</span><span style="color:#a6e22e">&quot;fmt&quot;</span><span>
</span><span>	</span><span style="color:#a6e22e">&quot;os&quot;</span><span>
</span>
<span>	</span><span style="color:#a6e22e">&quot;github.com/spf13/cobra&quot;</span><span>
</span>)
<!-- -->
<span></span><span style="color:#75715e">// rootCmd represents the base command when called without any subcommands</span><span>
</span><span></span><span style="color:#f92672;font-weight:bold">var</span><span> rootCmd = &amp;cobra.Command{
</span><span>	Use:   </span><span style="color:#a6e22e">&quot;sample&quot;</span><span>,
</span><span>	Short: </span><span style="color:#a6e22e">&quot;挨拶をします&quot;</span><span>,
</span><span>	RunE: </span><span class="hljs-function" style="color:#f92672;font-weight:bold">func</span><span class="hljs-function hljs-params">(cmd *cobra.Command, args []</span><span class="hljs-function hljs-params" style="color:#f92672;font-weight:bold">string</span><span class="hljs-function hljs-params">)</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">error</span><span> {
</span><span>		fmt.Println(</span><span style="color:#a6e22e">&quot;Hello&quot;</span><span>)
</span><span>		</span><span style="color:#f92672;font-weight:bold">return</span><span> </span><span style="color:#f92672;font-weight:bold">nil</span><span>
</span>	},
<!-- -->}
<!-- -->
<span></span><span style="color:#75715e">// Execute adds all child commands to the root command and sets flags appropriately.</span><span>
</span><span></span><span style="color:#75715e">// This is called by main.main(). It only needs to happen once to the rootCmd.</span><span>
</span><span></span><span class="hljs-function" style="color:#f92672;font-weight:bold">func</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">Execute</span><span class="hljs-function hljs-params">()</span><span> {
</span>	err := rootCmd.Execute()
<span>	</span><span style="color:#f92672;font-weight:bold">if</span><span> err != </span><span style="color:#f92672;font-weight:bold">nil</span><span> {
</span><span>		os.Exit(</span><span class="hljs-number">1</span><span>)
</span>	}
<!-- -->}
<!-- -->
<span></span><span class="hljs-function" style="color:#f92672;font-weight:bold">func</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">init</span><span class="hljs-function hljs-params">()</span><span> {
</span>}</code></pre></div></pre>
<p>実行。</p>
<pre><div class="sc-bcXHqe lmagiH"><div class="sc-gswNZR jJknjO">bash</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-shell" style="white-space:pre"><span style="color:#75715e">$</span><span class="bash"> go run main.go</span><span>
</span>Hello</code></pre></div></pre>
<p>help を見る。</p>
<pre><div class="sc-bcXHqe lmagiH"><div class="sc-gswNZR jJknjO">bash</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-shell" style="white-space:pre"><span style="color:#75715e">$</span><span class="bash"> go run main.go -h</span><span>
</span>挨拶をします
<!-- -->
<!-- -->Usage:
<!-- -->  sample [flags]
<!-- -->
<!-- -->Flags:
<!-- -->  -h, --help   help for sample</code></pre></div></pre>
<h2>フラグを設定</h2>
<h3>グローバルフラグを設定</h3>
<p><code>--night</code> をつければ <code>Good night</code> を出力する。</p>
<pre><div class="sc-bcXHqe lmagiH"><div class="sc-gswNZR jJknjO">go</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-go" style="white-space:pre"><span style="color:#75715e">/*
</span><span style="color:#75715e">Copyright © 2022 NAME HERE &lt;EMAIL ADDRESS&gt;
</span><span style="color:#75715e">
</span><span style="color:#75715e">*/</span><span>
</span><span></span><span style="color:#f92672;font-weight:bold">package</span><span> cmd
</span>
<span></span><span style="color:#f92672;font-weight:bold">import</span><span> (
</span><span>	</span><span style="color:#a6e22e">&quot;fmt&quot;</span><span>
</span><span>	</span><span style="color:#a6e22e">&quot;os&quot;</span><span>
</span>
<span>	</span><span style="color:#a6e22e">&quot;github.com/spf13/cobra&quot;</span><span>
</span>)
<!-- -->
<span></span><span style="color:#f92672;font-weight:bold">var</span><span> night </span><span style="color:#f92672;font-weight:bold">bool</span><span>
</span>
<span></span><span style="color:#75715e">// rootCmd represents the base command when called without any subcommands</span><span>
</span><span></span><span style="color:#f92672;font-weight:bold">var</span><span> rootCmd = &amp;cobra.Command{
</span><span>	Use:   </span><span style="color:#a6e22e">&quot;sample&quot;</span><span>,
</span><span>	Short: </span><span style="color:#a6e22e">&quot;挨拶をします&quot;</span><span>,
</span><span>	RunE: </span><span class="hljs-function" style="color:#f92672;font-weight:bold">func</span><span class="hljs-function hljs-params">(cmd *cobra.Command, args []</span><span class="hljs-function hljs-params" style="color:#f92672;font-weight:bold">string</span><span class="hljs-function hljs-params">)</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">error</span><span> {
</span><span>		</span><span style="color:#f92672;font-weight:bold">if</span><span> night {
</span><span>			fmt.Println(</span><span style="color:#a6e22e">&quot;Good night&quot;</span><span>)
</span><span>			</span><span style="color:#f92672;font-weight:bold">return</span><span> </span><span style="color:#f92672;font-weight:bold">nil</span><span>
</span>		}
<span>		fmt.Println(</span><span style="color:#a6e22e">&quot;Hello&quot;</span><span>)
</span><span>		</span><span style="color:#f92672;font-weight:bold">return</span><span> </span><span style="color:#f92672;font-weight:bold">nil</span><span>
</span>	},
<!-- -->}
<!-- -->
<span></span><span style="color:#75715e">// Execute adds all child commands to the root command and sets flags appropriately.</span><span>
</span><span></span><span style="color:#75715e">// This is called by main.main(). It only needs to happen once to the rootCmd.</span><span>
</span><span></span><span class="hljs-function" style="color:#f92672;font-weight:bold">func</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">Execute</span><span class="hljs-function hljs-params">()</span><span> {
</span>	err := rootCmd.Execute()
<span>	</span><span style="color:#f92672;font-weight:bold">if</span><span> err != </span><span style="color:#f92672;font-weight:bold">nil</span><span> {
</span><span>		os.Exit(</span><span class="hljs-number">1</span><span>)
</span>	}
<!-- -->}
<!-- -->
<span></span><span class="hljs-function" style="color:#f92672;font-weight:bold">func</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">init</span><span class="hljs-function hljs-params">()</span><span> {
</span><span>	rootCmd.PersistentFlags().BoolVar(&amp;night, </span><span style="color:#a6e22e">&quot;night&quot;</span><span>, </span><span style="color:#f92672;font-weight:bold">false</span><span>, </span><span style="color:#a6e22e">&quot;night フラグの説明文です&quot;</span><span>)
</span>}</code></pre></div></pre>
<p>実行。</p>
<pre><div class="sc-bcXHqe lmagiH"><div class="sc-gswNZR jJknjO">bash</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-shell" style="white-space:pre"><span style="color:#75715e">$</span><span class="bash"> go run main.go -h</span><span>
</span>挨拶をします
<!-- -->
<!-- -->Usage:
<!-- -->  sample [flags]
<!-- -->
<!-- -->Flags:
<!-- -->  -h, --help    help for sample
<!-- -->      --night   night フラグの説明文です
<span></span><span style="color:#75715e">
</span><span style="color:#75715e">$</span><span class="bash"> go run main.go</span><span>
</span>Hello
<span></span><span style="color:#75715e">
</span><span style="color:#75715e">$</span><span class="bash"> go run main.go --night</span><span>
</span>Good night</code></pre></div></pre>
<h4>shorthand で設定する</h4>
<pre><div class="sc-bcXHqe lmagiH"><div class="sc-gswNZR jJknjO">go</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-go" style="white-space:pre"><span class="hljs-function" style="color:#f92672;font-weight:bold">func</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">init</span><span class="hljs-function hljs-params">()</span><span> {
</span><span>	</span><span style="color:#75715e">// rootCmd.PersistentFlags().BoolVar(&amp;night, &quot;night&quot;, false, &quot;night フラグの説明文です&quot;)</span><span>
</span><span>	rootCmd.PersistentFlags().BoolVarP(&amp;night, </span><span style="color:#a6e22e">&quot;night&quot;</span><span>, </span><span style="color:#a6e22e">&quot;n&quot;</span><span>, </span><span style="color:#f92672;font-weight:bold">false</span><span>, </span><span style="color:#a6e22e">&quot;night フラグの説明文です&quot;</span><span>)
</span>}</code></pre></div></pre>
<p>実行。</p>
<pre><div class="sc-bcXHqe lmagiH"><div class="sc-gswNZR jJknjO">bash</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-shell" style="white-space:pre"><span style="color:#75715e">$</span><span class="bash"> go run main.go -h</span><span>
</span>挨拶をします
<!-- -->
<!-- -->Usage:
<!-- -->  sample [flags]
<!-- -->
<!-- -->Flags:
<!-- -->  -h, --help    help for sample
<!-- -->  -n, --night   night フラグの説明文です
<span></span><span style="color:#75715e">
</span><span style="color:#75715e">$</span><span class="bash"> go run main.go -n</span><span>
</span>Good night</code></pre></div></pre>
<h3>ローカルフラグを設定する</h3>
<p><code>--name</code> をつければ挨拶の後に名前を出力する。
今度は変数を設定しないでフラグの値を取得してみる。</p>
<pre><div class="sc-bcXHqe lmagiH"><div class="sc-gswNZR jJknjO">go</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-go" style="white-space:pre"><span style="color:#75715e">/*
</span><span style="color:#75715e">Copyright © 2022 NAME HERE &lt;EMAIL ADDRESS&gt;
</span><span style="color:#75715e">
</span><span style="color:#75715e">*/</span><span>
</span><span></span><span style="color:#f92672;font-weight:bold">package</span><span> cmd
</span>
<span></span><span style="color:#f92672;font-weight:bold">import</span><span> (
</span><span>	</span><span style="color:#a6e22e">&quot;fmt&quot;</span><span>
</span><span>	</span><span style="color:#a6e22e">&quot;os&quot;</span><span>
</span>
<span>	</span><span style="color:#a6e22e">&quot;github.com/spf13/cobra&quot;</span><span>
</span>)
<!-- -->
<span></span><span style="color:#f92672;font-weight:bold">var</span><span> night </span><span style="color:#f92672;font-weight:bold">bool</span><span>
</span>
<span></span><span style="color:#75715e">// rootCmd represents the base command when called without any subcommands</span><span>
</span><span></span><span style="color:#f92672;font-weight:bold">var</span><span> rootCmd = &amp;cobra.Command{
</span><span>	Use:   </span><span style="color:#a6e22e">&quot;sample&quot;</span><span>,
</span><span>	Short: </span><span style="color:#a6e22e">&quot;挨拶をします&quot;</span><span>,
</span><span>	RunE: </span><span class="hljs-function" style="color:#f92672;font-weight:bold">func</span><span class="hljs-function hljs-params">(cmd *cobra.Command, args []</span><span class="hljs-function hljs-params" style="color:#f92672;font-weight:bold">string</span><span class="hljs-function hljs-params">)</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">error</span><span> {
</span><span>		name, _ := cmd.Flags().GetString(</span><span style="color:#a6e22e">&quot;name&quot;</span><span>)
</span><span>		</span><span style="color:#f92672;font-weight:bold">if</span><span> night {
</span><span>			fmt.Println(</span><span style="color:#a6e22e">&quot;Good night &quot;</span><span> + name)
</span><span>			</span><span style="color:#f92672;font-weight:bold">return</span><span> </span><span style="color:#f92672;font-weight:bold">nil</span><span>
</span>		}
<span>		fmt.Println(</span><span style="color:#a6e22e">&quot;Hello &quot;</span><span> + name)
</span><span>		</span><span style="color:#f92672;font-weight:bold">return</span><span> </span><span style="color:#f92672;font-weight:bold">nil</span><span>
</span>	},
<!-- -->}
<!-- -->
<span></span><span style="color:#75715e">// Execute adds all child commands to the root command and sets flags appropriately.</span><span>
</span><span></span><span style="color:#75715e">// This is called by main.main(). It only needs to happen once to the rootCmd.</span><span>
</span><span></span><span class="hljs-function" style="color:#f92672;font-weight:bold">func</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">Execute</span><span class="hljs-function hljs-params">()</span><span> {
</span>	err := rootCmd.Execute()
<span>	</span><span style="color:#f92672;font-weight:bold">if</span><span> err != </span><span style="color:#f92672;font-weight:bold">nil</span><span> {
</span><span>		os.Exit(</span><span class="hljs-number">1</span><span>)
</span>	}
<!-- -->}
<!-- -->
<span></span><span class="hljs-function" style="color:#f92672;font-weight:bold">func</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">init</span><span class="hljs-function hljs-params">()</span><span> {
</span><span>	rootCmd.PersistentFlags().BoolVarP(&amp;night, </span><span style="color:#a6e22e">&quot;night&quot;</span><span>, </span><span style="color:#a6e22e">&quot;n&quot;</span><span>, </span><span style="color:#f92672;font-weight:bold">false</span><span>, </span><span style="color:#a6e22e">&quot;night フラグの説明文です&quot;</span><span>)
</span><span>	rootCmd.Flags().StringP(</span><span style="color:#a6e22e">&quot;name&quot;</span><span>, </span><span style="color:#a6e22e">&quot;a&quot;</span><span>, </span><span style="color:#a6e22e">&quot;&quot;</span><span>, </span><span style="color:#a6e22e">&quot;name フラグの説明文です&quot;</span><span>)
</span>}</code></pre></div></pre>
<p>実行。</p>
<pre><div class="sc-bcXHqe lmagiH"><div class="sc-gswNZR jJknjO">bash</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-shell" style="white-space:pre"><span style="color:#75715e">$</span><span class="bash"> go run main.go -h</span><span>
</span>挨拶をします
<!-- -->
<!-- -->Usage:
<!-- -->  sample [flags]
<!-- -->
<!-- -->Flags:
<!-- -->  -h, --help          help for sample
<!-- -->  -a, --name string   name フラグの説明文です
<!-- -->  -n, --night         night フラグの説明文です
<span></span><span style="color:#75715e">
</span><span style="color:#75715e">$</span><span class="bash"> go run main.go</span><span>
</span>Hello 
<span></span><span style="color:#75715e">$</span><span class="bash"> go run main.go -a aaa</span><span>
</span>Hello aaa
<span></span><span style="color:#75715e">
</span><span style="color:#75715e">$</span><span class="bash"> go run main.go -a aaa --night</span><span>
</span>Good night aaa</code></pre></div></pre>
<h4>フラグの値の取得方法</h4>
<p><code>~P</code> がついている方は <code>shorthand</code> を設定できる。
<code>~Var</code> がついている方は直接値を設定できる。</p>
<pre><div class="sc-bcXHqe lmagiH"><div class="sc-gswNZR jJknjO">go</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-go" style="white-space:pre"><span>rootCmd.Flags().String(</span><span style="color:#a6e22e">&quot;name&quot;</span><span>, </span><span style="color:#a6e22e">&quot;&quot;</span><span>, </span><span style="color:#a6e22e">&quot;name フラグの説明文です&quot;</span><span>)
</span><span>rootCmd.Flags().StringP(</span><span style="color:#a6e22e">&quot;name&quot;</span><span>, </span><span style="color:#a6e22e">&quot;a&quot;</span><span>, </span><span style="color:#a6e22e">&quot;&quot;</span><span>, </span><span style="color:#a6e22e">&quot;name フラグの説明文です&quot;</span><span>)
</span><span>rootCmd.Flags().StringVar(&amp;name, </span><span style="color:#a6e22e">&quot;name&quot;</span><span>, </span><span style="color:#a6e22e">&quot;&quot;</span><span>, </span><span style="color:#a6e22e">&quot;name フラグの説明文です&quot;</span><span>)
</span><span>rootCmd.Flags().StringVarP(&amp;name, </span><span style="color:#a6e22e">&quot;name&quot;</span><span>, </span><span style="color:#a6e22e">&quot;a&quot;</span><span>, </span><span style="color:#a6e22e">&quot;&quot;</span><span>, </span><span style="color:#a6e22e">&quot;name フラグの説明文です&quot;</span><span>)</span></code></pre></div></pre>
<h3>必須フラグ</h3>
<pre><div class="sc-bcXHqe lmagiH"><div class="sc-gswNZR jJknjO">go</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-go" style="white-space:pre"><span class="hljs-function" style="color:#f92672;font-weight:bold">func</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">init</span><span class="hljs-function hljs-params">()</span><span> {
</span><span>	rootCmd.PersistentFlags().BoolVarP(&amp;night, </span><span style="color:#a6e22e">&quot;night&quot;</span><span>, </span><span style="color:#a6e22e">&quot;n&quot;</span><span>, </span><span style="color:#f92672;font-weight:bold">false</span><span>, </span><span style="color:#a6e22e">&quot;night フラグの説明文です&quot;</span><span>)
</span><span>	rootCmd.Flags().StringP(</span><span style="color:#a6e22e">&quot;name&quot;</span><span>, </span><span style="color:#a6e22e">&quot;a&quot;</span><span>, </span><span style="color:#a6e22e">&quot;&quot;</span><span>, </span><span style="color:#a6e22e">&quot;name フラグの説明文です (required)&quot;</span><span>)
</span><span>	rootCmd.MarkFlagRequired(</span><span style="color:#a6e22e">&quot;name&quot;</span><span>)
</span>}</code></pre></div></pre>
<p>実行。</p>
<pre><div class="sc-bcXHqe lmagiH"><div class="sc-gswNZR jJknjO">bash</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-shell" style="white-space:pre"><span style="color:#75715e">$</span><span class="bash"> go run main.go</span><span>
</span>Error: required flag(s) &quot;name&quot; not set
<!-- -->Usage:
<!-- -->  sample [flags]
<!-- -->
<!-- -->Flags:
<!-- -->  -h, --help          help for sample
<!-- -->  -a, --name string   name フラグの説明文です (required)
<!-- -->  -n, --night         night フラグの説明文です
<span></span><span style="color:#75715e">
</span><span style="color:#75715e">$</span><span class="bash"> go run main.go -a aaa</span><span>
</span>Hello aaa</code></pre></div></pre>
<h3>引数の設定</h3>
<p>引数に数字を 2 つ与えるとその合計を出力する。</p>
<pre><div class="sc-bcXHqe lmagiH"><div class="sc-gswNZR jJknjO">go</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-go" style="white-space:pre"><span style="color:#75715e">// rootCmd represents the base command when called without any subcommands</span><span>
</span><span></span><span style="color:#f92672;font-weight:bold">var</span><span> rootCmd = &amp;cobra.Command{
</span><span>	Use:   </span><span style="color:#a6e22e">&quot;sample&quot;</span><span>,
</span><span>	Short: </span><span style="color:#a6e22e">&quot;挨拶をします&quot;</span><span>,
</span><span>	RunE: </span><span class="hljs-function" style="color:#f92672;font-weight:bold">func</span><span class="hljs-function hljs-params">(cmd *cobra.Command, args []</span><span class="hljs-function hljs-params" style="color:#f92672;font-weight:bold">string</span><span class="hljs-function hljs-params">)</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">error</span><span> {
</span><span>		name, _ := cmd.Flags().GetString(</span><span style="color:#a6e22e">&quot;name&quot;</span><span>)
</span>
<span>		</span><span style="color:#f92672;font-weight:bold">if</span><span> night {
</span><span>			fmt.Println(</span><span style="color:#a6e22e">&quot;Good night &quot;</span><span> + name)
</span><span>			</span><span style="color:#f92672;font-weight:bold">if</span><span> </span><span style="color:#a6e22e">len</span><span>(args) &gt; </span><span class="hljs-number">0</span><span> {
</span><span>				firstNum, _ := strconv.Atoi(args[</span><span class="hljs-number">0</span><span>])
</span><span>				secondNum, _ := strconv.Atoi(args[</span><span class="hljs-number">1</span><span>])
</span><span>				fmt.Printf(</span><span style="color:#a6e22e">&quot;SUM: %v\n&quot;</span><span>, firstNum+secondNum)
</span>			}
<span>			</span><span style="color:#f92672;font-weight:bold">return</span><span> </span><span style="color:#f92672;font-weight:bold">nil</span><span>
</span>		}
<!-- -->
<span>		fmt.Println(</span><span style="color:#a6e22e">&quot;Hello &quot;</span><span> + name)
</span><span>		</span><span style="color:#f92672;font-weight:bold">if</span><span> </span><span style="color:#a6e22e">len</span><span>(args) &gt; </span><span class="hljs-number">0</span><span> {
</span><span>			firstNum, _ := strconv.Atoi(args[</span><span class="hljs-number">0</span><span>])
</span><span>			secondNum, _ := strconv.Atoi(args[</span><span class="hljs-number">1</span><span>])
</span><span>			fmt.Printf(</span><span style="color:#a6e22e">&quot;SUM: %v\n&quot;</span><span>, firstNum+secondNum)
</span>		}
<span>		</span><span style="color:#f92672;font-weight:bold">return</span><span> </span><span style="color:#f92672;font-weight:bold">nil</span><span>
</span>	},
<!-- -->}</code></pre></div></pre>
<p>実行。</p>
<pre><div class="sc-bcXHqe lmagiH"><div class="sc-gswNZR jJknjO">bash</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-shell" style="white-space:pre"><span style="color:#75715e">$</span><span class="bash"> go run main.go -a aaa</span><span>
</span>Hello aaa
<span></span><span style="color:#75715e">
</span><span style="color:#75715e">$</span><span class="bash"> go run main.go -a aaa 1 99</span><span>
</span>Hello aaa
<!-- -->SUM: 100</code></pre></div></pre>
<h4>バリデーションチェック</h4>
<p>これらのメソッドが用意されている。</p>
<table><thead><tr><th>メソッド</th><th>機能</th></tr></thead><tbody><tr><td>NoArgs</td><td>引数が存在したらエラーを返す</td></tr><tr><td>OnlyValidArgs</td><td>ValidArgs に含まれていないとエラーを返す</td></tr><tr><td>ArbitraryArgs</td><td>エラーを返さない</td></tr><tr><td>MinimumNArgs(n)</td><td>少なくとも n 個の引数がないとエラーを返す</td></tr><tr><td>MaximumNArgs(n)</td><td>n 個以上の引数があるとエラーを返す</td></tr><tr><td>ExactArgs(n)</td><td>n 個の引数以外だとエラーを返す</td></tr><tr><td>ExactValidArgs(int)</td><td>n 個の引数以外 or ValidArgs フィールドにない位置引数がある場合はエラーを返す</td></tr><tr><td>RangeArgs(min, max)</td><td>範囲内の値でないとエラーを返す</td></tr></tbody></table>
<p>こんな感じで設定できる。</p>
<pre><div class="sc-bcXHqe lmagiH"><div class="sc-gswNZR jJknjO">go</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-go" style="white-space:pre"><span>Args:  cobra.ExactArgs(</span><span class="hljs-number">1</span><span>),</span></code></pre></div></pre>
<p>複数のバリデーションをチェックする場合は <code>MatchAll</code> を使えば良さそう。</p>
<pre><div class="sc-bcXHqe lmagiH"><div class="sc-gswNZR jJknjO">go</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-go" style="white-space:pre"><span style="color:#75715e">// MatchAll allows combining several PositionalArgs to work in concert.</span><span>
</span><span></span><span class="hljs-function" style="color:#f92672;font-weight:bold">func</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">MatchAll</span><span class="hljs-function hljs-params">(pargs ...PositionalArgs)</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">PositionalArgs</span><span> {
</span><span>	</span><span style="color:#f92672;font-weight:bold">return</span><span> </span><span class="hljs-function" style="color:#f92672;font-weight:bold">func</span><span class="hljs-function hljs-params">(cmd *Command, args []</span><span class="hljs-function hljs-params" style="color:#f92672;font-weight:bold">string</span><span class="hljs-function hljs-params">)</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">error</span><span> {
</span><span>		</span><span style="color:#f92672;font-weight:bold">for</span><span> _, parg := </span><span style="color:#f92672;font-weight:bold">range</span><span> pargs {
</span><span>			</span><span style="color:#f92672;font-weight:bold">if</span><span> err := parg(cmd, args); err != </span><span style="color:#f92672;font-weight:bold">nil</span><span> {
</span><span>				</span><span style="color:#f92672;font-weight:bold">return</span><span> err
</span>			}
<!-- -->		}
<span>		</span><span style="color:#f92672;font-weight:bold">return</span><span> </span><span style="color:#f92672;font-weight:bold">nil</span><span>
</span>	}
<!-- -->}</code></pre></div></pre>
<p>今回は 2 個の引数のみ受け付ける。かつ、値が数値であることのみ許可する。</p>
<pre><div class="sc-bcXHqe lmagiH"><div class="sc-gswNZR jJknjO">go</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-go" style="white-space:pre"><span style="color:#f92672;font-weight:bold">var</span><span> rootCmd = &amp;cobra.Command{
</span><span>	Use:   </span><span style="color:#a6e22e">&quot;sample&quot;</span><span>,
</span><span>	Short: </span><span style="color:#a6e22e">&quot;挨拶をします。2 つの int を渡すと計算もします&quot;</span><span>,
</span><span>	Args: </span><span class="hljs-function" style="color:#f92672;font-weight:bold">func</span><span class="hljs-function hljs-params">(cmd *cobra.Command, args []</span><span class="hljs-function hljs-params" style="color:#f92672;font-weight:bold">string</span><span class="hljs-function hljs-params">)</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">error</span><span> {
</span><span>		</span><span style="color:#f92672;font-weight:bold">if</span><span> </span><span style="color:#a6e22e">len</span><span>(args) == </span><span class="hljs-number">0</span><span> {
</span><span>			</span><span style="color:#f92672;font-weight:bold">return</span><span> </span><span style="color:#f92672;font-weight:bold">nil</span><span>
</span><span>		} </span><span style="color:#f92672;font-weight:bold">else</span><span> {
</span><span>			</span><span style="color:#f92672;font-weight:bold">if</span><span> </span><span style="color:#a6e22e">len</span><span>(args) != </span><span class="hljs-number">2</span><span> {
</span><span>				</span><span style="color:#f92672;font-weight:bold">return</span><span> errors.New(</span><span style="color:#a6e22e">&quot;引数の数が不正です&quot;</span><span>)
</span>			}
<span>			_, err1 := strconv.Atoi(args[</span><span class="hljs-number">0</span><span>])
</span><span>			_, err2 := strconv.Atoi(args[</span><span class="hljs-number">1</span><span>])
</span><span>			</span><span style="color:#f92672;font-weight:bold">if</span><span> err1 != </span><span style="color:#f92672;font-weight:bold">nil</span><span> || err2 != </span><span style="color:#f92672;font-weight:bold">nil</span><span> {
</span><span>				</span><span style="color:#f92672;font-weight:bold">return</span><span> errors.New(</span><span style="color:#a6e22e">&quot;引数の型が不正です&quot;</span><span>)
</span>			}
<!-- -->		}
<span>		</span><span style="color:#f92672;font-weight:bold">return</span><span> </span><span style="color:#f92672;font-weight:bold">nil</span><span>
</span>	},
<span>	RunE: </span><span class="hljs-function" style="color:#f92672;font-weight:bold">func</span><span class="hljs-function hljs-params">(cmd *cobra.Command, args []</span><span class="hljs-function hljs-params" style="color:#f92672;font-weight:bold">string</span><span class="hljs-function hljs-params">)</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">error</span><span> {
</span><span>		name, _ := cmd.Flags().GetString(</span><span style="color:#a6e22e">&quot;name&quot;</span><span>)
</span>
<span>		</span><span style="color:#f92672;font-weight:bold">if</span><span> night {
</span><span>			fmt.Println(</span><span style="color:#a6e22e">&quot;Good night &quot;</span><span> + name)
</span><span>			</span><span style="color:#f92672;font-weight:bold">if</span><span> </span><span style="color:#a6e22e">len</span><span>(args) &gt; </span><span class="hljs-number">0</span><span> {
</span><span>				firstNum, _ := strconv.Atoi(args[</span><span class="hljs-number">0</span><span>])
</span><span>				secondNum, _ := strconv.Atoi(args[</span><span class="hljs-number">1</span><span>])
</span><span>				fmt.Printf(</span><span style="color:#a6e22e">&quot;SUM: %v\n&quot;</span><span>, firstNum+secondNum)
</span>			}
<span>			</span><span style="color:#f92672;font-weight:bold">return</span><span> </span><span style="color:#f92672;font-weight:bold">nil</span><span>
</span>		}
<!-- -->
<span>		fmt.Println(</span><span style="color:#a6e22e">&quot;Hello &quot;</span><span> + name)
</span><span>		</span><span style="color:#f92672;font-weight:bold">if</span><span> </span><span style="color:#a6e22e">len</span><span>(args) &gt; </span><span class="hljs-number">0</span><span> {
</span><span>			firstNum, _ := strconv.Atoi(args[</span><span class="hljs-number">0</span><span>])
</span><span>			secondNum, _ := strconv.Atoi(args[</span><span class="hljs-number">1</span><span>])
</span><span>			fmt.Printf(</span><span style="color:#a6e22e">&quot;SUM: %v\n&quot;</span><span>, firstNum+secondNum)
</span>		}
<span>		</span><span style="color:#f92672;font-weight:bold">return</span><span> </span><span style="color:#f92672;font-weight:bold">nil</span><span>
</span>	},
<!-- -->}</code></pre></div></pre>
<p>実行。</p>
<pre><div class="sc-bcXHqe lmagiH"><div class="sc-gswNZR jJknjO">bash</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-shell" style="white-space:pre"><span style="color:#75715e">$</span><span class="bash"> go run main.go -a aaa</span><span>
</span>Hello aaa
<span></span><span style="color:#75715e">
</span><span style="color:#75715e">$</span><span class="bash"> go run main.go -a aaa 1 99</span><span>
</span>Hello aaa
<!-- -->SUM: 100
<span></span><span style="color:#75715e">
</span><span style="color:#75715e">$</span><span class="bash"> go run main.go -a aaa 1 abc</span><span>
</span>Error: 引数の型が不正です
<!-- -->Usage:
<!-- -->  sample [flags]
<!-- -->
<!-- -->Flags:
<!-- -->  -h, --help          help for sample
<!-- -->  -a, --name string   name フラグの説明文です (required)
<!-- -->  -n, --night         night フラグの説明文です</code></pre></div></pre>
<h3>PreRun / PostRun Hooks</h3>
<p>実行前と実行後の処理を設定できる。</p>
<pre><div class="sc-bcXHqe lmagiH"><div class="sc-gswNZR jJknjO">go</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-go" style="white-space:pre"><span style="color:#f92672;font-weight:bold">var</span><span> rootCmd = &amp;cobra.Command{
</span><span>	Use:   </span><span style="color:#a6e22e">&quot;sample&quot;</span><span>,
</span><span>	Short: </span><span style="color:#a6e22e">&quot;挨拶をします。2 つの int を渡すと計算もします&quot;</span><span>,
</span><span>	Args: </span><span class="hljs-function" style="color:#f92672;font-weight:bold">func</span><span class="hljs-function hljs-params">(cmd *cobra.Command, args []</span><span class="hljs-function hljs-params" style="color:#f92672;font-weight:bold">string</span><span class="hljs-function hljs-params">)</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">error</span><span> {
</span><span>		</span><span style="color:#f92672;font-weight:bold">if</span><span> </span><span style="color:#a6e22e">len</span><span>(args) == </span><span class="hljs-number">0</span><span> {
</span><span>			</span><span style="color:#f92672;font-weight:bold">return</span><span> </span><span style="color:#f92672;font-weight:bold">nil</span><span>
</span><span>		} </span><span style="color:#f92672;font-weight:bold">else</span><span> {
</span><span>			</span><span style="color:#f92672;font-weight:bold">if</span><span> </span><span style="color:#a6e22e">len</span><span>(args) != </span><span class="hljs-number">2</span><span> {
</span><span>				</span><span style="color:#f92672;font-weight:bold">return</span><span> errors.New(</span><span style="color:#a6e22e">&quot;引数の数が不正です&quot;</span><span>)
</span>			}
<span>			_, err1 := strconv.Atoi(args[</span><span class="hljs-number">0</span><span>])
</span><span>			_, err2 := strconv.Atoi(args[</span><span class="hljs-number">1</span><span>])
</span><span>			</span><span style="color:#f92672;font-weight:bold">if</span><span> err1 != </span><span style="color:#f92672;font-weight:bold">nil</span><span> || err2 != </span><span style="color:#f92672;font-weight:bold">nil</span><span> {
</span><span>				</span><span style="color:#f92672;font-weight:bold">return</span><span> errors.New(</span><span style="color:#a6e22e">&quot;引数の型が不正です&quot;</span><span>)
</span>			}
<!-- -->		}
<span>		</span><span style="color:#f92672;font-weight:bold">return</span><span> </span><span style="color:#f92672;font-weight:bold">nil</span><span>
</span>	},
<span>	PreRun: </span><span class="hljs-function" style="color:#f92672;font-weight:bold">func</span><span class="hljs-function hljs-params">(cmd *cobra.Command, args []</span><span class="hljs-function hljs-params" style="color:#f92672;font-weight:bold">string</span><span class="hljs-function hljs-params">)</span><span> {
</span><span>		fmt.Println(</span><span style="color:#a6e22e">&quot;=== PreRun ===&quot;</span><span>)
</span>	},
<span>	RunE: </span><span class="hljs-function" style="color:#f92672;font-weight:bold">func</span><span class="hljs-function hljs-params">(cmd *cobra.Command, args []</span><span class="hljs-function hljs-params" style="color:#f92672;font-weight:bold">string</span><span class="hljs-function hljs-params">)</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">error</span><span> {
</span><span>		name, _ := cmd.Flags().GetString(</span><span style="color:#a6e22e">&quot;name&quot;</span><span>)
</span>
<span>		</span><span style="color:#f92672;font-weight:bold">if</span><span> night {
</span><span>			fmt.Println(</span><span style="color:#a6e22e">&quot;Good night &quot;</span><span> + name)
</span><span>			</span><span style="color:#f92672;font-weight:bold">if</span><span> </span><span style="color:#a6e22e">len</span><span>(args) &gt; </span><span class="hljs-number">0</span><span> {
</span><span>				firstNum, _ := strconv.Atoi(args[</span><span class="hljs-number">0</span><span>])
</span><span>				secondNum, _ := strconv.Atoi(args[</span><span class="hljs-number">1</span><span>])
</span><span>				fmt.Printf(</span><span style="color:#a6e22e">&quot;SUM: %v\n&quot;</span><span>, firstNum+secondNum)
</span>			}
<span>			</span><span style="color:#f92672;font-weight:bold">return</span><span> </span><span style="color:#f92672;font-weight:bold">nil</span><span>
</span>		}
<!-- -->
<span>		fmt.Println(</span><span style="color:#a6e22e">&quot;Hello &quot;</span><span> + name)
</span><span>		</span><span style="color:#f92672;font-weight:bold">if</span><span> </span><span style="color:#a6e22e">len</span><span>(args) &gt; </span><span class="hljs-number">0</span><span> {
</span><span>			firstNum, _ := strconv.Atoi(args[</span><span class="hljs-number">0</span><span>])
</span><span>			secondNum, _ := strconv.Atoi(args[</span><span class="hljs-number">1</span><span>])
</span><span>			fmt.Printf(</span><span style="color:#a6e22e">&quot;SUM: %v\n&quot;</span><span>, firstNum+secondNum)
</span>		}
<span>		</span><span style="color:#f92672;font-weight:bold">return</span><span> </span><span style="color:#f92672;font-weight:bold">nil</span><span>
</span>	},
<span>	PostRun: </span><span class="hljs-function" style="color:#f92672;font-weight:bold">func</span><span class="hljs-function hljs-params">(cmd *cobra.Command, args []</span><span class="hljs-function hljs-params" style="color:#f92672;font-weight:bold">string</span><span class="hljs-function hljs-params">)</span><span> {
</span><span>		fmt.Println(</span><span style="color:#a6e22e">&quot;=== PostRun ===&quot;</span><span>)
</span>	},
<!-- -->}</code></pre></div></pre>
<p>実行。</p>
<pre><div class="sc-bcXHqe lmagiH"><div class="sc-gswNZR jJknjO">bash</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-shell" style="white-space:pre"><span style="color:#75715e">$</span><span class="bash"> go run main.go -a aaa</span><span>
</span>=== PreRun ===
<!-- -->Hello aaa
<!-- -->=== PostRun ===</code></pre></div></pre>
<h3>subcommand</h3>
<pre><div class="sc-bcXHqe lmagiH"><div class="sc-gswNZR jJknjO">bash</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-shell" style="white-space:pre"><span style="color:#75715e">$</span><span class="bash"> docker-compose run cobra-cli add server</span><span>
</span><span></span><span style="color:#75715e">
</span><span style="color:#75715e">$</span><span class="bash"> tree</span><span>
</span>.
<!-- -->├── Dockerfile
<!-- -->├── LICENSE
<!-- -->├── cmd
<!-- -->│   ├── root.go
<!-- -->│   └── server.go
<!-- -->├── docker-compose.yml
<!-- -->├── go.mod
<!-- -->├── go.sum
<!-- -->└── main.go</code></pre></div></pre>
<p><code>cmd</code> 配下にファイルが生成されている。</p>
<pre><div class="sc-bcXHqe lmagiH"><div class="sc-gswNZR jJknjO">go</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-go" style="white-space:pre"><span style="color:#75715e">/*
</span><span style="color:#75715e">Copyright © 2022 NAME HERE &lt;EMAIL ADDRESS&gt;
</span><span style="color:#75715e">
</span><span style="color:#75715e">*/</span><span>
</span><span></span><span style="color:#f92672;font-weight:bold">package</span><span> cmd
</span>
<span></span><span style="color:#f92672;font-weight:bold">import</span><span> (
</span><span>	</span><span style="color:#a6e22e">&quot;fmt&quot;</span><span>
</span>
<span>	</span><span style="color:#a6e22e">&quot;github.com/spf13/cobra&quot;</span><span>
</span>)
<!-- -->
<span></span><span style="color:#75715e">// serverCmd represents the server command</span><span>
</span><span></span><span style="color:#f92672;font-weight:bold">var</span><span> serverCmd = &amp;cobra.Command{
</span><span>	Use:   </span><span style="color:#a6e22e">&quot;server&quot;</span><span>,
</span><span>	Short: </span><span style="color:#a6e22e">&quot;server を起動します&quot;</span><span>,
</span><span>	Run: </span><span class="hljs-function" style="color:#f92672;font-weight:bold">func</span><span class="hljs-function hljs-params">(cmd *cobra.Command, args []</span><span class="hljs-function hljs-params" style="color:#f92672;font-weight:bold">string</span><span class="hljs-function hljs-params">)</span><span> {
</span><span>		fmt.Println(</span><span style="color:#a6e22e">&quot;server called&quot;</span><span>)
</span>	},
<!-- -->}
<!-- -->
<span></span><span class="hljs-function" style="color:#f92672;font-weight:bold">func</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">init</span><span class="hljs-function hljs-params">()</span><span> {
</span>	rootCmd.AddCommand(serverCmd)
<!-- -->}</code></pre></div></pre>
<p>実行。</p>
<pre><div class="sc-bcXHqe lmagiH"><div class="sc-gswNZR jJknjO">bash</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-shell" style="white-space:pre"><span style="color:#75715e">$</span><span class="bash"> go run main.go -h</span><span>
</span>挨拶をします。2 つの int を渡すと計算もします
<!-- -->
<!-- -->Usage:
<!-- -->  sample [flags]
<!-- -->  sample [command]
<!-- -->
<!-- -->Available Commands:
<!-- -->  completion  Generate the autocompletion script for the specified shell
<!-- -->  help        Help about any command
<!-- -->  server      A brief description of your command
<!-- -->
<!-- -->Flags:
<!-- -->  -h, --help          help for sample
<!-- -->  -a, --name string   name フラグの説明文です (required)
<!-- -->  -n, --night         night フラグの説明文です
<!-- -->
<!-- -->Use &quot;sample [command] --help&quot; for more information about a command.</code></pre></div></pre>
<p><code>server</code> のヘルプをみる。</p>
<pre><div class="sc-bcXHqe lmagiH"><div class="sc-gswNZR jJknjO">bash</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-shell" style="white-space:pre"><span style="color:#75715e">$</span><span class="bash"> go run main.go server -h</span><span>
</span>server を起動します
<!-- -->
<!-- -->Usage:
<!-- -->  sample server [flags]
<!-- -->
<!-- -->Flags:
<!-- -->  -h, --help   help for server
<!-- -->
<!-- -->Global Flags:
<!-- -->  -n, --night   night フラグの説明文です
<span></span><span style="color:#75715e">$</span><span class="bash"> go run main.go server</span><span>
</span>server called</code></pre></div></pre>
<p>subcommand も簡単に実装できそう。</p></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"contents":{"id":"20220522180736","title":"cobra-cli を使う","body":"\n## cobra-cli を使う\n### docker でやる\n`Dockerfile` と `docker-composer.yml` を用意。\n```bash\n$ cat Dockerfile\nFROM golang:1.18.1-buster\nWORKDIR /app\nRUN go install github.com/spf13/cobra-cli@latest\nENTRYPOINT [ \"/go/bin/cobra-cli\" ]\n\n$ cat docker-compose.yml\nversion: '3'\nservices:\n  cobra-cli:\n    build: .\n    volumes:\n      - .:/app\n```\n\n### go.mod を作成\n```bash\n$ go mod init sample\ngo: creating new go.mod: module sample\n```\n\n### project の開始\n```bash\n$ tree\n.\n├── Dockerfile\n├── docker-compose.yml\n└── go.mod\n```\n\n`init` コマンドを実行。\n```bash\n$ docker-compose run cobra-cli init\n\n$ tree\ntree\n.\n├── Dockerfile\n├── LICENSE\n├── cmd\n│   └── root.go\n├── docker-compose.yml\n├── go.mod\n├── go.sum\n└── main.go\n```\n\n`main.go` は `cmd.Execute()` を呼び出しているだけ。\n```go\n/*\nCopyright © 2022 NAME HERE \u003cEMAIL ADDRESS\u003e\n\n*/\npackage main\n\nimport \"sample/cmd\"\n\nfunc main() {\n\tcmd.Execute()\n}\n```\n\n`cmd/root.go` を編集。実行したら `Hello` を出力する。\n```go\n/*\nCopyright © 2022 NAME HERE \u003cEMAIL ADDRESS\u003e\n\n*/\npackage cmd\n\nimport (\n\t\"fmt\"\n\t\"os\"\n\n\t\"github.com/spf13/cobra\"\n)\n\n// rootCmd represents the base command when called without any subcommands\nvar rootCmd = \u0026cobra.Command{\n\tUse:   \"sample\",\n\tShort: \"挨拶をします\",\n\tRunE: func(cmd *cobra.Command, args []string) error {\n\t\tfmt.Println(\"Hello\")\n\t\treturn nil\n\t},\n}\n\n// Execute adds all child commands to the root command and sets flags appropriately.\n// This is called by main.main(). It only needs to happen once to the rootCmd.\nfunc Execute() {\n\terr := rootCmd.Execute()\n\tif err != nil {\n\t\tos.Exit(1)\n\t}\n}\n\nfunc init() {\n}\n```\n\n実行。\n```bash\n$ go run main.go\nHello\n```\n\nhelp を見る。\n```bash\n$ go run main.go -h\n挨拶をします\n\nUsage:\n  sample [flags]\n\nFlags:\n  -h, --help   help for sample\n```\n\n## フラグを設定\n### グローバルフラグを設定\n`--night` をつければ `Good night` を出力する。\n```go\n/*\nCopyright © 2022 NAME HERE \u003cEMAIL ADDRESS\u003e\n\n*/\npackage cmd\n\nimport (\n\t\"fmt\"\n\t\"os\"\n\n\t\"github.com/spf13/cobra\"\n)\n\nvar night bool\n\n// rootCmd represents the base command when called without any subcommands\nvar rootCmd = \u0026cobra.Command{\n\tUse:   \"sample\",\n\tShort: \"挨拶をします\",\n\tRunE: func(cmd *cobra.Command, args []string) error {\n\t\tif night {\n\t\t\tfmt.Println(\"Good night\")\n\t\t\treturn nil\n\t\t}\n\t\tfmt.Println(\"Hello\")\n\t\treturn nil\n\t},\n}\n\n// Execute adds all child commands to the root command and sets flags appropriately.\n// This is called by main.main(). It only needs to happen once to the rootCmd.\nfunc Execute() {\n\terr := rootCmd.Execute()\n\tif err != nil {\n\t\tos.Exit(1)\n\t}\n}\n\nfunc init() {\n\trootCmd.PersistentFlags().BoolVar(\u0026night, \"night\", false, \"night フラグの説明文です\")\n}\n```\n\n実行。\n```bash\n$ go run main.go -h\n挨拶をします\n\nUsage:\n  sample [flags]\n\nFlags:\n  -h, --help    help for sample\n      --night   night フラグの説明文です\n\n$ go run main.go\nHello\n\n$ go run main.go --night\nGood night\n```\n\n#### shorthand で設定する\n```go\nfunc init() {\n\t// rootCmd.PersistentFlags().BoolVar(\u0026night, \"night\", false, \"night フラグの説明文です\")\n\trootCmd.PersistentFlags().BoolVarP(\u0026night, \"night\", \"n\", false, \"night フラグの説明文です\")\n}\n```\n\n実行。\n```bash\n$ go run main.go -h\n挨拶をします\n\nUsage:\n  sample [flags]\n\nFlags:\n  -h, --help    help for sample\n  -n, --night   night フラグの説明文です\n\n$ go run main.go -n\nGood night\n```\n\n### ローカルフラグを設定する\n`--name` をつければ挨拶の後に名前を出力する。\n今度は変数を設定しないでフラグの値を取得してみる。\n\n```go\n/*\nCopyright © 2022 NAME HERE \u003cEMAIL ADDRESS\u003e\n\n*/\npackage cmd\n\nimport (\n\t\"fmt\"\n\t\"os\"\n\n\t\"github.com/spf13/cobra\"\n)\n\nvar night bool\n\n// rootCmd represents the base command when called without any subcommands\nvar rootCmd = \u0026cobra.Command{\n\tUse:   \"sample\",\n\tShort: \"挨拶をします\",\n\tRunE: func(cmd *cobra.Command, args []string) error {\n\t\tname, _ := cmd.Flags().GetString(\"name\")\n\t\tif night {\n\t\t\tfmt.Println(\"Good night \" + name)\n\t\t\treturn nil\n\t\t}\n\t\tfmt.Println(\"Hello \" + name)\n\t\treturn nil\n\t},\n}\n\n// Execute adds all child commands to the root command and sets flags appropriately.\n// This is called by main.main(). It only needs to happen once to the rootCmd.\nfunc Execute() {\n\terr := rootCmd.Execute()\n\tif err != nil {\n\t\tos.Exit(1)\n\t}\n}\n\nfunc init() {\n\trootCmd.PersistentFlags().BoolVarP(\u0026night, \"night\", \"n\", false, \"night フラグの説明文です\")\n\trootCmd.Flags().StringP(\"name\", \"a\", \"\", \"name フラグの説明文です\")\n}\n```\n\n実行。\n```bash\n$ go run main.go -h\n挨拶をします\n\nUsage:\n  sample [flags]\n\nFlags:\n  -h, --help          help for sample\n  -a, --name string   name フラグの説明文です\n  -n, --night         night フラグの説明文です\n\n$ go run main.go\nHello \n$ go run main.go -a aaa\nHello aaa\n\n$ go run main.go -a aaa --night\nGood night aaa\n```\n\n#### フラグの値の取得方法\n`~P` がついている方は `shorthand` を設定できる。\n`~Var` がついている方は直接値を設定できる。\n\n```go\nrootCmd.Flags().String(\"name\", \"\", \"name フラグの説明文です\")\nrootCmd.Flags().StringP(\"name\", \"a\", \"\", \"name フラグの説明文です\")\nrootCmd.Flags().StringVar(\u0026name, \"name\", \"\", \"name フラグの説明文です\")\nrootCmd.Flags().StringVarP(\u0026name, \"name\", \"a\", \"\", \"name フラグの説明文です\")\n```\n\n### 必須フラグ\n```go\nfunc init() {\n\trootCmd.PersistentFlags().BoolVarP(\u0026night, \"night\", \"n\", false, \"night フラグの説明文です\")\n\trootCmd.Flags().StringP(\"name\", \"a\", \"\", \"name フラグの説明文です (required)\")\n\trootCmd.MarkFlagRequired(\"name\")\n}\n```\n\n実行。\n```bash\n$ go run main.go\nError: required flag(s) \"name\" not set\nUsage:\n  sample [flags]\n\nFlags:\n  -h, --help          help for sample\n  -a, --name string   name フラグの説明文です (required)\n  -n, --night         night フラグの説明文です\n\n$ go run main.go -a aaa\nHello aaa\n```\n\n### 引数の設定\n引数に数字を 2 つ与えるとその合計を出力する。\n```go\n// rootCmd represents the base command when called without any subcommands\nvar rootCmd = \u0026cobra.Command{\n\tUse:   \"sample\",\n\tShort: \"挨拶をします\",\n\tRunE: func(cmd *cobra.Command, args []string) error {\n\t\tname, _ := cmd.Flags().GetString(\"name\")\n\n\t\tif night {\n\t\t\tfmt.Println(\"Good night \" + name)\n\t\t\tif len(args) \u003e 0 {\n\t\t\t\tfirstNum, _ := strconv.Atoi(args[0])\n\t\t\t\tsecondNum, _ := strconv.Atoi(args[1])\n\t\t\t\tfmt.Printf(\"SUM: %v\\n\", firstNum+secondNum)\n\t\t\t}\n\t\t\treturn nil\n\t\t}\n\n\t\tfmt.Println(\"Hello \" + name)\n\t\tif len(args) \u003e 0 {\n\t\t\tfirstNum, _ := strconv.Atoi(args[0])\n\t\t\tsecondNum, _ := strconv.Atoi(args[1])\n\t\t\tfmt.Printf(\"SUM: %v\\n\", firstNum+secondNum)\n\t\t}\n\t\treturn nil\n\t},\n}\n```\n\n実行。\n```bash\n$ go run main.go -a aaa\nHello aaa\n\n$ go run main.go -a aaa 1 99\nHello aaa\nSUM: 100\n```\n\n#### バリデーションチェック\nこれらのメソッドが用意されている。\n|メソッド|機能|\n|-|-|\nNoArgs|引数が存在したらエラーを返す\nOnlyValidArgs|ValidArgs に含まれていないとエラーを返す\nArbitraryArgs|エラーを返さない\nMinimumNArgs(n)|少なくとも n 個の引数がないとエラーを返す\nMaximumNArgs(n)|n 個以上の引数があるとエラーを返す\nExactArgs(n)|n 個の引数以外だとエラーを返す\nExactValidArgs(int)|n 個の引数以外 or ValidArgs フィールドにない位置引数がある場合はエラーを返す\nRangeArgs(min, max)|範囲内の値でないとエラーを返す\n\nこんな感じで設定できる。\n```go\nArgs:  cobra.ExactArgs(1),\n```\n\n複数のバリデーションをチェックする場合は `MatchAll` を使えば良さそう。\n```go\n// MatchAll allows combining several PositionalArgs to work in concert.\nfunc MatchAll(pargs ...PositionalArgs) PositionalArgs {\n\treturn func(cmd *Command, args []string) error {\n\t\tfor _, parg := range pargs {\n\t\t\tif err := parg(cmd, args); err != nil {\n\t\t\t\treturn err\n\t\t\t}\n\t\t}\n\t\treturn nil\n\t}\n}\n```\n\n今回は 2 個の引数のみ受け付ける。かつ、値が数値であることのみ許可する。\n```go\nvar rootCmd = \u0026cobra.Command{\n\tUse:   \"sample\",\n\tShort: \"挨拶をします。2 つの int を渡すと計算もします\",\n\tArgs: func(cmd *cobra.Command, args []string) error {\n\t\tif len(args) == 0 {\n\t\t\treturn nil\n\t\t} else {\n\t\t\tif len(args) != 2 {\n\t\t\t\treturn errors.New(\"引数の数が不正です\")\n\t\t\t}\n\t\t\t_, err1 := strconv.Atoi(args[0])\n\t\t\t_, err2 := strconv.Atoi(args[1])\n\t\t\tif err1 != nil || err2 != nil {\n\t\t\t\treturn errors.New(\"引数の型が不正です\")\n\t\t\t}\n\t\t}\n\t\treturn nil\n\t},\n\tRunE: func(cmd *cobra.Command, args []string) error {\n\t\tname, _ := cmd.Flags().GetString(\"name\")\n\n\t\tif night {\n\t\t\tfmt.Println(\"Good night \" + name)\n\t\t\tif len(args) \u003e 0 {\n\t\t\t\tfirstNum, _ := strconv.Atoi(args[0])\n\t\t\t\tsecondNum, _ := strconv.Atoi(args[1])\n\t\t\t\tfmt.Printf(\"SUM: %v\\n\", firstNum+secondNum)\n\t\t\t}\n\t\t\treturn nil\n\t\t}\n\n\t\tfmt.Println(\"Hello \" + name)\n\t\tif len(args) \u003e 0 {\n\t\t\tfirstNum, _ := strconv.Atoi(args[0])\n\t\t\tsecondNum, _ := strconv.Atoi(args[1])\n\t\t\tfmt.Printf(\"SUM: %v\\n\", firstNum+secondNum)\n\t\t}\n\t\treturn nil\n\t},\n}\n```\n\n実行。\n```bash\n$ go run main.go -a aaa\nHello aaa\n\n$ go run main.go -a aaa 1 99\nHello aaa\nSUM: 100\n\n$ go run main.go -a aaa 1 abc\nError: 引数の型が不正です\nUsage:\n  sample [flags]\n\nFlags:\n  -h, --help          help for sample\n  -a, --name string   name フラグの説明文です (required)\n  -n, --night         night フラグの説明文です\n```\n\n### PreRun / PostRun Hooks\n実行前と実行後の処理を設定できる。\n\n```go\nvar rootCmd = \u0026cobra.Command{\n\tUse:   \"sample\",\n\tShort: \"挨拶をします。2 つの int を渡すと計算もします\",\n\tArgs: func(cmd *cobra.Command, args []string) error {\n\t\tif len(args) == 0 {\n\t\t\treturn nil\n\t\t} else {\n\t\t\tif len(args) != 2 {\n\t\t\t\treturn errors.New(\"引数の数が不正です\")\n\t\t\t}\n\t\t\t_, err1 := strconv.Atoi(args[0])\n\t\t\t_, err2 := strconv.Atoi(args[1])\n\t\t\tif err1 != nil || err2 != nil {\n\t\t\t\treturn errors.New(\"引数の型が不正です\")\n\t\t\t}\n\t\t}\n\t\treturn nil\n\t},\n\tPreRun: func(cmd *cobra.Command, args []string) {\n\t\tfmt.Println(\"=== PreRun ===\")\n\t},\n\tRunE: func(cmd *cobra.Command, args []string) error {\n\t\tname, _ := cmd.Flags().GetString(\"name\")\n\n\t\tif night {\n\t\t\tfmt.Println(\"Good night \" + name)\n\t\t\tif len(args) \u003e 0 {\n\t\t\t\tfirstNum, _ := strconv.Atoi(args[0])\n\t\t\t\tsecondNum, _ := strconv.Atoi(args[1])\n\t\t\t\tfmt.Printf(\"SUM: %v\\n\", firstNum+secondNum)\n\t\t\t}\n\t\t\treturn nil\n\t\t}\n\n\t\tfmt.Println(\"Hello \" + name)\n\t\tif len(args) \u003e 0 {\n\t\t\tfirstNum, _ := strconv.Atoi(args[0])\n\t\t\tsecondNum, _ := strconv.Atoi(args[1])\n\t\t\tfmt.Printf(\"SUM: %v\\n\", firstNum+secondNum)\n\t\t}\n\t\treturn nil\n\t},\n\tPostRun: func(cmd *cobra.Command, args []string) {\n\t\tfmt.Println(\"=== PostRun ===\")\n\t},\n}\n```\n\n実行。\n```bash\n$ go run main.go -a aaa\n=== PreRun ===\nHello aaa\n=== PostRun ===\n```\n\n### subcommand\n```bash\n$ docker-compose run cobra-cli add server\n\n$ tree\n.\n├── Dockerfile\n├── LICENSE\n├── cmd\n│   ├── root.go\n│   └── server.go\n├── docker-compose.yml\n├── go.mod\n├── go.sum\n└── main.go\n```\n\n`cmd` 配下にファイルが生成されている。\n```go\n/*\nCopyright © 2022 NAME HERE \u003cEMAIL ADDRESS\u003e\n\n*/\npackage cmd\n\nimport (\n\t\"fmt\"\n\n\t\"github.com/spf13/cobra\"\n)\n\n// serverCmd represents the server command\nvar serverCmd = \u0026cobra.Command{\n\tUse:   \"server\",\n\tShort: \"server を起動します\",\n\tRun: func(cmd *cobra.Command, args []string) {\n\t\tfmt.Println(\"server called\")\n\t},\n}\n\nfunc init() {\n\trootCmd.AddCommand(serverCmd)\n}\n```\n\n実行。\n```bash\n$ go run main.go -h\n挨拶をします。2 つの int を渡すと計算もします\n\nUsage:\n  sample [flags]\n  sample [command]\n\nAvailable Commands:\n  completion  Generate the autocompletion script for the specified shell\n  help        Help about any command\n  server      A brief description of your command\n\nFlags:\n  -h, --help          help for sample\n  -a, --name string   name フラグの説明文です (required)\n  -n, --night         night フラグの説明文です\n\nUse \"sample [command] --help\" for more information about a command.\n```\n\n`server` のヘルプをみる。\n```bash\n$ go run main.go server -h\nserver を起動します\n\nUsage:\n  sample server [flags]\n\nFlags:\n  -h, --help   help for server\n\nGlobal Flags:\n  -n, --night   night フラグの説明文です\n$ go run main.go server\nserver called\n```\n\nsubcommand も簡単に実装できそう。\n"}},"__N_SSG":true},"page":"/docs/[id]","query":{"id":"20220522180736"},"buildId":"Pprqt13nm5vtswVY-tT11","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>