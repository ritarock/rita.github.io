<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>MyDocs</title><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/css/a58c9bb1e05a64ba.css" as="style"/><link rel="stylesheet" href="/_next/static/css/a58c9bb1e05a64ba.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-d38be8d96a62f950.js" defer=""></script><script src="/_next/static/chunks/framework-2c79e2a64abdb08b.js" defer=""></script><script src="/_next/static/chunks/main-a0dca5a2ff5035f1.js" defer=""></script><script src="/_next/static/chunks/pages/_app-f35537586aa9f5dd.js" defer=""></script><script src="/_next/static/chunks/996-eeb5175dbd5dba8f.js" defer=""></script><script src="/_next/static/chunks/635-77cab1cb386ca7f8.js" defer=""></script><script src="/_next/static/chunks/pages/docs/%5Bid%5D-f16bc0121a6e0d8a.js" defer=""></script><script src="/_next/static/Pprqt13nm5vtswVY-tT11/_buildManifest.js" defer=""></script><script src="/_next/static/Pprqt13nm5vtswVY-tT11/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div><a style="text-decoration:none" href="/"><div style="color:black;font-size:22px;cursor:pointer">MyDocs</div></a></div><p></p><h1><b># <!-- -->echo を触ってみる</b></h1><p>最小構成。</p>
<pre><div class="sc-bcXHqe lmagiH"><div class="sc-gswNZR jJknjO">bash</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-shell" style="white-space:pre"><span style="color:#75715e">$</span><span class="bash"> go get github.com/labstack/</span><span class="bash" style="color:#a6e22e">echo</span><span class="bash">/v4</span></code></pre></div></pre>
<pre><div class="sc-bcXHqe lmagiH"><div class="sc-gswNZR jJknjO">go</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-go" style="white-space:pre"><span style="color:#f92672;font-weight:bold">package</span><span> main
</span>
<span></span><span style="color:#f92672;font-weight:bold">import</span><span> (
</span><span>	</span><span style="color:#a6e22e">&quot;net/http&quot;</span><span>
</span>
<span>	</span><span style="color:#a6e22e">&quot;github.com/labstack/echo/v4&quot;</span><span>
</span>)
<!-- -->
<span></span><span class="hljs-function" style="color:#f92672;font-weight:bold">func</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">main</span><span class="hljs-function hljs-params">()</span><span> {
</span>	e := echo.New()
<span>	e.GET(</span><span style="color:#a6e22e">&quot;/&quot;</span><span>, </span><span class="hljs-function" style="color:#f92672;font-weight:bold">func</span><span class="hljs-function hljs-params">(c echo.Context)</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">error</span><span> {
</span><span>		</span><span style="color:#f92672;font-weight:bold">return</span><span> c.String(http.StatusOK, </span><span style="color:#a6e22e">&quot;Hello World!&quot;</span><span>)
</span>	})
<span>	e.Logger.Fatal(e.Start(</span><span style="color:#a6e22e">&quot;:8080&quot;</span><span>))
</span>}</code></pre></div></pre>
<h2>path parameters</h2>
<p><code>http://localhost:8080/users/1</code></p>
<p><code>1</code> が返ってくる。</p>
<pre><div class="sc-bcXHqe lmagiH"><div class="sc-gswNZR jJknjO">go</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-go" style="white-space:pre"><span style="color:#f92672;font-weight:bold">package</span><span> main
</span>
<span></span><span style="color:#f92672;font-weight:bold">import</span><span> (
</span><span>	</span><span style="color:#a6e22e">&quot;net/http&quot;</span><span>
</span>
<span>	</span><span style="color:#a6e22e">&quot;github.com/labstack/echo/v4&quot;</span><span>
</span>)
<!-- -->
<span></span><span class="hljs-function" style="color:#f92672;font-weight:bold">func</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">main</span><span class="hljs-function hljs-params">()</span><span> {
</span>	e := echo.New()
<span>	e.GET(</span><span style="color:#a6e22e">&quot;/users/:id&quot;</span><span>, getUser)
</span><span>	e.Logger.Fatal(e.Start(</span><span style="color:#a6e22e">&quot;:8080&quot;</span><span>))
</span>}
<!-- -->
<span></span><span class="hljs-function" style="color:#f92672;font-weight:bold">func</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">getUser</span><span class="hljs-function hljs-params">(c echo.Context)</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">error</span><span> {
</span><span>	id := c.Param(</span><span style="color:#a6e22e">&quot;id&quot;</span><span>)
</span><span>	</span><span style="color:#f92672;font-weight:bold">return</span><span> c.String(http.StatusOK, id)
</span>}</code></pre></div></pre>
<h2>query parameters</h2>
<p><code>http://localhost:8080/show?team=x-men&amp;member=wolverine</code></p>
<p><code>team: x-men, member: wolverine</code> が返ってくる。</p>
<pre><div class="sc-bcXHqe lmagiH"><div class="sc-gswNZR jJknjO">go</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-go" style="white-space:pre"><span style="color:#f92672;font-weight:bold">package</span><span> main
</span>
<span></span><span style="color:#f92672;font-weight:bold">import</span><span> (
</span><span>	</span><span style="color:#a6e22e">&quot;net/http&quot;</span><span>
</span>
<span>	</span><span style="color:#a6e22e">&quot;github.com/labstack/echo/v4&quot;</span><span>
</span>)
<!-- -->
<span></span><span class="hljs-function" style="color:#f92672;font-weight:bold">func</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">main</span><span class="hljs-function hljs-params">()</span><span> {
</span>	e := echo.New()
<span>	e.GET(</span><span style="color:#a6e22e">&quot;/show&quot;</span><span>, show)
</span><span>	e.Logger.Fatal(e.Start(</span><span style="color:#a6e22e">&quot;:8080&quot;</span><span>))
</span>}
<!-- -->
<span></span><span class="hljs-function" style="color:#f92672;font-weight:bold">func</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">show</span><span class="hljs-function hljs-params">(c echo.Context)</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">error</span><span> {
</span><span>	team := c.QueryParam(</span><span style="color:#a6e22e">&quot;team&quot;</span><span>)
</span><span>	member := c.QueryParam(</span><span style="color:#a6e22e">&quot;member&quot;</span><span>)
</span><span>	</span><span style="color:#f92672;font-weight:bold">return</span><span> c.String(http.StatusOK, </span><span style="color:#a6e22e">&quot;team: &quot;</span><span>+team+</span><span style="color:#a6e22e">&quot;, member: &quot;</span><span>+member)
</span>}</code></pre></div></pre>
<h2>json を返す</h2>
<p><code>http://localhost:8080/json</code></p>
<p>json を返す。</p>
<pre><div class="sc-bcXHqe lmagiH"><div class="sc-gswNZR jJknjO">json</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-markdown" style="white-space:pre"><span>{
</span>  &quot;name&quot;: &quot;Jon&quot;,
<!-- -->  &quot;email&quot;: &quot;json@sample.com&quot;
<!-- -->}</code></pre></div></pre>
<pre><div class="sc-bcXHqe lmagiH"><div class="sc-gswNZR jJknjO">go</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-go" style="white-space:pre"><span style="color:#f92672;font-weight:bold">package</span><span> main
</span>
<span></span><span style="color:#f92672;font-weight:bold">import</span><span> (
</span><span>	</span><span style="color:#a6e22e">&quot;net/http&quot;</span><span>
</span>
<span>	</span><span style="color:#a6e22e">&quot;github.com/labstack/echo/v4&quot;</span><span>
</span>)
<!-- -->
<span></span><span class="hljs-function" style="color:#f92672;font-weight:bold">func</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">main</span><span class="hljs-function hljs-params">()</span><span> {
</span>	e := echo.New()
<span>	e.GET(</span><span style="color:#a6e22e">&quot;/json&quot;</span><span>, json)
</span><span>	e.Logger.Fatal(e.Start(</span><span style="color:#a6e22e">&quot;:8080&quot;</span><span>))
</span>}
<!-- -->
<span></span><span style="color:#f92672;font-weight:bold">type</span><span> User </span><span style="color:#f92672;font-weight:bold">struct</span><span> {
</span><span>	Name  </span><span style="color:#f92672;font-weight:bold">string</span><span> </span><span style="color:#a6e22e">`json:&quot;name&quot;`</span><span>
</span><span>	Email </span><span style="color:#f92672;font-weight:bold">string</span><span> </span><span style="color:#a6e22e">`json:&quot;email&quot;`</span><span>
</span>}
<!-- -->
<span></span><span class="hljs-function" style="color:#f92672;font-weight:bold">func</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">json</span><span class="hljs-function hljs-params">(c echo.Context)</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">error</span><span> {
</span>	user := &amp;User{
<span>		Name:  </span><span style="color:#a6e22e">&quot;Jon&quot;</span><span>,
</span><span>		Email: </span><span style="color:#a6e22e">&quot;json@sample.com&quot;</span><span>,
</span>	}
<span>	</span><span style="color:#f92672;font-weight:bold">return</span><span> c.JSON(http.StatusOK, user)
</span>}</code></pre></div></pre>
<p><code>context.JSON</code> は内部では <code>json.Marshal</code> を使っている。
大きな JSON では非効率なので、その場合は直接 JSON をストリームできる。</p>
<pre><div class="sc-bcXHqe lmagiH"><div class="sc-gswNZR jJknjO">go</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-go" style="white-space:pre"><span style="color:#f92672;font-weight:bold">package</span><span> main
</span>
<span></span><span style="color:#f92672;font-weight:bold">import</span><span> (
</span><span>	</span><span style="color:#a6e22e">&quot;encoding/json&quot;</span><span>
</span><span>	</span><span style="color:#a6e22e">&quot;net/http&quot;</span><span>
</span>
<span>	</span><span style="color:#a6e22e">&quot;github.com/labstack/echo/v4&quot;</span><span>
</span>)
<!-- -->
<span></span><span class="hljs-function" style="color:#f92672;font-weight:bold">func</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">main</span><span class="hljs-function hljs-params">()</span><span> {
</span>	e := echo.New()
<span>	e.GET(</span><span style="color:#a6e22e">&quot;/jsonStream&quot;</span><span>, jsonStream)
</span><span>	e.Logger.Fatal(e.Start(</span><span style="color:#a6e22e">&quot;:8080&quot;</span><span>))
</span>}
<!-- -->
<span></span><span style="color:#f92672;font-weight:bold">type</span><span> User </span><span style="color:#f92672;font-weight:bold">struct</span><span> {
</span><span>	Name  </span><span style="color:#f92672;font-weight:bold">string</span><span> </span><span style="color:#a6e22e">`json:&quot;name&quot;`</span><span>
</span><span>	Email </span><span style="color:#f92672;font-weight:bold">string</span><span> </span><span style="color:#a6e22e">`json:&quot;email&quot;`</span><span>
</span>}
<!-- -->
<span></span><span class="hljs-function" style="color:#f92672;font-weight:bold">func</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">jsonStream</span><span class="hljs-function hljs-params">(c echo.Context)</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">error</span><span> {
</span>	user := &amp;User{
<span>		Name:  </span><span style="color:#a6e22e">&quot;Jon&quot;</span><span>,
</span><span>		Email: </span><span style="color:#a6e22e">&quot;json@sample.com&quot;</span><span>,
</span>	}
<!-- -->	c.Response().Header().Set(echo.HeaderContentType, echo.MIMEApplicationJSONCharsetUTF8)
<!-- -->	c.Response().WriteHeader(http.StatusOK)
<span>	</span><span style="color:#f92672;font-weight:bold">return</span><span> json.NewEncoder(c.Response()).Encode(user)
</span>}</code></pre></div></pre>
<h2>Bind</h2>
<p><code>Context.Bind</code> を使って、ソースからデータ構造にバインドさせる。</p>
<pre><div class="sc-bcXHqe lmagiH"><div class="sc-gswNZR jJknjO">bash</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-shell" style="white-space:pre"><span style="color:#75715e">$</span><span class="bash"> curl -X POST http://localhost:8080/users \
</span><span class="bash">       -H </span><span class="bash" style="color:#a6e22e">&#x27;Content-Type: application/json&#x27;</span><span class="bash"> \
</span><span class="bash">       -d </span><span class="bash" style="color:#a6e22e">&#x27;{&quot;name&quot;:&quot;Jon&quot;,&quot;email&quot;:&quot;json@sample.com&quot;}&#x27;</span><span>
</span>{
<!-- -->  &quot;name&quot;:&quot;Jon&quot;,
<!-- -->  &quot;email&quot;:&quot;json@sample.com&quot;
<!-- -->}</code></pre></div></pre>
<pre><div class="sc-bcXHqe lmagiH"><div class="sc-gswNZR jJknjO">go</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-go" style="white-space:pre"><span style="color:#f92672;font-weight:bold">package</span><span> main
</span>
<span></span><span style="color:#f92672;font-weight:bold">import</span><span> (
</span><span>	</span><span style="color:#a6e22e">&quot;fmt&quot;</span><span>
</span><span>	</span><span style="color:#a6e22e">&quot;net/http&quot;</span><span>
</span>
<span>	</span><span style="color:#a6e22e">&quot;github.com/labstack/echo/v4&quot;</span><span>
</span>)
<!-- -->
<span></span><span class="hljs-function" style="color:#f92672;font-weight:bold">func</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">main</span><span class="hljs-function hljs-params">()</span><span> {
</span>	e := echo.New()
<span>	e.POST(</span><span style="color:#a6e22e">&quot;/users&quot;</span><span>, create)
</span><span>	e.Logger.Fatal(e.Start(</span><span style="color:#a6e22e">&quot;:8080&quot;</span><span>))
</span>}
<!-- -->
<span></span><span style="color:#f92672;font-weight:bold">type</span><span> User </span><span style="color:#f92672;font-weight:bold">struct</span><span> {
</span><span>	Name  </span><span style="color:#f92672;font-weight:bold">string</span><span> </span><span style="color:#a6e22e">`json:&quot;name&quot;`</span><span>
</span><span>	Email </span><span style="color:#f92672;font-weight:bold">string</span><span> </span><span style="color:#a6e22e">`json:&quot;email&quot;`</span><span>
</span>}
<!-- -->
<span></span><span class="hljs-function" style="color:#f92672;font-weight:bold">func</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">create</span><span class="hljs-function hljs-params">(c echo.Context)</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">error</span><span> {
</span><span>	user := </span><span style="color:#a6e22e">new</span><span>(User)
</span><span>	</span><span style="color:#f92672;font-weight:bold">if</span><span> err := c.Bind(user); err != </span><span style="color:#f92672;font-weight:bold">nil</span><span> {
</span><span>		</span><span style="color:#f92672;font-weight:bold">return</span><span> err
</span>	}
<!-- -->	fmt.Println(user)
<!-- -->
<!-- -->	bindUser := &amp;User{
<!-- -->		Name:  user.Name,
<!-- -->		Email: user.Email,
<!-- -->	}
<!-- -->
<span>	</span><span style="color:#f92672;font-weight:bold">return</span><span> c.JSON(http.StatusOK, bindUser)
</span>}</code></pre></div></pre></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"contents":{"id":"20211106130548","title":"echo を触ってみる","body":"\n最小構成。\n```bash\n$ go get github.com/labstack/echo/v4\n```\n\n```go\npackage main\n\nimport (\n\t\"net/http\"\n\n\t\"github.com/labstack/echo/v4\"\n)\n\nfunc main() {\n\te := echo.New()\n\te.GET(\"/\", func(c echo.Context) error {\n\t\treturn c.String(http.StatusOK, \"Hello World!\")\n\t})\n\te.Logger.Fatal(e.Start(\":8080\"))\n}\n```\n\n## path parameters\n`http://localhost:8080/users/1`\n\n`1` が返ってくる。\n```go\npackage main\n\nimport (\n\t\"net/http\"\n\n\t\"github.com/labstack/echo/v4\"\n)\n\nfunc main() {\n\te := echo.New()\n\te.GET(\"/users/:id\", getUser)\n\te.Logger.Fatal(e.Start(\":8080\"))\n}\n\nfunc getUser(c echo.Context) error {\n\tid := c.Param(\"id\")\n\treturn c.String(http.StatusOK, id)\n}\n```\n\n## query parameters\n`http://localhost:8080/show?team=x-men\u0026member=wolverine`\n\n`team: x-men, member: wolverine` が返ってくる。\n```go\npackage main\n\nimport (\n\t\"net/http\"\n\n\t\"github.com/labstack/echo/v4\"\n)\n\nfunc main() {\n\te := echo.New()\n\te.GET(\"/show\", show)\n\te.Logger.Fatal(e.Start(\":8080\"))\n}\n\nfunc show(c echo.Context) error {\n\tteam := c.QueryParam(\"team\")\n\tmember := c.QueryParam(\"member\")\n\treturn c.String(http.StatusOK, \"team: \"+team+\", member: \"+member)\n}\n```\n\n## json を返す\n`http://localhost:8080/json`\n\njson を返す。\n```json\n{\n  \"name\": \"Jon\",\n  \"email\": \"json@sample.com\"\n}\n```\n\n```go\npackage main\n\nimport (\n\t\"net/http\"\n\n\t\"github.com/labstack/echo/v4\"\n)\n\nfunc main() {\n\te := echo.New()\n\te.GET(\"/json\", json)\n\te.Logger.Fatal(e.Start(\":8080\"))\n}\n\ntype User struct {\n\tName  string `json:\"name\"`\n\tEmail string `json:\"email\"`\n}\n\nfunc json(c echo.Context) error {\n\tuser := \u0026User{\n\t\tName:  \"Jon\",\n\t\tEmail: \"json@sample.com\",\n\t}\n\treturn c.JSON(http.StatusOK, user)\n}\n```\n\n`context.JSON` は内部では `json.Marshal` を使っている。\n大きな JSON では非効率なので、その場合は直接 JSON をストリームできる。\n\n```go\npackage main\n\nimport (\n\t\"encoding/json\"\n\t\"net/http\"\n\n\t\"github.com/labstack/echo/v4\"\n)\n\nfunc main() {\n\te := echo.New()\n\te.GET(\"/jsonStream\", jsonStream)\n\te.Logger.Fatal(e.Start(\":8080\"))\n}\n\ntype User struct {\n\tName  string `json:\"name\"`\n\tEmail string `json:\"email\"`\n}\n\nfunc jsonStream(c echo.Context) error {\n\tuser := \u0026User{\n\t\tName:  \"Jon\",\n\t\tEmail: \"json@sample.com\",\n\t}\n\tc.Response().Header().Set(echo.HeaderContentType, echo.MIMEApplicationJSONCharsetUTF8)\n\tc.Response().WriteHeader(http.StatusOK)\n\treturn json.NewEncoder(c.Response()).Encode(user)\n}\n```\n\n## Bind\n`Context.Bind` を使って、ソースからデータ構造にバインドさせる。\n\n```bash\n$ curl -X POST http://localhost:8080/users \\\n       -H 'Content-Type: application/json' \\\n       -d '{\"name\":\"Jon\",\"email\":\"json@sample.com\"}'\n{\n  \"name\":\"Jon\",\n  \"email\":\"json@sample.com\"\n}\n```\n\n```go\npackage main\n\nimport (\n\t\"fmt\"\n\t\"net/http\"\n\n\t\"github.com/labstack/echo/v4\"\n)\n\nfunc main() {\n\te := echo.New()\n\te.POST(\"/users\", create)\n\te.Logger.Fatal(e.Start(\":8080\"))\n}\n\ntype User struct {\n\tName  string `json:\"name\"`\n\tEmail string `json:\"email\"`\n}\n\nfunc create(c echo.Context) error {\n\tuser := new(User)\n\tif err := c.Bind(user); err != nil {\n\t\treturn err\n\t}\n\tfmt.Println(user)\n\n\tbindUser := \u0026User{\n\t\tName:  user.Name,\n\t\tEmail: user.Email,\n\t}\n\n\treturn c.JSON(http.StatusOK, bindUser)\n}\n```\n"}},"__N_SSG":true},"page":"/docs/[id]","query":{"id":"20211106130548"},"buildId":"Pprqt13nm5vtswVY-tT11","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>