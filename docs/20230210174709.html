<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>MyDocs</title><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/css/a58c9bb1e05a64ba.css" as="style"/><link rel="stylesheet" href="/_next/static/css/a58c9bb1e05a64ba.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-d38be8d96a62f950.js" defer=""></script><script src="/_next/static/chunks/framework-2c79e2a64abdb08b.js" defer=""></script><script src="/_next/static/chunks/main-348c8faa34e64ab3.js" defer=""></script><script src="/_next/static/chunks/pages/_app-aef446c81fd4cad4.js" defer=""></script><script src="/_next/static/chunks/996-d065d3ec5d2a41d4.js" defer=""></script><script src="/_next/static/chunks/635-fe39bb0306c39624.js" defer=""></script><script src="/_next/static/chunks/pages/docs/%5Bid%5D-3de24ad21bbbcfc8.js" defer=""></script><script src="/_next/static/R3w2YxKwomVZS6aeAB8Uf/_buildManifest.js" defer=""></script><script src="/_next/static/R3w2YxKwomVZS6aeAB8Uf/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div><a style="text-decoration:none" href="/"><div style="color:black;font-size:22px;cursor:pointer">MyDocs</div></a></div><p></p><h1><b># <!-- -->aws-sdk-go-v2 で profile を使う</b></h1><p>profile を指定している場合は profile を使うが、指定していない場合は IAM ロールを使う。</p>
<pre><div class="sc-bcXHqe lmagiH"><div class="sc-gswNZR jJknjO">go</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-go" style="white-space:pre"><span class="hljs-function" style="color:#f92672;font-weight:bold">func</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">session</span><span class="hljs-function hljs-params">(ctx context.Context, profile </span><span class="hljs-function hljs-params" style="color:#f92672;font-weight:bold">string</span><span class="hljs-function hljs-params">)</span><span class="hljs-function"> </span><span class="hljs-function hljs-params">(aws.Config, error)</span><span> {
</span><span>	configOptions := []</span><span class="hljs-function" style="color:#f92672;font-weight:bold">func</span><span class="hljs-function hljs-params">(*config.LoadOptions)</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">error</span><span>{
</span><span>		config.WithRegion(</span><span style="color:#a6e22e">&quot;ap-northeast-1&quot;</span><span>),
</span>	}
<span>	</span><span style="color:#f92672;font-weight:bold">if</span><span> profile != </span><span style="color:#a6e22e">&quot;&quot;</span><span> {
</span><span>		configOptions = </span><span style="color:#a6e22e">append</span><span>(configOptions, config.WithSharedConfigProfile(aws.ToString(&amp;profile)))
</span>	}
<!-- -->	cfg, err := config.LoadDefaultConfig(ctx, configOptions...)
<span>	</span><span style="color:#f92672;font-weight:bold">if</span><span> err != </span><span style="color:#f92672;font-weight:bold">nil</span><span> {
</span><span>		</span><span style="color:#f92672;font-weight:bold">return</span><span> aws.Config{}, err
</span>	}
<span>	</span><span style="color:#f92672;font-weight:bold">return</span><span> cfg, </span><span style="color:#f92672;font-weight:bold">nil</span><span>
</span>}</code></pre></div></pre>
<p><a href="https://github.com/turbot/steampipe-plugin-aws/blob/main/aws/service.go#L1437-L1460">このコード</a> が参考になった。</p></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"contents":{"id":"20230210174709","title":"aws-sdk-go-v2 で profile を使う","body":"\nprofile を指定している場合は profile を使うが、指定していない場合は IAM ロールを使う。\n\n```go\nfunc session(ctx context.Context, profile string) (aws.Config, error) {\n\tconfigOptions := []func(*config.LoadOptions) error{\n\t\tconfig.WithRegion(\"ap-northeast-1\"),\n\t}\n\tif profile != \"\" {\n\t\tconfigOptions = append(configOptions, config.WithSharedConfigProfile(aws.ToString(\u0026profile)))\n\t}\n\tcfg, err := config.LoadDefaultConfig(ctx, configOptions...)\n\tif err != nil {\n\t\treturn aws.Config{}, err\n\t}\n\treturn cfg, nil\n}\n```\n\n[このコード](https://github.com/turbot/steampipe-plugin-aws/blob/main/aws/service.go#L1437-L1460) が参考になった。\n"}},"__N_SSG":true},"page":"/docs/[id]","query":{"id":"20230210174709"},"buildId":"R3w2YxKwomVZS6aeAB8Uf","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>