<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>MyDocs</title><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/css/a58c9bb1e05a64ba.css" as="style"/><link rel="stylesheet" href="/_next/static/css/a58c9bb1e05a64ba.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js"></script><script src="/_next/static/chunks/webpack-d38be8d96a62f950.js" defer=""></script><script src="/_next/static/chunks/framework-7a7e500878b44665.js" defer=""></script><script src="/_next/static/chunks/main-0a9b5d9f75e3dd77.js" defer=""></script><script src="/_next/static/chunks/pages/_app-2d6bf7b3192a8752.js" defer=""></script><script src="/_next/static/chunks/996-7d106c3956878ed2.js" defer=""></script><script src="/_next/static/chunks/706-40509b0ae2cf93bc.js" defer=""></script><script src="/_next/static/chunks/pages/docs/%5Bid%5D-949e412980dabb58.js" defer=""></script><script src="/_next/static/geyh5Y1CW91u6U4EOGZ3I/_buildManifest.js" defer=""></script><script src="/_next/static/geyh5Y1CW91u6U4EOGZ3I/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div><a style="text-decoration:none" href="/"><div style="color:black;font-size:22px;cursor:pointer">MyDocs</div></a></div><p></p><h1><b># <!-- -->gqlgen を触る</b></h1><h2>database の準備</h2>
<pre><div class="sc-bczSft fXnDIL"><div class="sc-gsnScm dAllrj">bash</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-shell" style="white-space:pre"><span style="color:#75715e">$</span><span class="bash"> go run -mod=mod entgo.io/ent/cmd/ent new Todo</span></code></pre></div></pre>
<p>schema の設定。</p>
<pre><div class="sc-bczSft fXnDIL"><div class="sc-gsnScm dAllrj">go</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-go" style="white-space:pre"><span style="color:#75715e">// Fields of the Todo.</span><span>
</span><span></span><span class="hljs-function" style="color:#f92672;font-weight:bold">func</span><span class="hljs-function"> </span><span class="hljs-function hljs-params">(Todo)</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">Fields</span><span class="hljs-function hljs-params">()</span><span class="hljs-function"> []</span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">ent</span><span class="hljs-function">.</span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">Field</span><span> {
</span><span>	</span><span style="color:#f92672;font-weight:bold">return</span><span> []ent.Field{
</span><span>		field.String(</span><span style="color:#a6e22e">&quot;title&quot;</span><span>),
</span><span>		field.String(</span><span style="color:#a6e22e">&quot;note&quot;</span><span>),
</span><span>		field.Bool(</span><span style="color:#a6e22e">&quot;completed&quot;</span><span>).Default(</span><span style="color:#f92672;font-weight:bold">false</span><span>),
</span><span>		field.Time(</span><span style="color:#a6e22e">&quot;created_at&quot;</span><span>).Default(time.Now()),
</span><span>		field.Time(</span><span style="color:#a6e22e">&quot;updated_at&quot;</span><span>).Default(time.Now()),
</span>	}
<!-- -->}</code></pre></div></pre>
<pre><div class="sc-bczSft fXnDIL"><div class="sc-gsnScm dAllrj">bash</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-shell" style="white-space:pre"><span style="color:#75715e">$</span><span class="bash"> go generate ./ent</span></code></pre></div></pre>
<h2>gqlgen</h2>
<pre><div class="sc-bczSft fXnDIL"><div class="sc-gsnScm dAllrj">bash</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-shell" style="white-space:pre"><span style="color:#75715e">$</span><span class="bash"> </span><span class="bash" style="color:#a6e22e">printf</span><span class="bash"> </span><span class="bash" style="color:#a6e22e">&#x27;// +build tools\npackage tools\nimport (_ &quot;github.com/99designs/gqlgen&quot;\n _ &quot;github.com/99designs/gqlgen/graphql/introspection&quot;)&#x27;</span><span class="bash"> | gofmt &gt; tools.go</span><span>
</span><span></span><span style="color:#75715e">$</span><span class="bash"> go mod tidy</span><span>
</span><span></span><span style="color:#75715e">$</span><span class="bash"> go run github.com/99designs/gqlgen init</span><span>
</span></code></pre></div></pre>
<p><code>graph/</code> に生成されたファイル。</p>
<pre><div class="sc-bczSft fXnDIL"><div class="sc-gsnScm dAllrj">bash</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-shell" style="white-space:pre"><span>tree graph/
</span>graph/
<!-- -->├── generated.go # 自動生成
<!-- -->├── model
<!-- -->│   └── models_gen.go # 自動生成
<!-- -->├── resolver.go
<!-- -->├── schema.graphqls
<!-- -->└── schema.resolvers.go</code></pre></div></pre>
<p>ファイルは <code>resolver.go</code>、<code>schema.graphqls</code>、<code>schema.resolvers.go</code> で良さそう。
プロジェクト直下に生成された <code>gqlgen.yml</code> は一旦放置。</p>
<h3>スキーマ定義</h3>
<p><code>schema.graphqls / schema.resolvers.go</code> を削除し、新規にスキーマ定義ファイルを作る。</p>
<p>共有インターフェイス Node を定義する。プライマリーキーを持つ場合は Node インターフェイスを作るのがお作法らしい。また、独自の型として Datetime を定義する。</p>
<pre><div class="sc-bczSft fXnDIL"><div class="sc-gsnScm dAllrj">graphqls</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-typescript" style="white-space:pre"><span style="color:#f92672;font-weight:bold">interface</span><span> Node {
</span><span>    </span><span class="hljs-attr">id</span><span>: ID!
</span>}
<!-- -->
<!-- -->scalar Datetime</code></pre></div></pre>
<p>次に Todo スキーマを定義する。</p>
<pre><div class="sc-bczSft fXnDIL"><div class="sc-gsnScm dAllrj">graphqls</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-typescript" style="white-space:pre"><span style="color:#f92672;font-weight:bold">type</span><span> Todo </span><span style="color:#f92672;font-weight:bold">implements</span><span> Node {
</span><span>    </span><span class="hljs-attr">id</span><span>: ID!
</span><span>    title: </span><span style="color:#a6e22e">String</span><span>!
</span><span>    note: </span><span style="color:#a6e22e">String</span><span>!
</span><span>    completed: </span><span style="color:#a6e22e">Boolean</span><span>!
</span>    created_at: Datetime!
<!-- -->    updated_at: Datetime!
<!-- -->}</code></pre></div></pre>
<p>最後に query と mutation を定義する。</p>
<pre><div class="sc-bczSft fXnDIL"><div class="sc-gsnScm dAllrj">graphqls</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-typescript" style="white-space:pre"><span style="color:#f92672;font-weight:bold">type</span><span> Query {
</span><span>    </span><span class="hljs-attr">todos</span><span>: [Todo!]!
</span>}</code></pre></div></pre>
<pre><div class="sc-bczSft fXnDIL"><div class="sc-gsnScm dAllrj">graphqls</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-typescript" style="white-space:pre"><span style="color:#f92672;font-weight:bold">type</span><span> Mutation {
</span>    createTodo(input: NewTodo!): Todo!
<!-- -->}
<!-- -->
<!-- -->input NewTodo {
<span>    </span><span class="hljs-attr">id</span><span>: ID
</span><span>    </span><span class="hljs-attr">title</span><span>: </span><span style="color:#a6e22e">String</span><span>!
</span><span>    note: </span><span style="color:#a6e22e">String</span><span>!
</span><span>    completed: </span><span style="color:#a6e22e">Boolean</span><span>
</span><span>    </span><span class="hljs-attr">created_at</span><span>: Datetime
</span><span>    </span><span class="hljs-attr">updated_at</span><span>: Datetime
</span>}</code></pre></div></pre>
<h3>コードの生成</h3>
<pre><div class="sc-bczSft fXnDIL"><div class="sc-gsnScm dAllrj">bash</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-shell" style="white-space:pre"><span style="color:#75715e">$</span><span class="bash"> go run github.com/99designs/gqlgen</span></code></pre></div></pre>
<h3>実装</h3>
<p>resolver から参照できるようにフィールドを追加する。</p>
<pre><div class="sc-bczSft fXnDIL"><div class="sc-gsnScm dAllrj">go</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-go" style="white-space:pre"><span style="color:#f92672;font-weight:bold">type</span><span> Resolver </span><span style="color:#f92672;font-weight:bold">struct</span><span> {
</span>	EntClient *ent.Client
<!-- -->}</code></pre></div></pre>
<p><code>query.resolvers.go</code> を実装する。</p>
<pre><div class="sc-bczSft fXnDIL"><div class="sc-gsnScm dAllrj">go</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-go" style="white-space:pre"><span style="color:#75715e">// Todos is the resolver for the todos field.</span><span>
</span><span></span><span class="hljs-function" style="color:#f92672;font-weight:bold">func</span><span class="hljs-function"> </span><span class="hljs-function hljs-params">(r *queryResolver)</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">Todos</span><span class="hljs-function hljs-params">(ctx context.Context)</span><span class="hljs-function"> </span><span class="hljs-function hljs-params">([]*model.Todo, error)</span><span> {
</span>	todos := []*model.Todo{}
<!-- -->	searched, _ := r.EntClient.Todo.Query().All(ctx)
<span>	</span><span style="color:#f92672;font-weight:bold">for</span><span> _, todo := </span><span style="color:#f92672;font-weight:bold">range</span><span> searched {
</span><span>		todos = </span><span style="color:#a6e22e">append</span><span>(todos, &amp;model.Todo{
</span>			ID:        strconv.Itoa(todo.ID),
<!-- -->			Title:     todo.Title,
<!-- -->			Note:      todo.Note,
<!-- -->			Completed: todo.Completed,
<!-- -->			CreatedAt: todo.CreatedAt.String(),
<!-- -->			UpdatedAt: todo.UpdatedAt.String(),
<!-- -->		})
<!-- -->	}
<span>	</span><span style="color:#f92672;font-weight:bold">return</span><span> todos, </span><span style="color:#f92672;font-weight:bold">nil</span><span>
</span>}</code></pre></div></pre>
<p><code>mutation.resolvers.go</code> を実装する。</p>
<pre><div class="sc-bczSft fXnDIL"><div class="sc-gsnScm dAllrj">go</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-go" style="white-space:pre"><span style="color:#75715e">// CreateTodo is the resolver for the createTodo field.</span><span>
</span><span></span><span class="hljs-function" style="color:#f92672;font-weight:bold">func</span><span class="hljs-function"> </span><span class="hljs-function hljs-params">(r *mutationResolver)</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">CreateTodo</span><span class="hljs-function hljs-params">(ctx context.Context, input model.NewTodo)</span><span class="hljs-function"> </span><span class="hljs-function hljs-params">(*model.Todo, error)</span><span> {
</span>	created, _ := r.EntClient.Todo.Create().
<!-- -->		SetTitle(input.Title).
<!-- -->		SetNote(input.Note).
<!-- -->		Save(ctx)
<!-- -->
<span>	</span><span style="color:#f92672;font-weight:bold">return</span><span> &amp;model.Todo{
</span>		ID:        strconv.Itoa(created.ID),
<!-- -->		Title:     created.Title,
<!-- -->		Note:      created.Note,
<!-- -->		Completed: created.Completed,
<!-- -->		CreatedAt: created.CreatedAt.String(),
<!-- -->		UpdatedAt: created.UpdatedAt.String(),
<span>	}, </span><span style="color:#f92672;font-weight:bold">nil</span><span>
</span>}</code></pre></div></pre>
<h2>server の実装</h2>
<p>最後は echo で実行できるようにする。<code>server.go</code> は不要なので削除。</p>
<pre><div class="sc-bczSft fXnDIL"><div class="sc-gsnScm dAllrj">go</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-go" style="white-space:pre"><span style="color:#f92672;font-weight:bold">package</span><span> main
</span>
<span></span><span style="color:#f92672;font-weight:bold">import</span><span> (
</span><span>	</span><span style="color:#a6e22e">&quot;context&quot;</span><span>
</span><span>	</span><span style="color:#a6e22e">&quot;gqlgen-todo/ent&quot;</span><span>
</span><span>	</span><span style="color:#a6e22e">&quot;gqlgen-todo/graph&quot;</span><span>
</span><span>	</span><span style="color:#a6e22e">&quot;net/http&quot;</span><span>
</span>
<span>	</span><span style="color:#a6e22e">&quot;github.com/99designs/gqlgen/graphql/handler&quot;</span><span>
</span><span>	</span><span style="color:#a6e22e">&quot;github.com/99designs/gqlgen/graphql/playground&quot;</span><span>
</span><span>	</span><span style="color:#a6e22e">&quot;github.com/labstack/echo/v4&quot;</span><span>
</span><span>	_ </span><span style="color:#a6e22e">&quot;github.com/mattn/go-sqlite3&quot;</span><span>
</span>)
<!-- -->
<span></span><span style="color:#f92672;font-weight:bold">const</span><span> (
</span><span>	DRIVER      = </span><span style="color:#a6e22e">&quot;sqlite3&quot;</span><span>
</span><span>	DATA_SOURCE = </span><span style="color:#a6e22e">&quot;file:ent?mode=memory&amp;cache=shared&amp;_fk=1&quot;</span><span>
</span>)
<!-- -->
<span></span><span class="hljs-function" style="color:#f92672;font-weight:bold">func</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">main</span><span class="hljs-function hljs-params">()</span><span> {
</span>	ctx := context.Background()
<!-- -->	client, _ := ent.Open(DRIVER, DATA_SOURCE)
<!-- -->	client.Schema.Create(ctx)
<!-- -->
<!-- -->	e := echo.New()
<span>	e.GET(</span><span style="color:#a6e22e">&quot;/health&quot;</span><span>, </span><span class="hljs-function" style="color:#f92672;font-weight:bold">func</span><span class="hljs-function hljs-params">(c echo.Context)</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">error</span><span> {
</span><span>		</span><span style="color:#f92672;font-weight:bold">return</span><span> c.String(http.StatusOK, </span><span style="color:#a6e22e">&quot;ok&quot;</span><span>)
</span>	})
<!-- -->
<!-- -->	graphqlHandler := handler.NewDefaultServer(
<!-- -->		graph.NewExecutableSchema(
<!-- -->			graph.Config{
<!-- -->				Resolvers: &amp;graph.Resolver{
<!-- -->					EntClient: client,
<!-- -->				},
<!-- -->			},
<!-- -->		),
<!-- -->	)
<span>	playgroudHandler := playground.Handler(</span><span style="color:#a6e22e">&quot;GraphQL&quot;</span><span>, </span><span style="color:#a6e22e">&quot;/query&quot;</span><span>)
</span>
<span>	e.POST(</span><span style="color:#a6e22e">&quot;/query&quot;</span><span>, </span><span class="hljs-function" style="color:#f92672;font-weight:bold">func</span><span class="hljs-function hljs-params">(c echo.Context)</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">error</span><span> {
</span>		graphqlHandler.ServeHTTP(c.Response(), c.Request())
<span>		</span><span style="color:#f92672;font-weight:bold">return</span><span> </span><span style="color:#f92672;font-weight:bold">nil</span><span>
</span>	})
<!-- -->
<span>	e.GET(</span><span style="color:#a6e22e">&quot;playground&quot;</span><span>, </span><span class="hljs-function" style="color:#f92672;font-weight:bold">func</span><span class="hljs-function hljs-params">(c echo.Context)</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">error</span><span> {
</span>		playgroudHandler.ServeHTTP(c.Response(), c.Request())
<span>		</span><span style="color:#f92672;font-weight:bold">return</span><span> </span><span style="color:#f92672;font-weight:bold">nil</span><span>
</span>	})
<!-- -->
<span>	e.Logger.Fatal(e.Start(</span><span style="color:#a6e22e">&quot;:8080&quot;</span><span>))
</span>}</code></pre></div></pre>
<h3>試す</h3>
<pre><div class="sc-bczSft fXnDIL"><div class="sc-gsnScm dAllrj">query</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-markdown" style="white-space:pre"><span>mutation {
</span>  createTodo(input: {
<span></span><span style="color:#66d9ef">    title: &quot;title1&quot;,
</span><span style="color:#66d9ef">    note: &quot;note1&quot;
</span><span style="color:#66d9ef">  }) {
</span><span style="color:#66d9ef">    id
</span><span style="color:#66d9ef">    title
</span><span style="color:#66d9ef">    note
</span><span style="color:#66d9ef">    completed
</span><span style="color:#66d9ef">    created_at
</span><span style="color:#66d9ef">    updated_at
</span><span style="color:#66d9ef">  }
</span><span style="color:#66d9ef">}
</span><span style="color:#66d9ef"></span><span>
</span>{
<!-- -->  &quot;data&quot;: {
<span></span><span style="color:#66d9ef">    &quot;createTodo&quot;: {
</span><span style="color:#66d9ef">      &quot;id&quot;: &quot;1&quot;,
</span><span style="color:#66d9ef">      &quot;title&quot;: &quot;title1&quot;,
</span><span style="color:#66d9ef">      &quot;note&quot;: &quot;note1&quot;,
</span><span style="color:#66d9ef">      &quot;completed&quot;: false,
</span><span style="color:#66d9ef">      &quot;created_at&quot;: &quot;2023-02-23 17:33:13&quot;,
</span><span style="color:#66d9ef">      &quot;updated_at&quot;: &quot;2023-02-23 17:33:13&quot;
</span><span style="color:#66d9ef">    }
</span><span style="color:#66d9ef">  }
</span><span style="color:#66d9ef">}</span></code></pre></div></pre>
<pre><div class="sc-bczSft fXnDIL"><div class="sc-gsnScm dAllrj">query</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-markdown" style="white-space:pre"><span>{
</span>  todos {
<span></span><span style="color:#66d9ef">    id
</span><span style="color:#66d9ef">    title
</span><span style="color:#66d9ef">    note
</span><span style="color:#66d9ef">    completed
</span><span style="color:#66d9ef">    created_at
</span><span style="color:#66d9ef">    updated_at
</span><span style="color:#66d9ef">  }
</span><span style="color:#66d9ef">}
</span><span style="color:#66d9ef"></span><span>
</span>{
<!-- -->  &quot;data&quot;: {
<span></span><span style="color:#66d9ef">    &quot;todos&quot;: [
</span><span style="color:#66d9ef">      {
</span><span style="color:#66d9ef">        &quot;id&quot;: &quot;1&quot;,
</span><span style="color:#66d9ef">        &quot;title&quot;: &quot;title1&quot;,
</span><span style="color:#66d9ef">        &quot;note&quot;: &quot;note1&quot;,
</span><span style="color:#66d9ef">        &quot;completed&quot;: false,
</span><span style="color:#66d9ef">        &quot;created_at&quot;: &quot;2023-02-23 17:33:13&quot;,
</span><span style="color:#66d9ef">        &quot;updated_at&quot;: &quot;2023-02-23 17:33:13&quot;
</span><span style="color:#66d9ef">      },
</span><span style="color:#66d9ef">      {
</span><span style="color:#66d9ef">        &quot;id&quot;: &quot;2&quot;,
</span><span style="color:#66d9ef">        &quot;title&quot;: &quot;title2&quot;,
</span><span style="color:#66d9ef">        &quot;note&quot;: &quot;note2&quot;,
</span><span style="color:#66d9ef">        &quot;completed&quot;: false,
</span><span style="color:#66d9ef">        &quot;created_at&quot;: &quot;2023-02-23 17:33:13&quot;,
</span><span style="color:#66d9ef">        &quot;updated_at&quot;: &quot;2023-02-23 17:33:13&quot;
</span><span style="color:#66d9ef">      },
</span><span style="color:#66d9ef">      {
</span><span style="color:#66d9ef">        &quot;id&quot;: &quot;3&quot;,
</span><span style="color:#66d9ef">        &quot;title&quot;: &quot;title3&quot;,
</span><span style="color:#66d9ef">        &quot;note&quot;: &quot;note3&quot;,
</span><span style="color:#66d9ef">        &quot;completed&quot;: false,
</span><span style="color:#66d9ef">        &quot;created_at&quot;: &quot;2023-02-23 17:33:13&quot;,
</span><span style="color:#66d9ef">        &quot;updated_at&quot;: &quot;2023-02-23 17:33:13&quot;
</span><span style="color:#66d9ef">      }
</span><span style="color:#66d9ef">    ]
</span><span style="color:#66d9ef">  }
</span><span style="color:#66d9ef">}</span></code></pre></div></pre></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"contents":{"id":"20230223173604","title":"gqlgen を触る","body":"\n## database の準備\n```bash\n$ go run -mod=mod entgo.io/ent/cmd/ent new Todo\n```\nschema の設定。\n```go\n// Fields of the Todo.\nfunc (Todo) Fields() []ent.Field {\n\treturn []ent.Field{\n\t\tfield.String(\"title\"),\n\t\tfield.String(\"note\"),\n\t\tfield.Bool(\"completed\").Default(false),\n\t\tfield.Time(\"created_at\").Default(time.Now()),\n\t\tfield.Time(\"updated_at\").Default(time.Now()),\n\t}\n}\n```\n\n```bash\n$ go generate ./ent\n```\n\n## gqlgen\n```bash\n$ printf '// +build tools\\npackage tools\\nimport (_ \"github.com/99designs/gqlgen\"\\n _ \"github.com/99designs/gqlgen/graphql/introspection\")' | gofmt \u003e tools.go\n$ go mod tidy\n$ go run github.com/99designs/gqlgen init\n\n```\n\n`graph/` に生成されたファイル。\n```bash\ntree graph/\ngraph/\n├── generated.go # 自動生成\n├── model\n│   └── models_gen.go # 自動生成\n├── resolver.go\n├── schema.graphqls\n└── schema.resolvers.go\n```\n\nファイルは `resolver.go`、`schema.graphqls`、`schema.resolvers.go` で良さそう。\nプロジェクト直下に生成された `gqlgen.yml` は一旦放置。\n\n### スキーマ定義\n`schema.graphqls / schema.resolvers.go` を削除し、新規にスキーマ定義ファイルを作る。\n\n共有インターフェイス Node を定義する。プライマリーキーを持つ場合は Node インターフェイスを作るのがお作法らしい。また、独自の型として Datetime を定義する。\n```common.graphqls\ninterface Node {\n    id: ID!\n}\n\nscalar Datetime\n```\n\n次に Todo スキーマを定義する。\n```todo.graphqls\ntype Todo implements Node {\n    id: ID!\n    title: String!\n    note: String!\n    completed: Boolean!\n    created_at: Datetime!\n    updated_at: Datetime!\n}\n```\n\n最後に query と mutation を定義する。\n```query.graphqls\ntype Query {\n    todos: [Todo!]!\n}\n```\n\n```mutation.graphqls\ntype Mutation {\n    createTodo(input: NewTodo!): Todo!\n}\n\ninput NewTodo {\n    id: ID\n    title: String!\n    note: String!\n    completed: Boolean\n    created_at: Datetime\n    updated_at: Datetime\n}\n```\n\n### コードの生成\n```bash\n$ go run github.com/99designs/gqlgen\n```\n\n### 実装\nresolver から参照できるようにフィールドを追加する。\n```go\ntype Resolver struct {\n\tEntClient *ent.Client\n}\n```\n\n`query.resolvers.go` を実装する。\n```go\n// Todos is the resolver for the todos field.\nfunc (r *queryResolver) Todos(ctx context.Context) ([]*model.Todo, error) {\n\ttodos := []*model.Todo{}\n\tsearched, _ := r.EntClient.Todo.Query().All(ctx)\n\tfor _, todo := range searched {\n\t\ttodos = append(todos, \u0026model.Todo{\n\t\t\tID:        strconv.Itoa(todo.ID),\n\t\t\tTitle:     todo.Title,\n\t\t\tNote:      todo.Note,\n\t\t\tCompleted: todo.Completed,\n\t\t\tCreatedAt: todo.CreatedAt.String(),\n\t\t\tUpdatedAt: todo.UpdatedAt.String(),\n\t\t})\n\t}\n\treturn todos, nil\n}\n```\n\n`mutation.resolvers.go` を実装する。\n\n```go\n// CreateTodo is the resolver for the createTodo field.\nfunc (r *mutationResolver) CreateTodo(ctx context.Context, input model.NewTodo) (*model.Todo, error) {\n\tcreated, _ := r.EntClient.Todo.Create().\n\t\tSetTitle(input.Title).\n\t\tSetNote(input.Note).\n\t\tSave(ctx)\n\n\treturn \u0026model.Todo{\n\t\tID:        strconv.Itoa(created.ID),\n\t\tTitle:     created.Title,\n\t\tNote:      created.Note,\n\t\tCompleted: created.Completed,\n\t\tCreatedAt: created.CreatedAt.String(),\n\t\tUpdatedAt: created.UpdatedAt.String(),\n\t}, nil\n}\n```\n\n## server の実装\n最後は echo で実行できるようにする。`server.go` は不要なので削除。\n```main.go\npackage main\n\nimport (\n\t\"context\"\n\t\"gqlgen-todo/ent\"\n\t\"gqlgen-todo/graph\"\n\t\"net/http\"\n\n\t\"github.com/99designs/gqlgen/graphql/handler\"\n\t\"github.com/99designs/gqlgen/graphql/playground\"\n\t\"github.com/labstack/echo/v4\"\n\t_ \"github.com/mattn/go-sqlite3\"\n)\n\nconst (\n\tDRIVER      = \"sqlite3\"\n\tDATA_SOURCE = \"file:ent?mode=memory\u0026cache=shared\u0026_fk=1\"\n)\n\nfunc main() {\n\tctx := context.Background()\n\tclient, _ := ent.Open(DRIVER, DATA_SOURCE)\n\tclient.Schema.Create(ctx)\n\n\te := echo.New()\n\te.GET(\"/health\", func(c echo.Context) error {\n\t\treturn c.String(http.StatusOK, \"ok\")\n\t})\n\n\tgraphqlHandler := handler.NewDefaultServer(\n\t\tgraph.NewExecutableSchema(\n\t\t\tgraph.Config{\n\t\t\t\tResolvers: \u0026graph.Resolver{\n\t\t\t\t\tEntClient: client,\n\t\t\t\t},\n\t\t\t},\n\t\t),\n\t)\n\tplaygroudHandler := playground.Handler(\"GraphQL\", \"/query\")\n\n\te.POST(\"/query\", func(c echo.Context) error {\n\t\tgraphqlHandler.ServeHTTP(c.Response(), c.Request())\n\t\treturn nil\n\t})\n\n\te.GET(\"playground\", func(c echo.Context) error {\n\t\tplaygroudHandler.ServeHTTP(c.Response(), c.Request())\n\t\treturn nil\n\t})\n\n\te.Logger.Fatal(e.Start(\":8080\"))\n}\n```\n\n### 試す\n```query\nmutation {\n  createTodo(input: {\n    title: \"title1\",\n    note: \"note1\"\n  }) {\n    id\n    title\n    note\n    completed\n    created_at\n    updated_at\n  }\n}\n\n{\n  \"data\": {\n    \"createTodo\": {\n      \"id\": \"1\",\n      \"title\": \"title1\",\n      \"note\": \"note1\",\n      \"completed\": false,\n      \"created_at\": \"2023-02-23 17:33:13\",\n      \"updated_at\": \"2023-02-23 17:33:13\"\n    }\n  }\n}\n```\n\n```query\n{\n  todos {\n    id\n    title\n    note\n    completed\n    created_at\n    updated_at\n  }\n}\n\n{\n  \"data\": {\n    \"todos\": [\n      {\n        \"id\": \"1\",\n        \"title\": \"title1\",\n        \"note\": \"note1\",\n        \"completed\": false,\n        \"created_at\": \"2023-02-23 17:33:13\",\n        \"updated_at\": \"2023-02-23 17:33:13\"\n      },\n      {\n        \"id\": \"2\",\n        \"title\": \"title2\",\n        \"note\": \"note2\",\n        \"completed\": false,\n        \"created_at\": \"2023-02-23 17:33:13\",\n        \"updated_at\": \"2023-02-23 17:33:13\"\n      },\n      {\n        \"id\": \"3\",\n        \"title\": \"title3\",\n        \"note\": \"note3\",\n        \"completed\": false,\n        \"created_at\": \"2023-02-23 17:33:13\",\n        \"updated_at\": \"2023-02-23 17:33:13\"\n      }\n    ]\n  }\n}\n```\n"}},"__N_SSG":true},"page":"/docs/[id]","query":{"id":"20230223173604"},"buildId":"geyh5Y1CW91u6U4EOGZ3I","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>