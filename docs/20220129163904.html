<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>MyDocs</title><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/css/e9aae2ffe8b4519e.css" as="style"/><link rel="stylesheet" href="/_next/static/css/e9aae2ffe8b4519e.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-9b312e20a4e32339.js" defer=""></script><script src="/_next/static/chunks/framework-4556c45dd113b893.js" defer=""></script><script src="/_next/static/chunks/main-153ca532c98eee0d.js" defer=""></script><script src="/_next/static/chunks/pages/_app-16a178d62fbe6b26.js" defer=""></script><script src="/_next/static/chunks/996-9dcc742b16361397.js" defer=""></script><script src="/_next/static/chunks/443-9cd94d9f358e92ea.js" defer=""></script><script src="/_next/static/chunks/pages/docs/%5Bid%5D-d96e0ba8f87e1cb7.js" defer=""></script><script src="/_next/static/fct479ejeNFyL_LxGAyfh/_buildManifest.js" defer=""></script><script src="/_next/static/fct479ejeNFyL_LxGAyfh/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div><div><div class="bg-gray-600 h-10 leading-10 text-2xl"><a class="no-underline text-gray-100 mx-2" href="/">MyDocs</a></div></div><div class="mx-10"><h1><b># <!-- -->echo で middleware を実装する</b></h1><p><a href="https://echo.labstack.com/cookbook/middleware/">公式ドキュメント</a>を参考に今回はアクセスの回数をログに出力する middleware を実装する。</p>
<p>middleware は <code>echo.HandlerFunc</code> を返す関数を作れば良さそう。</p>
<pre><div class="sc-bczRLJ xShwa"><div class="sc-gsnTZi iXcekV">go</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-go" style="white-space:pre"><span style="color:#f92672;font-weight:bold">package</span><span> main
</span>
<span></span><span style="color:#f92672;font-weight:bold">import</span><span> (
</span><span>	</span><span style="color:#a6e22e">&quot;fmt&quot;</span><span>
</span><span>	</span><span style="color:#a6e22e">&quot;sync&quot;</span><span>
</span>
<span>	</span><span style="color:#a6e22e">&quot;github.com/labstack/echo/v4&quot;</span><span>
</span>)
<!-- -->
<span></span><span style="color:#f92672;font-weight:bold">type</span><span> Counter </span><span style="color:#f92672;font-weight:bold">struct</span><span> {
</span>	mutex sync.Mutex
<span>	value </span><span style="color:#f92672;font-weight:bold">int</span><span>
</span>}
<!-- -->
<span></span><span style="color:#f92672;font-weight:bold">var</span><span> counter = </span><span style="color:#a6e22e">new</span><span>(Counter)
</span>
<span></span><span class="hljs-function" style="color:#f92672;font-weight:bold">func</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">accessCounter</span><span class="hljs-function hljs-params">(next echo.HandlerFunc)</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">echo</span><span class="hljs-function">.</span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">HandlerFunc</span><span> {
</span><span>	</span><span style="color:#f92672;font-weight:bold">return</span><span> </span><span class="hljs-function" style="color:#f92672;font-weight:bold">func</span><span class="hljs-function hljs-params">(c echo.Context)</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">error</span><span> {
</span>		counter.mutex.Lock()
<!-- -->		counter.value++
<!-- -->		counter.mutex.Unlock()
<!-- -->		fmt.Println(counter.value)
<span>		</span><span style="color:#f92672;font-weight:bold">return</span><span> next(c)
</span>	}
<!-- -->}
<!-- -->
<span></span><span class="hljs-function" style="color:#f92672;font-weight:bold">func</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">main</span><span class="hljs-function hljs-params">()</span><span> {
</span>	e := echo.New()
<!-- -->
<!-- -->	e.Use(accessCounter)
<span>	e.Start(</span><span style="color:#a6e22e">&quot;:8080&quot;</span><span>)
</span>}
</code></pre></div></pre></div><br/></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"body":{"id":"20220129163904","title":"echo で middleware を実装する","body":"\n[公式ドキュメント](https://echo.labstack.com/cookbook/middleware/)を参考に今回はアクセスの回数をログに出力する middleware を実装する。\n\nmiddleware は `echo.HandlerFunc` を返す関数を作れば良さそう。\n\n```go\npackage main\n\nimport (\n\t\"fmt\"\n\t\"sync\"\n\n\t\"github.com/labstack/echo/v4\"\n)\n\ntype Counter struct {\n\tmutex sync.Mutex\n\tvalue int\n}\n\nvar counter = new(Counter)\n\nfunc accessCounter(next echo.HandlerFunc) echo.HandlerFunc {\n\treturn func(c echo.Context) error {\n\t\tcounter.mutex.Lock()\n\t\tcounter.value++\n\t\tcounter.mutex.Unlock()\n\t\tfmt.Println(counter.value)\n\t\treturn next(c)\n\t}\n}\n\nfunc main() {\n\te := echo.New()\n\n\te.Use(accessCounter)\n\te.Start(\":8080\")\n}\n\n```\n"}},"__N_SSG":true},"page":"/docs/[id]","query":{"id":"20220129163904"},"buildId":"fct479ejeNFyL_LxGAyfh","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>