<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>MyDocs</title><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/css/a58c9bb1e05a64ba.css" as="style"/><link rel="stylesheet" href="/_next/static/css/a58c9bb1e05a64ba.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-d38be8d96a62f950.js" defer=""></script><script src="/_next/static/chunks/framework-2c79e2a64abdb08b.js" defer=""></script><script src="/_next/static/chunks/main-348c8faa34e64ab3.js" defer=""></script><script src="/_next/static/chunks/pages/_app-aef446c81fd4cad4.js" defer=""></script><script src="/_next/static/chunks/996-d065d3ec5d2a41d4.js" defer=""></script><script src="/_next/static/chunks/635-fe39bb0306c39624.js" defer=""></script><script src="/_next/static/chunks/pages/docs/%5Bid%5D-f16bc0121a6e0d8a.js" defer=""></script><script src="/_next/static/cuAPPPyJ_mfHEpjFF7Jy1/_buildManifest.js" defer=""></script><script src="/_next/static/cuAPPPyJ_mfHEpjFF7Jy1/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div><a style="text-decoration:none" href="/"><div style="color:black;font-size:22px;cursor:pointer">MyDocs</div></a></div><p></p><h1><b># <!-- -->rds のパラメータグループを for 文でまとめてかく</b></h1><p>モジュール側で map の配列を受け取るようにする。</p>
<pre><div class="sc-bcXHqe lmagiH"><div class="sc-gswNZR jJknjO">terraform</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-terraform" style="white-space:pre"><span style="color:#f92672;font-weight:bold">variable</span><span> </span><span style="color:#a6e22e">&quot;parameters&quot;</span><span> {
</span><span>  type        </span><span style="color:#75715e">= list(map(string))</span><span>
</span>}
<!-- -->
<span>resource </span><span style="color:#75715e">&quot;aws_rds_cluster_parameter_group&quot;</span><span> </span><span style="color:#75715e">&quot;template&quot;</span><span> </span><span style="color:#75715e">{</span><span>
</span><span>  family </span><span style="color:#75715e">=</span><span> </span><span style="color:#75715e">&quot;aurora-mysql5.7&quot;</span><span>
</span>
<span>  name </span><span style="color:#75715e">= var.name</span><span>
</span>
<span>  dynamic </span><span style="color:#75715e">&quot;parameter&quot;</span><span> </span><span style="color:#75715e">{</span><span>
</span><span>    for_each </span><span style="color:#75715e">= var.parameters</span><span>
</span><span>    content </span><span style="color:#75715e">{</span><span>
</span><span>      apply_method </span><span style="color:#75715e">= parameter.value[</span><span style="color:#75715e">&quot;apply_method&quot;</span><span style="color:#75715e">]</span><span>
</span><span>      name         </span><span style="color:#75715e">= parameter.value[</span><span style="color:#75715e">&quot;name&quot;</span><span style="color:#75715e">]</span><span>
</span><span>      value        </span><span style="color:#75715e">= parameter.value[</span><span style="color:#75715e">&quot;value&quot;</span><span style="color:#75715e">]</span><span>
</span>    }
<!-- -->  }
<!-- -->}</code></pre></div></pre>
<p>呼び出し側で parameters の配列に必要なパラメータを map で書いてあげればよい。</p>
<pre><div class="sc-bcXHqe lmagiH"><div class="sc-gswNZR jJknjO">terraform</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-terraform" style="white-space:pre"><span>module </span><span style="color:#a6e22e">&quot;parameter_group&quot;</span><span> {
</span><span>  source      = </span><span class="hljs-attr">&quot;../../modules/aws_rds_cluster_parameter_group&quot;</span><span>
</span><span>  name        = </span><span class="hljs-attr">&quot;sample-parameter-group&quot;</span><span>
</span>
<!-- -->  parameters = [
<span>    { apply_method : </span><span style="color:#a6e22e">&quot;immediate&quot;</span><span>, name : </span><span style="color:#a6e22e">&quot;character_set_server&quot;</span><span>, value : </span><span style="color:#a6e22e">&quot;utf8mb4&quot;</span><span> },
</span><span>    { apply_method : </span><span style="color:#a6e22e">&quot;pending-reboot&quot;</span><span>, name : </span><span style="color:#a6e22e">&quot;binlog_format&quot;</span><span>, value : </span><span style="color:#a6e22e">&quot;MIXED&quot;</span><span> },
</span>  ]
<!-- -->}</code></pre></div></pre>
<p>plan 結果。</p>
<pre><div class="sc-bcXHqe lmagiH"><div class="sc-gswNZR jJknjO">bash</div><pre node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-shell" style="white-space:pre"><span style="color:#75715e">  #</span><span class="bash"> module.parameter_group.aws_rds_cluster_parameter_group.template will be created</span><span>
</span>  + resource &quot;aws_rds_cluster_parameter_group&quot; &quot;template&quot; {
<!-- -->      + arn         = (known after apply)
<!-- -->      + description = &quot;Managed by Terraform&quot;
<!-- -->      + family      = &quot;aurora-mysql5.7&quot;
<!-- -->      + id          = (known after apply)
<!-- -->      + name        = &quot;sample-parameter-group&quot;
<!-- -->      + name_prefix = (known after apply)
<!-- -->      + tags_all    = (known after apply)
<!-- -->
<!-- -->      + parameter {
<!-- -->          + apply_method = &quot;immediate&quot;
<!-- -->          + name         = &quot;character_set_server&quot;
<!-- -->          + value        = &quot;utf8mb4&quot;
<!-- -->        }
<!-- -->      + parameter {
<!-- -->          + apply_method = &quot;pending-reboot&quot;
<!-- -->          + name         = &quot;binlog_format&quot;
<!-- -->          + value        = &quot;MIXED&quot;
<!-- -->        }
<!-- -->    }
<!-- -->
<!-- -->Plan: 1 to add, 0 to change, 0 to destroy.</code></pre></div></pre></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"contents":{"id":"20221211174737","title":"rds のパラメータグループを for 文でまとめてかく","body":"\nモジュール側で map の配列を受け取るようにする。\n```terraform\nvariable \"parameters\" {\n  type        = list(map(string))\n}\n\nresource \"aws_rds_cluster_parameter_group\" \"template\" {\n  family = \"aurora-mysql5.7\"\n\n  name = var.name\n\n  dynamic \"parameter\" {\n    for_each = var.parameters\n    content {\n      apply_method = parameter.value[\"apply_method\"]\n      name         = parameter.value[\"name\"]\n      value        = parameter.value[\"value\"]\n    }\n  }\n}\n```\n\n呼び出し側で parameters の配列に必要なパラメータを map で書いてあげればよい。\n```terraform\nmodule \"parameter_group\" {\n  source      = \"../../modules/aws_rds_cluster_parameter_group\"\n  name        = \"sample-parameter-group\"\n\n  parameters = [\n    { apply_method : \"immediate\", name : \"character_set_server\", value : \"utf8mb4\" },\n    { apply_method : \"pending-reboot\", name : \"binlog_format\", value : \"MIXED\" },\n  ]\n}\n```\n\nplan 結果。\n```bash\n  # module.parameter_group.aws_rds_cluster_parameter_group.template will be created\n  + resource \"aws_rds_cluster_parameter_group\" \"template\" {\n      + arn         = (known after apply)\n      + description = \"Managed by Terraform\"\n      + family      = \"aurora-mysql5.7\"\n      + id          = (known after apply)\n      + name        = \"sample-parameter-group\"\n      + name_prefix = (known after apply)\n      + tags_all    = (known after apply)\n\n      + parameter {\n          + apply_method = \"immediate\"\n          + name         = \"character_set_server\"\n          + value        = \"utf8mb4\"\n        }\n      + parameter {\n          + apply_method = \"pending-reboot\"\n          + name         = \"binlog_format\"\n          + value        = \"MIXED\"\n        }\n    }\n\nPlan: 1 to add, 0 to change, 0 to destroy.\n```\n"}},"__N_SSG":true},"page":"/docs/[id]","query":{"id":"20221211174737"},"buildId":"cuAPPPyJ_mfHEpjFF7Jy1","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>