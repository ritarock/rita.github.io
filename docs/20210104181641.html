<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>MyDocs</title><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/css/e44854d771c00df0.css" as="style"/><link rel="stylesheet" href="/_next/static/css/e44854d771c00df0.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-514908bffb652963.js" defer=""></script><script src="/_next/static/chunks/framework-91d7f78b5b4003c8.js" defer=""></script><script src="/_next/static/chunks/main-d98b4a7f39fdfc80.js" defer=""></script><script src="/_next/static/chunks/pages/_app-327d6f89185e0007.js" defer=""></script><script src="/_next/static/chunks/594-14c965e1fcce40c6.js" defer=""></script><script src="/_next/static/chunks/pages/docs/%5Bid%5D-5449b7016e4923d1.js" defer=""></script><script src="/_next/static/_DJ56jee9Jq5wqHN8NeJz/_buildManifest.js" defer=""></script><script src="/_next/static/_DJ56jee9Jq5wqHN8NeJz/_ssgManifest.js" defer=""></script><script src="/_next/static/_DJ56jee9Jq5wqHN8NeJz/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div><div><div class="bg-gray-600 h-10 leading-10 text-2xl"><a class="no-underline text-gray-100 mx-2" href="/">MyDocs</a></div></div><div class="mx-7"><h1><b># <!-- -->Golang で時間操作とソート</b></h1><p><a href="https://github.com/ritarock/moniterinstance">インスタンスのCPUをCLIで確認する</a></p>
<p>この CLI を作るにあたってハマったところとその解決法。</p>
<h2>時間でソートする</h2>
<h3>配列のソート</h3>
<p>Golang の場合、お決まりのやり方があるみたいでググると大体同じやり方でやっている。</p>
<p>struct を定義して、<code node="[object Object]">Len, Less, Swap</code> メソッドを用意する。</p>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-go" style="white-space:pre"><span style="color:#f92672;font-weight:bold">type</span><span> Bytime []*cloudwatch.Datapoint
</span>
<span></span><span class="hljs-function" style="color:#f92672;font-weight:bold">func</span><span class="hljs-function"> </span><span class="hljs-function hljs-params">(arr Bytime)</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">Len</span><span class="hljs-function hljs-params">()</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">int</span><span> {
</span><span>	</span><span style="color:#f92672;font-weight:bold">return</span><span> </span><span style="color:#a6e22e">len</span><span>(arr)
</span>}
<!-- -->
<span></span><span class="hljs-function" style="color:#f92672;font-weight:bold">func</span><span class="hljs-function"> </span><span class="hljs-function hljs-params">(arr Bytime)</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">Less</span><span class="hljs-function hljs-params">(i, j </span><span class="hljs-function hljs-params" style="color:#f92672;font-weight:bold">int</span><span class="hljs-function hljs-params">)</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">bool</span><span> {
</span><span>	</span><span style="color:#f92672;font-weight:bold">return</span><span> arr[i].Timestamp.Before(*arr[j].Timestamp)
</span>}
<!-- -->
<span></span><span class="hljs-function" style="color:#f92672;font-weight:bold">func</span><span class="hljs-function"> </span><span class="hljs-function hljs-params">(arr Bytime)</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a6e22e;font-weight:bold">Swap</span><span class="hljs-function hljs-params">(i, j </span><span class="hljs-function hljs-params" style="color:#f92672;font-weight:bold">int</span><span class="hljs-function hljs-params">)</span><span> {
</span>	arr[i], arr[j] = arr[j], arr[i]
<!-- -->}
</code></div><p class="h-2"></p></pre>
<p>実際にソートするときは、別の配列を用意した。</p>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-go" style="white-space:pre"><span style="color:#f92672;font-weight:bold">var</span><span> sortedResp Bytime = resp.Datapoints
</span>sort.Sort(sortedResp)
</code></div><p class="h-2"></p></pre>
<h3>時間の比較</h3>
<p>timeA(2020-01-01 00:00:00 +0000 UTC) と timeB(2021-01-01 00:00:00 +0000 UTC) があるとする。</p>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-go" style="white-space:pre"><span>timeA, timeB := time.Date(</span><span class="hljs-number">2020</span><span>, </span><span class="hljs-number">1</span><span>, </span><span class="hljs-number">1</span><span>, </span><span class="hljs-number">0</span><span>, </span><span class="hljs-number">0</span><span>, </span><span class="hljs-number">0</span><span> , </span><span class="hljs-number">0</span><span>, time.UTC), time.Date(</span><span class="hljs-number">2021</span><span>, </span><span class="hljs-number">1</span><span>, </span><span class="hljs-number">1</span><span>, </span><span class="hljs-number">0</span><span>, </span><span class="hljs-number">0</span><span>, </span><span class="hljs-number">0</span><span> , </span><span class="hljs-number">0</span><span>, time.UTC)</span></code></div><p class="h-2"></p></pre>
<p>時間の流れは <code node="[object Object]">timeA =&gt; timeB</code>。</p>
<p>このときの時間の比較は以下のようにできる。</p>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-go" style="white-space:pre"><span>timeA.Equal(timeB) </span><span style="color:#75715e">// false</span><span>
</span>
<span>timeA.Before(timeB) </span><span style="color:#75715e">// true</span><span>
</span>
<span>timeA.After(timeB) </span><span style="color:#75715e">// false</span></code></div><p class="h-2"></p></pre>
<h2>UTCをJSTに変更</h2>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;background:#272822;color:#ddd"><code class="language-go" style="white-space:pre"><span>timeA := time.Date(</span><span class="hljs-number">2020</span><span>, </span><span class="hljs-number">1</span><span>, </span><span class="hljs-number">1</span><span>, </span><span class="hljs-number">0</span><span>, </span><span class="hljs-number">0</span><span>, </span><span class="hljs-number">0</span><span> , </span><span class="hljs-number">0</span><span>, time.UTC)
</span><span>loc, _ := time.LoadLocation(</span><span style="color:#a6e22e">&quot;Asia/Tokyo&quot;</span><span>)
</span>
<span>fmt.Println(</span><span style="color:#a6e22e">&quot;UTC &quot;</span><span> + timeA.String()) </span><span style="color:#75715e">// UTC 2020-01-01 00:00:00 +0000 UTC</span><span>
</span><span>fmt.Println(</span><span style="color:#a6e22e">&quot;JST &quot;</span><span> + timeA.In(loc).String()) </span><span style="color:#75715e">// JST 2020-01-01 09:00:00 +0900 JST</span></code></div><p class="h-2"></p></pre></div><br/></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"docBody":{"id":"20210104181641","title":"Golang で時間操作とソート","content":"\n[インスタンスのCPUをCLIで確認する](https://github.com/ritarock/moniterinstance)\n\nこの CLI を作るにあたってハマったところとその解決法。\n\n## 時間でソートする\n### 配列のソート\nGolang の場合、お決まりのやり方があるみたいでググると大体同じやり方でやっている。\n\nstruct を定義して、`Len, Less, Swap` メソッドを用意する。\n```go\ntype Bytime []*cloudwatch.Datapoint\n\nfunc (arr Bytime) Len() int {\n\treturn len(arr)\n}\n\nfunc (arr Bytime) Less(i, j int) bool {\n\treturn arr[i].Timestamp.Before(*arr[j].Timestamp)\n}\n\nfunc (arr Bytime) Swap(i, j int) {\n\tarr[i], arr[j] = arr[j], arr[i]\n}\n```\n\n実際にソートするときは、別の配列を用意した。\n```go\nvar sortedResp Bytime = resp.Datapoints\nsort.Sort(sortedResp)\n```\n\n### 時間の比較\ntimeA(2020-01-01 00:00:00 +0000 UTC) と timeB(2021-01-01 00:00:00 +0000 UTC) があるとする。\n```go\ntimeA, timeB := time.Date(2020, 1, 1, 0, 0, 0 , 0, time.UTC), time.Date(2021, 1, 1, 0, 0, 0 , 0, time.UTC)\n```\n\n時間の流れは `timeA =\u003e timeB`。\n\nこのときの時間の比較は以下のようにできる。\n```go\ntimeA.Equal(timeB) // false\n\ntimeA.Before(timeB) // true\n\ntimeA.After(timeB) // false\n```\n\n## UTCをJSTに変更\n```go\ntimeA := time.Date(2020, 1, 1, 0, 0, 0 , 0, time.UTC)\nloc, _ := time.LoadLocation(\"Asia/Tokyo\")\n\nfmt.Println(\"UTC \" + timeA.String()) // UTC 2020-01-01 00:00:00 +0000 UTC\nfmt.Println(\"JST \" + timeA.In(loc).String()) // JST 2020-01-01 09:00:00 +0900 JST\n```\n"}},"__N_SSG":true},"page":"/docs/[id]","query":{"id":"20210104181641"},"buildId":"_DJ56jee9Jq5wqHN8NeJz","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>